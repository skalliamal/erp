{"version":3,"file":"MultiImage.min.js","sources":["MultiImage.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nclass MultiImage {\n\n\t/**\n\t * Create class instance\n\t *\n\t * @param {HTMLElement|jQuery} inputElement - input type file element inside component\n\t */\n\tconstructor(element) {\n\t\tconst thisInstance = this;\n\t\tthis.elements = {};\n\t\tthis.options = {\n\t\t\tzoomTitleAnimation: {\n\t\t\t\tin: 'fadeIn',\n\t\t\t\tout: 'fadeOut'\n\t\t\t},\n\t\t\tshowCarousel: true,\n\t\t};\n\t\tthis.detailView = false;\n\t\tthis.elements.fileInput = $(element).find('.js-multi-image__file').eq(0);\n\t\tif (this.elements.fileInput.length === 0) {\n\t\t\tthis.detailView = true;\n\t\t}\n\t\tthis.elements.component = $(element).eq(0);\n\t\tthis.elements.form = $(element).closest('form').eq(0);\n\t\t$(this.elements.form).on('submit', this.onFormSubmit);\n\t\tthis.elements.addButton = this.elements.component.find('.js-multi-image__file-btn').eq(0);\n\t\tthis.elements.values = this.elements.component.find('.js-multi-image__values').eq(0);\n\t\tthis.elements.progressBar = this.elements.component.find('.js-multi-image__progress-bar').eq(0);\n\t\tthis.elements.progress = this.elements.component.find('.js-multi-image__progress').eq(0);\n\t\tthis.elements.result = this.elements.component.find('.js-multi-image__result').eq(0);\n\t\tthis.fieldInfo = this.elements.values.data('fieldinfo');\n\t\tthis.options.formats = this.fieldInfo.formats;\n\t\tthis.options.limit = this.fieldInfo.limit;\n\t\tif (!this.detailView) {\n\t\t\tthis.files = JSON.parse(this.elements.values.val());\n\t\t} else {\n\t\t\tthis.files = this.elements.values.data('value');\n\t\t}\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.fileInput.detach();\n\t\t\tthis.elements.addButton.click(this.addButtonClick.bind(this));\n\t\t\tthis.elements.fileInput.fileupload({\n\t\t\t\tdataType: 'json',\n\t\t\t\treplaceFileInput: false,\n\t\t\t\tfileInput: this.fileInput,\n\t\t\t\tautoUpload: false,\n\t\t\t\tsubmit: this.submit.bind(this),\n\t\t\t\tadd: this.add.bind(this),\n\t\t\t\tprogressall: this.progressAll.bind(this),\n\t\t\t\tchange: this.change.bind(this),\n\t\t\t\tdrop: this.change.bind(this),\n\t\t\t\tdragover: this.dragOver.bind(this),\n\t\t\t\tfail: this.uploadError.bind(this),\n\t\t\t\tdone: this.uploadSuccess.bind(this),\n\t\t\t});\n\t\t\tthis.elements.component.on('dragleave', this.dragLeave.bind(this));\n\t\t\tthis.elements.component.on('dragend', this.dragLeave.bind(this));\n\t\t\tthis.elements.fileInput.fileupload('option', 'dropZone', $(this.elements.component));\n\t\t\tthis.enableDragNDrop();\n\t\t}\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-img', function (e) {\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-zoom', function (e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.zoomPreview($(this).data('hash'));\n\t\t});\n\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-download', function (e) {\n\t\t\te.preventDefault();\n\t\t\tthisInstance.download($(this).data('hash'));\n\t\t});\n\t\tif (!this.detailView) {\n\t\t\tthis.elements.component.on('click', '.js-multi-image__popover-btn-delete', function (e) {\n\t\t\t\te.preventDefault();\n\t\t\t\tthisInstance.deleteFile($(this).data('hash'));\n\t\t\t});\n\t\t}\n\t\tthis.loadExistingFiles();\n\t\tif (typeof $.fn.animateCss === \"undefined\") {\n\t\t\t$.fn.extend({\n\t\t\t\tanimateCss: function (animationName, callback) {\n\t\t\t\t\tlet animationEnd = (function (el) {\n\t\t\t\t\t\tlet animations = {\n\t\t\t\t\t\t\tanimation: 'animationend',\n\t\t\t\t\t\t\tOAnimation: 'oAnimationEnd',\n\t\t\t\t\t\t\tMozAnimation: 'mozAnimationEnd',\n\t\t\t\t\t\t\tWebkitAnimation: 'webkitAnimationEnd',\n\t\t\t\t\t\t};\n\t\t\t\t\t\tfor (let t in animations) {\n\t\t\t\t\t\t\tif (el.style[t] !== undefined) {\n\t\t\t\t\t\t\t\treturn animations[t];\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t})(document.createElement('div'));\n\t\t\t\t\tthis.addClass('animated ' + animationName).one(animationEnd, function () {\n\t\t\t\t\t\t$(this).removeClass('animated ' + animationName);\n\n\t\t\t\t\t\tif (typeof callback === 'function') callback();\n\t\t\t\t\t});\n\t\t\t\t\treturn this;\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Prevent form submission before file upload end\n\t * @param e\n\t */\n\tonFormSubmit(e) {\n\t\tif (App.Fields.MultiImage.currentFileUploads) {\n\t\t\te.preventDefault();\n\t\t\te.stopPropagation();\n\t\t\te.stopImmediatePropagation();\n\t\t\tbootbox.alert(app.vtranslate('JS_WAIT_FOR_FILE_UPLOAD'));\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\n\t/**\n\t * Prevent form submission\n\t *\n\t * @param {Event} e\n\t */\n\taddButtonClick(e) {\n\t\te.preventDefault();\n\t\tthis.elements.fileInput.trigger('click');\n\t}\n\n\t/**\n\t * Submit event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tsubmit(e, data) {\n\t\tdata.formData = {\n\t\t\thash: data.files[0].hash\n\t\t};\n\t\tApp.Fields.MultiImage.currentFileUploads++;\n\t}\n\n\t/**\n\t * Get file information\n\t *\n\t * @param {String} hash - file id\n\t * @returns {Object}\n\t */\n\tgetFileInfo(hash) {\n\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\tconst file = this.files[i];\n\t\t\tif (file.hash === hash) {\n\t\t\t\treturn file;\n\t\t\t}\n\t\t}\n\t\tapp.errorLog(`File '${hash}' not found.`);\n\t\tVtiger_Helper_Js.showPnotify({text: app.vtranslate(\"JS_INVALID_FILE_HASH\") + ` [${hash}]`});\n\t}\n\n\t/**\n\t * Add property to file info object\n\t *\n\t * @param {String} hash - file id\n\t * @param {String} propertyName\n\t * @param {any} value\n\t * @returns {Object}\n\t */\n\taddFileInfoProperty(hash, propertyName, value) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tfileInfo[propertyName] = value;\n\t\treturn fileInfo;\n\t}\n\n\t/**\n\t * Error event handler from file upload request\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tuploadError(e, data) {\n\t\tapp.errorLog(\"File upload error.\");\n\t\tconst {jqXHR, files} = data;\n\t\tif (typeof jqXHR.responseJSON === \"undefined\" || jqXHR.responseJSON === null) {\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\treturn Vtiger_Helper_Js.showPnotify(app.vtranslate(\"JS_FILE_UPLOAD_ERROR\"));\n\t\t}\n\t\tconst response = jqXHR.responseJSON;\n\t\t// first try to show error for concrete file\n\t\tif (typeof response.result !== \"undefined\" && typeof response.result.attach !== \"undefined\" && Array.isArray(response.result.attach)) {\n\t\t\tresponse.result.attach.forEach((fileAttach) => {\n\t\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\t\tthis.deleteFile(fileAttach.hash, false);\n\t\t\t\tif (typeof fileAttach.error === 'string') {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(fileAttach.error + ` [${fileAttach.name}]`);\n\t\t\t\t} else {\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate(\"JS_FILE_UPLOAD_ERROR\") + ` [${fileAttach.name}]`);\n\t\t\t\t}\n\t\t\t});\n\t\t\tthis.updateFormValues();\n\t\t\treturn;\n\t\t}\n\t\t// else show default upload error\n\t\tfiles.forEach((file) => {\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t\tthis.deleteFile(file.hash, false);\n\t\t\tVtiger_Helper_Js.showPnotify(app.vtranslate(\"JS_FILE_UPLOAD_ERROR\") + ` [${file.name}]`);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Success event handler from file upload request\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tuploadSuccess(e, data) {\n\t\tconst {result} = data;\n\t\tconst attach = result.result.attach;\n\t\tattach.forEach((fileAttach) => {\n\t\t\tconst hash = fileAttach.hash;\n\t\t\tif (!hash) {\n\t\t\t\treturn app.errorLog(new Error(app.vtranslate(\"JS_INVALID_FILE_HASH\") + ` [${hash}]`));\n\t\t\t}\n\t\t\tif (typeof fileAttach.key === \"undefined\") {\n\t\t\t\treturn this.uploadError(e, data);\n\t\t\t}\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\tthis.addFileInfoProperty(hash, 'key', fileAttach.key);\n\t\t\tthis.addFileInfoProperty(hash, 'size', fileAttach.size);\n\t\t\tthis.addFileInfoProperty(hash, 'name', fileAttach.name);\n\t\t\tthis.removePreviewPopover(hash);\n\t\t\tthis.addPreviewPopover(fileInfo.file, fileInfo.previewElement, fileInfo.imageSrc);\n\t\t\tApp.Fields.MultiImage.currentFileUploads--;\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Update form input values\n\t */\n\tupdateFormValues() {\n\t\tconst formValues = this.files.map(file => {\n\t\t\treturn {key: file.key, name: file.name, size: file.size};\n\t\t});\n\t\tthis.elements.values.val(JSON.stringify(formValues));\n\t}\n\n\t/**\n\t * Validate file\n\t *\n\t * @param {Object} file\n\t * @returns {boolean}\n\t */\n\tvalidateFile(file) {\n\t\tlet valid = false;\n\t\tthis.options.formats.forEach((format) => {\n\t\t\tif (file.type === 'image/' + format) {\n\t\t\t\tvalid = true;\n\t\t\t}\n\t\t});\n\t\tif (!valid) {\n\t\t\tVtiger_Helper_Js.showPnotify(`${app.vtranslate(\"JS_INVALID_FILE_TYPE\")} [${file.name}]\\n${app.vtranslate(\"JS_AVAILABLE_FILE_TYPES\")}  [${this.options.formats.join(', ')}]`);\n\t\t}\n\t\treturn valid;\n\t}\n\n\t/**\n\t * Show limit error\n\t */\n\tshowLimitError() {\n\t\tthis.elements.fileInput.val('');\n\t\tVtiger_Helper_Js.showPnotify(`${app.vtranslate(\"JS_FILE_LIMIT\")} [${this.options.limit}]`);\n\t}\n\n\t/**\n\t * Get only valid files from list\n\t *\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tfilterValidFiles(files) {\n\t\tif (files.length + this.files.length > this.options.limit) {\n\t\t\tthis.showLimitError();\n\t\t\treturn [];\n\t\t}\n\t\treturn files.filter((file) => {\n\t\t\treturn this.validateFile(file);\n\t\t});\n\t}\n\n\t/**\n\t * Set files hash\n\t * @param {Array} files\n\t * @returns {Array}\n\t */\n\tsetFilesHash(files) {\n\t\tconst addedFiles = [];\n\t\tfor (let i = 0, len = files.length; i < len; i++) {\n\t\t\tconst file = files[i];\n\t\t\tif (typeof file.hash === \"undefined\") {\n\t\t\t\tif (this.files.length < this.options.limit) {\n\t\t\t\t\tfile.hash = App.Fields.Text.generateRandomHash(CONFIG.userId);\n\t\t\t\t\tthis.files.push({hash: file.hash, imageSrc: file.imageSrc, name: file.name, file});\n\t\t\t\t\taddedFiles.push(file);\n\t\t\t\t} else {\n\t\t\t\t\tthis.showLimitError();\n\t\t\t\t\treturn addedFiles;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn addedFiles;\n\t}\n\n\t/**\n\t * Add event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tadd(e, data) {\n\t\tif (data.files.length > 0) {\n\t\t\tdata.submit();\n\t\t}\n\t}\n\n\t/**\n\t * Progressall event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {Object} data\n\t */\n\tprogressAll(e, data) {\n\t\tconst progress = parseInt(data.loaded / data.total * 100, 10);\n\t\tthis.elements.progressBar.css({width: progress + \"%\"});\n\t\tif (progress === 100) {\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.elements.progress.addClass('d-none');\n\t\t\t\tthis.elements.progressBar.css({width: \"0%\"});\n\t\t\t}, 1000);\n\t\t} else {\n\t\t\tthis.elements.progress.removeClass('d-none');\n\t\t}\n\t}\n\n\t/**\n\t * Dragover event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t */\n\tdragOver(e) {\n\t\tthis.elements.component.addClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Dragleave event handler\n\t * @param {Event} e\n\t */\n\tdragLeave(e) {\n\t\tthis.elements.component.removeClass('c-multi-image__drop-effect');\n\t}\n\n\t/**\n\t * Download file according to source type (base64/file from server)\n\t *\n\t * @param {String} hash\n\t */\n\tdownload(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (fileInfo.imageSrc.substr(0, 8).toLowerCase() === 'file.php') {\n\t\t\treturn this.downloadFile(hash);\n\t\t} else {\n\t\t\treturn this.downloadBase64(hash);\n\t\t}\n\t}\n\n\t/**\n\t * Download file that exists on the server already\n\t * @param {String} hash\n\t */\n\tdownloadFile(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = fileInfo.imageSrc;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(fileInfo.imageSrc);\n\t\t}\n\t}\n\n\t/**\n\t * Download file from base64 image\n\t *\n\t * @param {String} hash\n\t */\n\tdownloadBase64(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tconst imageUrl = `data:application/octet-stream;filename=${fileInfo.name};base64,` + fileInfo.imageSrc.split(',')[1];\n\t\tconst link = document.createElement('a');\n\t\t$(link).css('display', 'none');\n\t\tif (typeof link.download === 'string') {\n\t\t\tdocument.body.appendChild(link); // Firefox requires the link to be in the body\n\t\t\tlink.download = fileInfo.name;\n\t\t\tlink.href = imageUrl;\n\t\t\tlink.click();\n\t\t\tdocument.body.removeChild(link); // remove the link when done\n\t\t} else {\n\t\t\tlocation.replace(imageUrl);\n\t\t}\n\t}\n\n\t/**\n\t * Display modal window with large preview\n\t *\n\t * @param {string} hash\n\t */\n\tzoomPreview(hash) {\n\t\tconst thisInstance = this;\n\t\tlet fileInfo = this.getFileInfo(hash);\n\t\tconst titleTemplate = () => `<i class=\"fa fa-image\"></i> ${fileInfo.name}`;\n\t\tconst bootboxOptions = {\n\t\t\tsize: 'large',\n\t\t\tbackdrop: true,\n\t\t\tonEscape: true,\n\t\t\ttitle: `<span id=\"bootbox-title-${hash}\" class=\"animated ${this.options.zoomTitleAnimation.in}\">${titleTemplate()}</span>`,\n\t\t\tmessage: `<img src=\"${fileInfo.imageSrc}\" class=\"w-100\" />`,\n\t\t\tbuttons: {}\n\t\t};\n\t\tif (this.options.showCarousel) {\n\t\t\tbootboxOptions.message = this.generateCarousel(hash);\n\t\t}\n\t\tif (!this.detailView) {\n\t\t\tbootboxOptions.buttons.Delete = {\n\t\t\t\tlabel: `<i class=\"fa fa-trash-alt\"></i> ${app.vtranslate('JS_DELETE')}`,\n\t\t\t\tclassName: \"float-left btn btn-danger\",\n\t\t\t\tcallback() {\n\t\t\t\t\tthisInstance.deleteFile(fileInfo.hash);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tbootboxOptions.buttons.Download = {\n\t\t\tlabel: `<i class=\"fa fa-download\"></i> ${app.vtranslate('JS_DOWNLOAD')}`,\n\t\t\tclassName: \"float-left btn btn-success\",\n\t\t\tcallback() {\n\t\t\t\tthisInstance.download(fileInfo.hash);\n\t\t\t}\n\t\t};\n\t\tbootboxOptions.buttons.Close = {\n\t\t\tlabel: `<i class=\"fa fa-times\"></i> ${app.vtranslate('JS_CLOSE')}`,\n\t\t\tclassName: \"btn btn-warning\",\n\t\t\tcallback: () => {\n\t\t\t},\n\t\t};\n\t\tbootbox.dialog(bootboxOptions);\n\t\tif (this.options.showCarousel) {\n\t\t\t$(`#bootbox-title-${hash}`).css({\n\t\t\t\t'animation-duration': '350ms'\n\t\t\t})\n\t\t\t$(`#carousel-${hash}`).on('slide.bs.carousel', (e) => {\n\t\t\t\tfileInfo = this.getFileInfo($(e.relatedTarget).data('hash'));\n\t\t\t\tconst aniIn = this.options.zoomTitleAnimation.in;\n\t\t\t\tconst aniOut = this.options.zoomTitleAnimation.out;\n\t\t\t\t$(`#bootbox-title-${hash}`).animateCss(aniOut, () => {\n\t\t\t\t\t$(`#bootbox-title-${hash}`).html(titleTemplate()).removeClass('animated ' + aniOut).animateCss(aniIn);\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Remove file from preview and from file list\n\t *\n\t * @param {String} hash\n\t */\n\tdeleteFileCallback(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tfileInfo.previewElement.popover('dispose').remove();\n\t\tthis.files = this.files.filter(file => file.hash !== fileInfo.hash);\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Delete image from input field\n\t * Should be called with this pointing on button element with data-hash attribute\n\t *\n\t * @param {string} hash\n\t * @param {boolean} showConfirmation - dialog?\n\t */\n\tdeleteFile(hash, showConfirmation = true) {\n\t\tif (showConfirmation) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\tbootbox.confirm({\n\t\t\t\ttitle: `<i class=\"fa fa-trash-alt\"></i> ${app.vtranslate(\"JS_DELETE_FILE\")}`,\n\t\t\t\tmessage: `${app.vtranslate(\"JS_DELETE_FILE_CONFIRMATION\")} <span class=\"font-weight-bold\">${fileInfo.name}</span>?`,\n\t\t\t\tcallback: (result) => {\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tthis.deleteFileCallback(hash);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\tthis.deleteFileCallback(hash);\n\t\t}\n\t}\n\n\t/**\n\t * File change event handler from jQuery-file-upload\n\t *\n\t * @param {Event} e\n\t * @param {object} data\n\t */\n\tchange(e, data) {\n\t\tdata.files = this.filterValidFiles(data.files);\n\t\tdata.files = this.setFilesHash(data.files);\n\t\tthis.dragLeave(e);\n\t\tif (data.files.length) {\n\t\t\tthis.generatePreviewElements(data.files, (element) => {\n\t\t\t\tthis.redraw();\n\t\t\t});\n\t\t}\n\t}\n\n\t/**\n\t * Generate and apply popover to preview\n\t *\n\t * @param {File} file\n\t * @param {string} template\n\t * @param {string} imageSrc\n\t * @returns {jQuery}\n\t */\n\taddPreviewPopover(file, template, imageSrc) {\n\t\tconst thisInstance = this;\n\t\tlet fileSize = '';\n\t\tconst fileInfo = this.getFileInfo(file.hash);\n\t\tif (typeof fileInfo.size !== \"undefined\") {\n\t\t\tfileSize = `<div class=\"p-1 bg-white border rounded small position-absolute\">${fileInfo.size}</div>`;\n\t\t}\n\t\tlet deleteBtn = '';\n\t\tif (!this.detailView) {\n\t\t\tdeleteBtn = `<button class=\"btn btn-sm btn-danger c-btn-collapsible js-multi-image__popover-btn-delete\" type=\"button\" data-hash=\"${file.hash}\" data-js=\"click\"><i class=\"fa fa-trash-alt\"></i> <span>${app.vtranslate('JS_DELETE')}</span></button>`;\n\t\t}\n\t\treturn $(template).popover({\n\t\t\tcontainer: thisInstance.elements.component,\n\t\t\ttitle: `<div class=\"u-text-ellipsis\"><i class=\"fa fa-image\"></i> ${file.name}</div>`,\n\t\t\thtml: true,\n\t\t\ttrigger: 'focus',\n\t\t\tplacement: 'top',\n\t\t\tcontent: `<img src=\"${imageSrc}\" class=\"w-100 js-multi-image__popover-img c-multi-image__popover-img\" data-hash=\"${file.hash}\" data-js=\"click\"/>`,\n\t\t\ttemplate: `<div class=\"popover\" role=\"tooltip\">\n\t\t\t\t<div class=\"arrow\"></div>\n\t\t\t\t<h3 class=\"popover-header\"></h3>\n\t\t\t\t<div class=\"popover-body\"></div>\n\t\t\t\t<div class=\"text-right popover-footer js-multi-image__popover-actions\">\n\t\t\t\t\t${fileSize}\n\t\t\t\t\t${deleteBtn}\n\t\t\t\t\t<button class=\"btn btn-sm btn-success c-btn-collapsible js-multi-image__popover-btn-download\" type=\"button\" data-hash=\"${file.hash}\" data-js=\"click\"><i class=\"fa fa-download\"></i> <span>${app.vtranslate('JS_DOWNLOAD')}</span></button>\n\t\t\t\t\t<button class=\"btn btn-sm btn-primary c-btn-collapsible js-multi-image__popover-btn-zoom\" type=\"button\" data-hash=\"${file.hash}\" data-js=\"click\"><i class=\"fa fa-search-plus\"></i> <span>${app.vtranslate('JS_ZOOM_IN')}</span></button>\n\t\t\t\t</div>\n\t\t\t</div>`\n\t\t});\n\t}\n\n\t/**\n\t * Remove preview popover\n\t *\n\t * @param {String} hash\n\t */\n\tremovePreviewPopover(hash) {\n\t\tconst fileInfo = this.getFileInfo(hash);\n\t\tif (typeof fileInfo.previewElement !== \"undefined\") {\n\t\t\tfileInfo.previewElement.popover('dispose');\n\t\t}\n\t}\n\n\t/**\n\t * Hide popovers when user starts moving file preview\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortOver(e, ui) {\n\t\tthis.elements.result.find('.js-multi-image__preview').popover('hide');\n\t}\n\n\t/**\n\t * Update file position according to elements order\n\t *\n\t * @param {Event} e\n\t * @param {Object} ui\n\t */\n\tsortStop(e, ui) {\n\t\tconst actualElements = this.elements.result.find('.js-multi-image__preview').toArray();\n\t\tthis.files = actualElements.map((element) => {\n\t\t\tfor (let i = 0, len = this.files.length; i < len; i++) {\n\t\t\t\tconst elementHash = $(element).data('hash');\n\t\t\t\tif (this.files[i].hash === elementHash) {\n\t\t\t\t\treturn this.files[i];\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\tthis.redraw();\n\t}\n\n\t/**\n\t * Redraw view according to in-memory positions\n\t */\n\tredraw() {\n\t\tthis.files.forEach((file) => {\n\t\t\tthis.elements.result.append(file.previewElement);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Enable drag and drop files repositioning\n\t */\n\tenableDragNDrop() {\n\t\tthis.elements.result.sortable({\n\t\t\thandle: '.js-multi-image__preview-img',\n\t\t\titems: '.js-multi-image__preview',\n\t\t\tover: this.sortOver.bind(this),\n\t\t\tstop: this.sortStop.bind(this),\n\t\t}).disableSelection().on('mousedown', '.js-multi-image__preview-img', function (e) {\n\t\t\tthis.focus(); // focus to show popover\n\t\t});\n\t}\n\n\t/**\n\t * Generate preview of images and append to multi image results view\n\t *\n\t * @param {Array} files - array of Files\n\t * @param {function} callback\n\t */\n\tgeneratePreviewElements(files, callback) {\n\t\tfiles.forEach((file) => {\n\t\t\tif (file instanceof File) {\n\t\t\t\tthis.generatePreviewFromFile(file, (template, imageSrc) => {\n\t\t\t\t\tfile.preview = this.addPreviewPopover(file, template, imageSrc);\n\t\t\t\t\tthis.addFileInfoProperty(file.hash, 'previewElement', file.preview);\n\t\t\t\t\tcallback(file.preview);\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.generatePreviewFromValue(file, (template, imageSrc) => {\n\t\t\t\t\tfile.preview = this.addPreviewPopover(file, template, imageSrc);\n\t\t\t\t\tthis.addFileInfoProperty(file.hash, 'previewElement', file.preview);\n\t\t\t\t\tcallback(file.preview);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\t/**\n\t * Generate preview of image as html string\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromFile(file, callback) {\n\t\tconst fr = new FileReader();\n\t\tfr.onload = () => {\n\t\t\tfile.imageSrc = fr.result;\n\t\t\tthis.addFileInfoProperty(file.hash, 'imageSrc', file.imageSrc);\n\t\t\tcallback(`<div class=\"d-inline-block mr-1 js-multi-image__preview\" id=\"js-multi-image__preview-hash-${file.hash}\" data-hash=\"${file.hash}\" data-js=\"container|click\">\n\t\t\t\t\t<div class=\"img-thumbnail js-multi-image__preview-img c-multi-image__preview-img\" data-hash=\"${file.hash}\" data-js=\"drag\" style=\"background-image:url(${fr.result})\" tabindex=\"0\" title=\"${file.name}\"></div>\n\t\t\t</div>`, fr.result);\n\t\t};\n\t\tfr.readAsDataURL(file);\n\t}\n\n\n\t/**\n\t * Generate preview of image as html string from existing values\n\t *\n\t * @param {File} file\n\t * @param {function} callback\n\t */\n\tgeneratePreviewFromValue(file, callback) {\n\t\tcallback(`<div class=\"d-inline-block mr-1 js-multi-image__preview\" id=\"js-multi-image__preview-hash-${file.hash}\" data-hash=\"${file.hash}\" data-js=\"container|click\">\n\t\t\t\t<div class=\"img-thumbnail js-multi-image__preview-img c-multi-image__preview-img\" data-hash=\"${file.hash}\" data-js=\"drag\" style=\"background-image:url(${file.imageSrc})\" tabindex=\"0\" title=\"${file.name}\"></div>\n\t\t</div>`, file.imageSrc);\n\t}\n\n\t/**\n\t * Load files that were in valueInput as json string\n\t */\n\tloadExistingFiles() {\n\t\tthis.files = this.files.map((file) => {\n\t\t\tfile.hash = App.Fields.Text.generateRandomHash(CONFIG.userId);\n\t\t\treturn file;\n\t\t}).slice(0, this.options.limit);\n\t\tthis.generatePreviewElements(this.files, (element) => {\n\t\t\tthis.elements.result.append(element);\n\t\t});\n\t\tthis.updateFormValues();\n\t}\n\n\t/**\n\t * Generate carousel for all files in large preview\n\t *\n\t * @param {String} hash\n\t */\n\tgenerateCarousel(hash) {\n\t\tif (this.files.length <= 1) {\n\t\t\tconst fileInfo = this.getFileInfo(hash);\n\t\t\treturn `<img class=\"d-block w-100\" src=\"${fileInfo.imageSrc}\">`;\n\t\t}\n\t\tlet template = `<div id=\"carousel-${hash}\" class=\"carousel slide c-carousel\" data-ride=\"carousel\" data-js=\"container\">\n\t\t  <div class=\"carousel-inner\">`;\n\t\tthis.files.forEach((file) => {\n\t\t\ttemplate += `<div class=\"carousel-item c-carousel__item`;\n\t\t\tif (file.hash === hash) {\n\t\t\t\ttemplate += ` active`;\n\t\t\t}\n\t\t\ttemplate += `\" data-hash=\"${file.hash}\">\n\t\t      <img class=\"d-block w-100 c-carousel__image\" src=\"${file.imageSrc}\">\n\t\t    </div>`;\n\t\t});\n\t\ttemplate += `<a class=\"carousel-control-prev c-carousel__prevnext-btn c-carousel__prev-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"prev\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-left fa-2x c-carousel__prev-icon\" data-fa-transform=\"left-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t  <a class=\"carousel-control-next c-carousel__prevnext-btn c-carousel__next-btn\" href=\"#carousel-${hash}\" role=\"button\" data-slide=\"next\" data-js=\"click\">\n\t\t    <span class=\"fas fa-caret-right fa-2x c-carousel__next-icon\" data-fa-transform=\"right-1\" aria-hidden=\"true\"></span>\n\t\t  </a>\n\t\t</div>`;\n\t\treturn template;\n\t}\n\n}\n"],"names":["element","elements","options","zoomTitleAnimation","in","out","showCarousel","detailView","fileInput","$","find","eq","length","component","form","closest","on","onFormSubmit","addButton","values","progressBar","progress","result","fieldInfo","data","formats","limit","files","JSON","parse","val","detach","click","addButtonClick","bind","fileupload","dataType","replaceFileInput","autoUpload","submit","add","progressall","progressAll","change","drop","dragover","dragOver","fail","uploadError","done","uploadSuccess","dragLeave","enableDragNDrop","thisInstance","zoomPreview","e","preventDefault","download","deleteFile","loadExistingFiles","fn","animateCss","extend","animationName","callback","el","animation","OAnimation","MozAnimation","WebkitAnimation","style","t","document","createElement","addClass","one","animationEnd","removeClass","App","Fields","MultiImage","currentFileUploads","stopPropagation","stopImmediatePropagation","bootbox","alert","app","vtranslate","trigger","formData","hash","i","len","file","errorLog","Vtiger_Helper_Js","showPnotify","text","propertyName","value","getFileInfo","fileInfo","jqXHR","responseJSON","attach","Array","isArray","response","forEach","fileAttach","error","name","updateFormValues","key","addFileInfoProperty","size","removePreviewPopover","addPreviewPopover","previewElement","imageSrc","map","stringify","formValues","format","type","valid","join","showLimitError","filter","validateFile","addedFiles","Text","generateRandomHash","CONFIG","userId","push","parseInt","loaded","total","css","width","setTimeout","substr","toLowerCase","downloadFile","downloadBase64","link","body","appendChild","href","removeChild","location","replace","imageUrl","split","titleTemplate","bootboxOptions","backdrop","onEscape","title","message","buttons","generateCarousel","Delete","label","className","Download","Close","dialog","relatedTarget","aniOut","html","aniIn","popover","remove","showConfirmation","confirm","deleteFileCallback","filterValidFiles","setFilesHash","generatePreviewElements","redraw","template","fileSize","deleteBtn","container","placement","content","actualElements","toArray","elementHash","append","sortable","handle","items","over","sortOver","stop","sortStop","disableSelection","focus","generatePreviewFromFile","preview","generatePreviewFromValue","fr","onload","readAsDataURL","slice"],"mappings":"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"}