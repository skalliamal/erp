'use strict';

var Vtiger_CustomView_Js;Vtiger_CustomView_Js={init:function a(){return this},contentsCotainer:!1,columnListSelect2Element:!1,advanceFilterInstance:!1,columnSelectElement:!1,selectedColumnsList:!1,loadFilterView:function c(a){var b=$.progressIndicator();AppConnector.request(a).done(function(a){app.hideModalWindow();var c=$('.contentsDiv').html(a);b.progressIndicator({mode:'hide'}),Vtiger_CustomView_Js.registerEvents(),Vtiger_CustomView_Js.advanceFilterInstance=Vtiger_AdvanceFilter_Js.getInstance($('.filterContainer',c));});},loadDateFilterValues:function d(){var a=$('#standardDateFilter option:selected'),b=a.data('currentdate'),c=a.data('enddate');$('#standardFilterCurrentDate').val(b),$('#standardFilterEndDate').val(c);},getContentsContainer:function a(){return !1==Vtiger_CustomView_Js.contentsCotainer&&(Vtiger_CustomView_Js.contentsCotainer=$('div.contentsDiv')),Vtiger_CustomView_Js.contentsCotainer},getColumnListSelect2Element:function a(){return Vtiger_CustomView_Js.columnListSelect2Element},getColumnSelectElement:function a(){return !1==Vtiger_CustomView_Js.columnSelectElement&&(Vtiger_CustomView_Js.columnSelectElement=$('#viewColumnsSelect')),Vtiger_CustomView_Js.columnSelectElement},getSelectedColumnsList:function a(){return !1==Vtiger_CustomView_Js.selectedColumnsList&&(Vtiger_CustomView_Js.selectedColumnsList=$('#selectedColumnsList')),Vtiger_CustomView_Js.selectedColumnsList},getSelectedColumns:function b(){var a=Vtiger_CustomView_Js.getColumnSelectElement();return a.val()},saveFilter:function c(){var a=$.Deferred(),b=$('#CustomView').serializeFormData();return AppConnector.request(b,!0).done(function(b){a.resolve(b);}).fail(function(b){a.reject(b);}),a.promise()},saveAndViewFilter:function a(){Vtiger_CustomView_Js.saveFilter().done(function(a){if(a.success){var b;b='Settings'==app.getParentModuleName()?'index.php?module=CustomView&parent=Settings&view=Index&sourceModule='+$('#sourceModule').val():a.result.listviewurl,window.location.href=b;}else{$.unblockUI();var c={title:app.vtranslate('JS_DUPLICATE_RECORD'),text:a.error.message};Vtiger_Helper_Js.showPnotify(c);}});},registerIconEvents:function b(){var a=this.getContentsContainer();a.on('change','.iconPreferences input',function(a){var b=$(a.currentTarget),c=b.closest('.btn'),d=b.next();b.prop('checked')?(c.removeClass('btn-default').addClass('btn-primary'),d.removeClass(d.data('unchecked')).addClass(d.data('check'))):(c.removeClass('btn-primary').addClass('btn-default'),d.removeClass(d.data('check')).addClass(d.data('unchecked')));}),a.find('.iconPreferences input').each(function(){$(this).trigger('change');});},registerBlockToggleEvent:function b(){var a=this.getContentsContainer();a.on('click','.blockHeader',function(a){var b=$(a.currentTarget),c=b.next(),d=b.find('.iconToggle');c.hasClass('d-none')?(c.removeClass('d-none'),d.removeClass(d.data('hide')).addClass(d.data('show'))):(c.addClass('d-none'),d.removeClass(d.data('show')).addClass(d.data('hide')));});},registerColorEvent:function d(){var a=this.getContentsContainer(),b=a.find('.colorPicker'),c=b.parent().find('.input-group-addon');b.colorpicker().on('changeColor',function(a){var b=a.color.toHex();c.css('background-color',b);});},registerEvents:function b(){this.registerIconEvents(),new App.Fields.Text.Editor(this.getContentsContainer().find('.js-editor')),this.registerBlockToggleEvent(),this.registerColorEvent();var a=App.Fields.Picklist.showSelect2ElementView(Vtiger_CustomView_Js.getColumnSelectElement());$('.stndrdFilterDateSelect').datepicker(),$('.chzn-select').chosen(),$('#standardDateFilter').on('change',function(){Vtiger_CustomView_Js.loadDateFilterValues();}),$('#CustomView').on('submit',function(b){var c=Vtiger_CustomView_Js.getColumnSelectElement();if(40<$('#viewname').val().length){var d={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_VIEWNAME_ALERT')};return Vtiger_Helper_Js.showPnotify(d),void b.preventDefault()}var e=JSON.parse($('#mandatoryFieldsList').val()),f=c.val(),g=!0;if(f)for(var h=0;h<f.length;h++)if(0<=$.inArray(f[h],e)){g=!1;break}if(g){var j=app.vtranslate('JS_PLEASE_SELECT_ATLEAST_ONE_MANDATORY_FIELD');return a.validationEngine('showPrompt',j,'error','topLeft',!0),void b.preventDefault()}a.validationEngine('hide');var k=$(b.currentTarget).validationEngine('validate');if(!0==k){var l={};''!=$('#standardFilterCurrentDate').val()&&''!=$('#standardFilterEndDate').val()&&'none'!=$('select.standardFilterColumn option:selected').val()&&(l.columnname=$('select.standardFilterColumn option:selected').val(),l.stdfilter=$('select#standardDateFilter option:selected').val(),l.startdate=$('#standardFilterCurrentDate').val(),l.enddate=$('#standardFilterEndDate').val(),$('#stdfilterlist').val(JSON.stringify(l)));var m=Vtiger_CustomView_Js.advanceFilterInstance.getValues();return $('#advfilterlist').val(JSON.stringify(m)),$('input[name="columnslist"]',Vtiger_CustomView_Js.getContentsContainer()).val(JSON.stringify(Vtiger_CustomView_Js.getSelectedColumns())),Vtiger_CustomView_Js.saveAndViewFilter(),!1}app.formAlignmentAfterValidation($(b.currentTarget));}),$('#CustomView').validationEngine(app.validationEngineOptions);}},$(document).ready(function(){Vtiger_CustomView_Js.init();});
//# sourceMappingURL=CustomView.min.js.map
