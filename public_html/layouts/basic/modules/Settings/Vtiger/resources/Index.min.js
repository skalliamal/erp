'use strict';

$.Class('Settings_Vtiger_Index_Js',{showMessage:function c(a){var b={type:'success',title:app.vtranslate('JS_MESSAGE')};'undefined'!=typeof a&&(b=$.extend(b,a)),Vtiger_Helper_Js.showPnotify(b);},selectIcon:function b(){var a=$.Deferred();return app.showModalWindow({id:'iconsModal',url:'index.php?module=Vtiger&view=IconsModal&parent=Settings',cb:function c(b){App.Fields.Picklist.showSelect2ElementView(b.find('#iconsList'),{templateSelection:function d(a){if(!a.id)return a.text;var c=$(a.element).data('type');return b.find('.iconName').text(a.id),b.find('#iconName').val(a.id),b.find('#iconType').val(c),'icon'===c?b.find('.iconExample').html('<span class="'+a.element.value+'" aria-hidden="true"></span>'):'image'===c&&(b.find('.iconName').text(a.text),b.find('#iconName').val(a.element.value),b.find('.iconExample').html('<img width="24px" src="'+a.element.value+'"/>')),a.text},templateResult:function d(a){if(!a.id)return a.text;var b,c=$(a.element).data('type');return 'icon'===c?b=$('<span class="'+a.element.value+'" aria-hidden="true"></span><span> - '+$(a.element).data('class')+'</span>'):'image'===c&&(b=$('<img width="24px" src="'+a.element.value+'" title="'+a.text+'" /><span> - '+a.text+'</span>')),b},closeOnSelect:!0}),b.find('[name="saveButton"]').on('click',function(){a.resolve({type:b.find('#iconType').val(),name:b.find('#iconName').val()}),app.hideModalWindow(b,'iconsModal');});}}),a.promise()},showWarnings:function a(){$('li[data-mode="systemWarnings"] a').click();},showSecurity:function a(){$('li[data-mode="security"] a').click();}},{registerDeleteShortCutEvent:function c(a){var b=this;'undefined'==typeof a&&(a=$('div#settingsShortCutsContainer')),a.on('click','.unpin',function(a){var c=$(a.currentTarget),d=c.closest('.moduleBlock'),e=c.data('id'),f=d.data('actionurl'),g=$.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request(f+'&pin=false').done(function(a){if('OK'==a.result.SUCCESS){d.remove(),b.registerSettingShortCutAlignmentEvent();var c=$('#'+e+'_menuItem'),f=c.data('pinimageurl');c.attr('src',f).data('action','pin'),g.progressIndicator({mode:'hide'});var h={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_SUCCESSFULLY_UNPINNED'),type:'info'};b.registerReAlign(),Vtiger_Helper_Js.showPnotify(h);}}),a.stopPropagation();});},registerPinShortCutEvent:function e(a){var b=this,c=a.data('id'),d=$.progressIndicator({blockInfo:{enabled:!0}});AppConnector.request('index.php?module=Vtiger&parent=Settings&action=Basic&mode=updateFieldPinnedStatus&pin=true&fieldid='+c).done(function(a){if('OK'==a.result.SUCCESS){AppConnector.request({fieldid:c,mode:'getSettingsShortCutBlock',module:'Vtiger',parent:'Settings',view:'IndexAjax'}).done(function(a){var c=$('#settingsShortCutsContainer'),e=$('#settingsShortCutsContainer div.row:last'),f=$('#settingsShortCutsContainer div.row:last').children('div').length;if(3==f)var g=$('#settingsShortCutsContainer').append('<div class="row">'+a);else var g=$(a).appendTo(e);b.registerSettingShortCutAlignmentEvent(),d.progressIndicator({mode:'hide'});var h={text:app.vtranslate('JS_SUCCESSFULLY_PINNED')};Settings_Vtiger_Index_Js.showMessage(h);});}});},registerSettingsShortcutClickEvent:function a(){$('#settingsShortCutsContainer').on('click','.moduleBlock',function(a){var b=$(a.currentTarget).data('url');window.location.href=b;});},registerSettingShortCutAlignmentEvent:function a(){$('#settingsShortCutsContainer').find('.moduleBlock').removeClass('marginLeftZero'),$('#settingsShortCutsContainer').find('.moduleBlock:nth-child(3n+1)').addClass('marginLeftZero');},registerWidgetsEvents:function b(){var a=$('div.widgetContainer');a.on('shown.bs.collapse',function(a){var b=$(a.currentTarget),c=b.closest('.quickWidget').find('.quickWidgetHeader'),d=c.find('.imageElement'),e=d.data('downimage');d.attr('src',e);}),a.on('hidden.bs.collapse',function(a){var b=$(a.currentTarget),c=b.closest('.quickWidget').find('.quickWidgetHeader'),d=c.find('.imageElement'),e=d.data('rightimage');d.attr('src',e);});},registerAddShortcutDragDropEvent:function c(){var a=this,b=$('.subMenu .menuShortcut a');b.draggable({containment:'#page',appendTo:'body',helper:'clone',start:function c(a,b){$(b.helper).addClass('ui-draggable-menuShortcut bg-primary');},zIndex:99999}),$('#settingsShortCutsContainer').droppable({activeClass:'ui-state-default',hoverClass:'ui-state-hover',accept:'.subMenu .menuShortcut a',drop:function g(b,c){var d=c.draggable.attr('href'),e=!1;if($('#settingsShortCutsContainer [id^="shortcut"]').each(function(){var a=$(this).data('url');if(a==d)return void(e=!0)}),e){var f={title:app.vtranslate('JS_MESSAGE'),text:app.vtranslate('JS_SHORTCUT_ALREADY_ADDED'),type:'info'};Vtiger_Helper_Js.showPnotify(f);}else a.registerPinShortCutEvent(c.draggable.parent()),a.registerSettingShortCutAlignmentEvent();}});},registerReAlign:function a(){AppConnector.request({mode:'realignSettingsShortCutBlock',module:'Vtiger',parent:'Settings',view:'IndexAjax'}).done(function(a){$('#settingsShortCutsContainer').html(a);});},loadEditorElement:function a(){new App.Fields.Text.Editor($('.js-editor'),{});},registerSaveIssues:function f(){var a=$('.addIssuesModal');a.validationEngine(app.validationEngineOptions);var b=$('#titleIssues'),c=CKEDITOR.instances.bodyIssues,d=this,e=a.find('.saveIssues');e.on('click',function(){if(a.validationEngine('validate')){var e=c.document.getBody().getHtml(),f={module:'Github',parent:app.getParentModuleName(),action:'SaveIssuesAjax',title:b.val(),body:e};AppConnector.request(f).done(function(a){if(app.hideModalWindow(),d.reloadContent(),!0==a.result.success){var b={title:app.vtranslate('JS_LBL_PERMISSION'),text:app.vtranslate('JS_ADDED_ISSUE_COMPLETE'),type:'success'};Vtiger_Helper_Js.showMessage(b);}});}}),$('[name="confirmRegulations"]').on('click',function(){var a=$(this);a.is(':checked')?e.removeAttr('disabled'):e.attr('disabled','disabled');});},reloadContent:function a(){$('.js-tabs li .active').trigger('click');},resisterSaveKeys:function d(a){var b=this,c=a.find('.authModalContent');c.validationEngine(app.validationEngineOptions),c.find('.saveKeys').on('click',function(){if(c.validationEngine('validate')){var a={module:'Github',parent:app.getParentModuleName(),action:'SaveKeysAjax',username:$('[name="username"]').val(),client_id:$('[name="client_id"]').val(),token:$('[name="token"]').val()};c.progressIndicator({}),AppConnector.request(a).done(function(a){if(c.progressIndicator({mode:'hide'}),!1==a.result.success){var d=c.find('.errorMsg');d.removeClass('d-none'),d.html(app.vtranslate('JS_ERROR_KEY'));}else{app.hideModalWindow(),b.reloadContent();var e={title:app.vtranslate('JS_LBL_PERMISSION'),text:app.vtranslate('JS_AUTHORIZATION_COMPLETE'),type:'success'};Vtiger_Helper_Js.showMessage(e);}}).fail(function(){c.progressIndicator({mode:'hide'}),app.hideModalWindow();});}});},registerTabEvents:function b(){var a=this;$('.js-tabs li').on('click',function(){a.loadContent($(this).data('mode'),!1,$(this).data('params'));});},registerPagination:function c(){var a=$('.pagination .pageNumber'),b=this;a.on('click',function(){b.loadContent('github',$(this).data('id'));});},registerAuthorizedEvent:function b(){var a=this;$('.showModal').on('click',function(){app.showModalWindow($('.authModal'),function(b){a.resisterSaveKeys(b);});});},registerGithubEvents:function c(a){var b=this;b.registerAuthorizedEvent(),b.registerPagination(),a.find('.js-switch--state, .js-switch--author').on('change',function(){b.loadContent('github',1);}),$('.addIssuesBtn').on('click',function(){var c={module:'Github',parent:app.getParentModuleName(),view:'AddIssue'};a.progressIndicator({}),AppConnector.request(c).done(function(c){a.progressIndicator({mode:'hide'}),app.showModalWindow(c,function(){b.loadEditorElement(),b.registerSaveIssues();});});});},registerWarningsAlert:function b(){var a=$('#systemWarningAletrs');a.length&&app.showModalWindow(a,function(){a.find('.warning').first().removeClass('d-none'),a.find('.warning .btn').on('click',function(){var b=$(this),c=!0;if(b.hasClass('ajaxBtn')){if(b.data('params')==null){var d=b.closest('form');d.hasClass('validateForm')&&!d.validationEngine('validate')&&(c=!1);var e=b.closest('form').serializeArray().reduce(function(a,b){return a[b.name]=b.value,a},{});}else var e=b.data('params');c&&AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SystemWarnings',mode:'update',id:b.closest('.warning').data('id'),params:e}).done(function(a){a.result.result?Vtiger_Helper_Js.showMessage({text:a.result.message,type:'success'}):Vtiger_Helper_Js.showMessage({text:a.result.message,type:'error'});});}b.hasClass('cancel')&&AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SystemWarnings',mode:'cancel'}),c&&(a.find('.warning').first().remove(),a.find('.warning').length?a.find('.warning').first().removeClass('d-none'):app.hideModalWindow(a));}),a.find('.input-group-addon input[type="checkbox"]').on('click',function(){var a=$(this),b=a.closest('.input-group');this.checked?b.find('input[type="text"]').attr('disabled',!1):b.find('input[type="text"]').attr('disabled',!0);});});},registerSystemWarningsEvents:function c(a){var b=this;b.registerWarningsFolders(a);},registerWarningsFolders:function e(a){var b=this,c=[],d=a.find('#treeValues').val();d&&(c=JSON.parse(d)),a.find('#jstreeContainer').jstree({core:{data:c,themes:{name:'proton',responsive:!0,icons:!1},check_callback:!0},plugins:['checkbox']}).on('loaded.jstree',function(){$(this).jstree('open_all');}).on('changed.jstree',function(a,c){'model'!=c.action&&b.getWarningsList();}),$.extend($.fn.dataTable.defaults,{language:{sLengthMenu:app.vtranslate('JS_S_LENGTH_MENU'),sZeroRecords:app.vtranslate('JS_NO_RESULTS_FOUND'),sInfo:app.vtranslate('JS_S_INFO'),sInfoEmpty:app.vtranslate('JS_S_INFO_EMPTY'),sSearch:app.vtranslate('JS_SEARCH'),sEmptyTable:app.vtranslate('JS_NO_RESULTS_FOUND'),sInfoFiltered:app.vtranslate('JS_S_INFO_FILTERED'),sLoadingRecords:app.vtranslate('JS_LOADING_OF_RECORDS'),sProcessing:app.vtranslate('JS_LOADING_OF_RECORDS'),oPaginate:{sFirst:app.vtranslate('JS_S_FIRST'),sPrevious:app.vtranslate('JS_S_PREVIOUS'),sNext:app.vtranslate('JS_S_NEXT'),sLast:app.vtranslate('JS_S_LAST')},oAria:{sSortAscending:app.vtranslate('JS_S_SORT_ASCENDING'),sSortDescending:app.vtranslate('JS_S_SORT_DESCENDING')}}}),a.find('.js-switch--warnings').on('change',function(){b.getWarningsList();});},getWarningsList:function f(){var a=this,b=a.getSelectedFolders(),c=$('#warningsContent'),d=$.progressIndicator({message:app.vtranslate('JS_LOADING_OF_RECORDS'),blockInfo:{enabled:!0}}),e=$('.warningsIndexPage .js-switch--warnings').first().is(':checked');AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),view:'Index',mode:'getWarningsList',active:e,folder:b}).done(function(b){c.html(b),a.registerWarningsList(c),d.progressIndicator({mode:'hide'});}).fail(function(){d.progressIndicator({mode:'hide'});});},registerWarningsList:function c(a){var b=this;a.find('table').dataTable({order:[[2,'desc']]}),app.showPopoverElementView(a.find('.js-popover-tooltip')),a.find('.showDescription').on('click',function(){var a=$(this).closest('td').find('.showDescriptionContent').html();app.showModalWindow(a);}),a.find('.setIgnore').on('click',function(){a.find('.js-popover-tooltip').popover('hide');var c=$(this).closest('tr').data();AppConnector.request({module:app.getModuleName(),parent:app.getParentModuleName(),action:'SystemWarnings',mode:'update',id:c.id,params:c.status}).done(function(){b.getWarningsList(a);});});},getSelectedFolders:function b(){var a=[];return $.each($('#jstreeContainer').jstree('get_selected',!0),function(b,c){a.push(c.original.subPath);}),a},loadContent:function j(a,b,c){var d=this,e=$('.indexContainer'),f=e.find('.js-switch--state'),g=e.find('.js-switch--author'),h={mode:a,module:app.getModuleName(),parent:app.getParentModuleName(),view:'Index'};b&&(h.page=b),c&&(h.params=c),h.state=f.last().is(':checked')?'closed':'open',h.author=g.first().is(':checked');var i=$.progressIndicator({position:'html',blockInfo:{enabled:!0,elementToBlock:e}});AppConnector.request(h).done(function(b){i.progressIndicator({mode:'hide'}),e.html(b),'index'==a?(d.registerSettingsShortcutClickEvent(),d.registerDeleteShortCutEvent(),d.registerWidgetsEvents(),d.registerAddShortcutDragDropEvent(),d.registerSettingShortCutAlignmentEvent(),d.registerWarningsAlert()):'github'==a?d.registerGithubEvents(e):'systemWarnings'==a?d.registerSystemWarningsEvents(e):'security'==a&&app.showPopoverElementView(e.find('.js-popover-tooltip'));});},registerEvents:function a(){this.registerTabEvents(),this.reloadContent();}});
//# sourceMappingURL=Index.min.js.map
