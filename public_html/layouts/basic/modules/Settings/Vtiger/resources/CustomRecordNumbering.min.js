'use strict';

jQuery.Class('Settings_CustomRecordNumbering_Js',{},{form:!1,getForm:function a(){return !1==this.form&&(this.form=jQuery('#EditView')),this.form},registerOnChangeEventOfSourceModule:function b(){var a=this.getForm();a.find('[name="sourceModule"]').on('change',function(b){jQuery('.saveButton').removeAttr('disabled');var c=jQuery(b.currentTarget),d={},e=c.val();d={module:app.getModuleName(),parent:app.getParentModuleName(),action:'CustomRecordNumberingAjax',mode:'getModuleCustomNumberingData',sourceModule:e},AppConnector.request(d).done(function(b){b&&(a.find('[name="prefix"]').val(b.result.prefix),a.find('[name="postfix"]').val(b.result.postfix),a.find('[name="sequenceNumber"]').val(b.result.sequenceNumber),a.find('[name="sequenceNumber"]').data('oldSequenceNumber',b.result.sequenceNumber));});});},saveModuleCustomNumbering:function o(){if(!jQuery('.saveButton').attr('disabled')){var a=this.getForm(),b={},c=a.find('[name="sourceModule"]').val(),d=a.find('option[value="'+c+'"]').text(),e=a.find('[name="prefix"]'),f=jQuery.trim(e.val()),g=e.data('oldPrefix'),h=a.find('[name="postfix"]'),i=jQuery.trim(h.val()),j=h.data('oldPostfix'),k=a.find('[name="sequenceNumber"]'),l=k.val(),m=k.data('oldSequenceNumber');if(l<m&&f==g&&i==j){var n=app.vtranslate('JS_SEQUENCE_NUMBER_MESSAGE')+' '+m;return void k.validationEngine('showPrompt',n,'error','topLeft',!0)}b={module:app.getModuleName(),parent:app.getParentModuleName(),action:'CustomRecordNumberingAjax',mode:'saveModuleCustomNumberingData',sourceModule:c,prefix:f,postfix:i,sequenceNumber:l},jQuery('.saveButton').attr('disabled','disabled'),AppConnector.request(b).done(function(a){var b,c=app.vtranslate('JS_RECORD_NUMBERING_SAVED_SUCCESSFULLY_FOR')+' '+d;if(!0==a.success)b={text:c},Settings_Vtiger_Index_Js.showMessage(b);else{var e=f+' '+app.vtranslate(a.error.message);b={text:e,type:'error'},Settings_Vtiger_Index_Js.showMessage(b);}});}},registerEventToUpdateRecordsWithSequenceNumber:function b(){var a=this.getForm();a.find('[name="updateRecordWithSequenceNumber"]').on('click',function(){var b={},c=a.find('[name="sourceModule"]').val(),d=a.find('option[value="'+c+'"]').text();b={module:app.getModuleName(),parent:app.getParentModuleName(),action:'CustomRecordNumberingAjax',mode:'updateRecordsWithSequenceNumber',sourceModule:c},AppConnector.request(b).done(function(a){var b=app.vtranslate('JS_RECORD_NUMBERING_UPDATED_SUCCESSFULLY_FOR')+' '+d;!0==a.success?Settings_Vtiger_Index_Js.showMessage({text:b}):Settings_Vtiger_Index_Js.showMessage(a.error.message);});});},registerChangeEventForPrefixAndSequenceNumber:function b(){var a=this.getForm();a.find('[name="prefix"],[name="sequenceNumber"]').on('change',function(){jQuery('.saveButton').removeAttr('disabled');});},registerCopyClipboard:function b(a){new ClipboardJS('#customVariableCopy',{text:function b(){return Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_NOTIFY_COPY_TEXT'),type:'success'}),'{{'+a.find('#customVariables').val()+'}}'}});},registerEvents:function d(){var a=this,b=this.getForm();this.registerOnChangeEventOfSourceModule(),this.registerEventToUpdateRecordsWithSequenceNumber(),this.registerChangeEventForPrefixAndSequenceNumber();var c=app.validationEngineOptions;c.onValidationComplete=function(b,c){return c&&a.saveModuleCustomNumbering(),!1},b.validationEngine('detach'),b.validationEngine('attach',c),this.registerCopyClipboard(b);}}),jQuery(document).ready(function(){var a=new Settings_CustomRecordNumbering_Js;a.registerEvents();});
//# sourceMappingURL=CustomRecordNumbering.min.js.map
