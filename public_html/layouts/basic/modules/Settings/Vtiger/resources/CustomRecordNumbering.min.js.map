{"version":3,"file":"CustomRecordNumbering.min.js","sources":["CustomRecordNumbering.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\njQuery.Class('Settings_CustomRecordNumbering_Js', {}, {\n\n\tform: false,\n\tgetForm: function () {\n\t\tif (this.form == false) {\n\t\t\tthis.form = jQuery('#EditView');\n\t\t}\n\t\treturn this.form;\n\t},\n\n\t/**\n\t * Function to register change event for source module field\n\t */\n\tregisterOnChangeEventOfSourceModule: function () {\n\t\tvar editViewForm = this.getForm();\n\t\teditViewForm.find('[name=\"sourceModule\"]').on('change', function (e) {\n\t\t\tjQuery('.saveButton').removeAttr('disabled');\n\t\t\tvar element = jQuery(e.currentTarget);\n\t\t\tvar params = {};\n\t\t\tvar sourceModule = element.val();\n\n\t\t\tparams = {\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t'action': \"CustomRecordNumberingAjax\",\n\t\t\t\t'mode': \"getModuleCustomNumberingData\",\n\t\t\t\t'sourceModule': sourceModule\n\t\t\t}\n\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tif (data) {\n\t\t\t\t\teditViewForm.find('[name=\"prefix\"]').val(data.result.prefix);\n\t\t\t\t\teditViewForm.find('[name=\"postfix\"]').val(data.result.postfix);\n\t\t\t\t\teditViewForm.find('[name=\"sequenceNumber\"]').val(data.result.sequenceNumber);\n\t\t\t\t\teditViewForm.find('[name=\"sequenceNumber\"]').data('oldSequenceNumber', data.result.sequenceNumber);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Function to register event for saving module custom numbering\n\t */\n\tsaveModuleCustomNumbering: function () {\n\t\tif (jQuery('.saveButton').attr(\"disabled\")) {\n\t\t\treturn;\n\t\t}\n\t\tvar editViewForm = this.getForm();\n\t\tvar params = {}\n\t\tvar sourceModule = editViewForm.find('[name=\"sourceModule\"]').val();\n\t\tvar sourceModuleLabel = editViewForm.find('option[value=\"' + sourceModule + '\"]').text();\n\t\tvar prefix = editViewForm.find('[name=\"prefix\"]');\n\t\tvar currentPrefix = jQuery.trim(prefix.val());\n\t\tvar oldPrefix = prefix.data('oldPrefix');\n\t\tvar postfix = editViewForm.find('[name=\"postfix\"]');\n\t\tvar currentPostfix = jQuery.trim(postfix.val());\n\t\tvar oldPostfix = postfix.data('oldPostfix');\n\t\tvar sequenceNumberElement = editViewForm.find('[name=\"sequenceNumber\"]');\n\t\tvar sequenceNumber = sequenceNumberElement.val();\n\t\tvar oldSequenceNumber = sequenceNumberElement.data('oldSequenceNumber');\n\n\t\tif ((sequenceNumber < oldSequenceNumber) && (currentPrefix == oldPrefix) && (currentPostfix == oldPostfix)) {\n\t\t\tvar errorMessage = app.vtranslate('JS_SEQUENCE_NUMBER_MESSAGE') + \" \" + oldSequenceNumber;\n\t\t\tsequenceNumberElement.validationEngine('showPrompt', errorMessage, 'error', 'topLeft', true);\n\t\t\treturn;\n\t\t}\n\n\t\tparams = {\n\t\t\t'module': app.getModuleName(),\n\t\t\t'parent': app.getParentModuleName(),\n\t\t\t'action': \"CustomRecordNumberingAjax\",\n\t\t\t'mode': \"saveModuleCustomNumberingData\",\n\t\t\t'sourceModule': sourceModule,\n\t\t\t'prefix': currentPrefix,\n\t\t\t'postfix': currentPostfix,\n\t\t\t'sequenceNumber': sequenceNumber\n\t\t}\n\n\t\tjQuery('.saveButton').attr(\"disabled\", \"disabled\");\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tvar params;\n\t\t\tvar successfullSaveMessage = app.vtranslate('JS_RECORD_NUMBERING_SAVED_SUCCESSFULLY_FOR') + \" \" + sourceModuleLabel;\n\t\t\tif (data.success == true) {\n\t\t\t\tparams = {\n\t\t\t\t\ttext: successfullSaveMessage\n\t\t\t\t};\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t\t} else {\n\t\t\t\tvar errorMessage = currentPrefix + \" \" + app.vtranslate(data.error.message);\n\t\t\t\tparams = {\n\t\t\t\t\ttext: errorMessage,\n\t\t\t\t\ttype: 'error'\n\t\t\t\t};\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage(params);\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Function to handle update record with the given sequence number\n\t */\n\tregisterEventToUpdateRecordsWithSequenceNumber: function () {\n\t\tvar editViewForm = this.getForm();\n\t\teditViewForm.find('[name=\"updateRecordWithSequenceNumber\"]').on('click', function () {\n\t\t\tvar params = {};\n\t\t\tvar sourceModule = editViewForm.find('[name=\"sourceModule\"]').val();\n\t\t\tvar sourceModuleLabel = editViewForm.find('option[value=\"' + sourceModule + '\"]').text();\n\n\t\t\tparams = {\n\t\t\t\t'module': app.getModuleName(),\n\t\t\t\t'parent': app.getParentModuleName(),\n\t\t\t\t'action': \"CustomRecordNumberingAjax\",\n\t\t\t\t'mode': \"updateRecordsWithSequenceNumber\",\n\t\t\t\t'sourceModule': sourceModule\n\t\t\t}\n\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tvar successfullSaveMessage = app.vtranslate('JS_RECORD_NUMBERING_UPDATED_SUCCESSFULLY_FOR') + \" \" + sourceModuleLabel;\n\t\t\t\tif (data.success == true) {\n\t\t\t\t\tSettings_Vtiger_Index_Js.showMessage({text: successfullSaveMessage});\n\t\t\t\t} else {\n\t\t\t\t\tSettings_Vtiger_Index_Js.showMessage(data.error.message);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t},\n\n\t/**\n\t * Function to register change event for prefix and sequence number\n\t */\n\tregisterChangeEventForPrefixAndSequenceNumber: function () {\n\t\tvar editViewForm = this.getForm();\n\t\teditViewForm.find('[name=\"prefix\"],[name=\"sequenceNumber\"]').on('change', function () {\n\t\t\tjQuery('.saveButton').removeAttr('disabled');\n\t\t})\n\t},\n\n\tregisterCopyClipboard: function (editViewForm) {\n\t\tnew ClipboardJS('#customVariableCopy', {\n\t\t\ttext: function (trigger) {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: app.vtranslate('JS_NOTIFY_COPY_TEXT'),\n\t\t\t\t\ttype: 'success'\n\t\t\t\t});\n\t\t\t\treturn '{{' + editViewForm.find('#customVariables').val() + '}}';\n\t\t\t}\n\t\t});\n\t},\n\n\t/**\n\t * Function to register events\n\t */\n\tregisterEvents: function () {\n\t\tvar thisInstance = this;\n\t\tvar editViewForm = this.getForm();\n\t\tthis.registerOnChangeEventOfSourceModule();\n\t\tthis.registerEventToUpdateRecordsWithSequenceNumber();\n\t\tthis.registerChangeEventForPrefixAndSequenceNumber();\n\n\t\tvar params = app.validationEngineOptions;\n\t\tparams.onValidationComplete = function (editViewForm, valid) {\n\t\t\tif (valid) {\n\t\t\t\tthisInstance.saveModuleCustomNumbering();\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\t\teditViewForm.validationEngine('detach');\n\t\teditViewForm.validationEngine('attach', params);\n\t\tthis.registerCopyClipboard(editViewForm);\n\t}\n})\njQuery(document).ready(function () {\n\tvar customRecordNumberingInstance = new Settings_CustomRecordNumbering_Js();\n\tcustomRecordNumberingInstance.registerEvents();\n});\n"],"names":["jQuery","Class","form","getForm","registerOnChangeEventOfSourceModule","editViewForm","find","on","e","removeAttr","currentTarget","params","sourceModule","element","val","app","getModuleName","getParentModuleName","AppConnector","request","done","data","result","prefix","postfix","sequenceNumber","saveModuleCustomNumbering","attr","sourceModuleLabel","text","currentPrefix","trim","oldPrefix","currentPostfix","oldPostfix","sequenceNumberElement","oldSequenceNumber","vtranslate","validationEngine","errorMessage","successfullSaveMessage","success","Settings_Vtiger_Index_Js","showMessage","error","message","type","registerEventToUpdateRecordsWithSequenceNumber","registerChangeEventForPrefixAndSequenceNumber","registerCopyClipboard","showPnotify","registerEvents","validationEngineOptions","onValidationComplete","valid","thisInstance","document","ready","customRecordNumberingInstance"],"mappings":"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"}