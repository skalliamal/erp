'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

jQuery.Class('Settings_Widgets_Index_Js',{},{getTabId:function a(){return $('.WidgetsManage [name=\'tabid\']').val()},getType:function a(){return $('.form-modalAddWidget [name=\'type\']').val()},createStep2:function e(a){var b=this,c=b.getTabId(),d=jQuery.progressIndicator({position:'html'});app.showModalWindow(null,'index.php?parent=Settings&module=Widgets&view=Widget&mode=createStep2&type='+a+'&tabId='+c,function(e){app.showPopoverElementView(e.find('.js-help-info')),'RelatedModule'===a&&(b.loadFilters(e),b.relatedModuleFields(e),e.find('select[name=\'relatedmodule\']').on('change',function(){b.changeRelatedModule(),b.relatedModuleFields(e);})),d.progressIndicator({mode:'hide'});var f=jQuery('form',e);f.on('submit',function(a){a.preventDefault();var d=!0;if(f&&f.hasClass('validateForm')&&0<f.data('jqv').InvalidFields.length&&(app.formAlignmentAfterValidation(f),d=!1),d){var e=f.serializeFormData();b.registerSaveEvent('saveWidget',{data:e,tabid:c}),b.reloadWidgets(),app.hideModalWindow();}});});},loadWidgets:function c(){var a=this,b=jQuery('.blocksSortable');b.sortable({revert:!0,connectWith:'.blocksSortable',tolerance:'pointer',cursor:'move',placeholder:'state-highlight',stop:function b(){a.updateSequence();}});},updateSequence:function d(){var a=this,b={};$('.blockSortable').each(function(a){b[$(this).data('id')]={index:a,column:$(this).closest('.blocksSortable').data('column')};});var c=$.progressIndicator({message:app.vtranslate('Saving changes'),blockInfo:{enabled:!0}});a.registerSaveEvent('updateSequence',{data:b,tabid:$('input[name=\'tabid\']').val()}),c.progressIndicator({mode:'hide'});},reloadWidgets:function d(){var a=this,b=jQuery.progressIndicator({message:app.vtranslate('Loading data'),position:'html',blockInfo:{enabled:!0}}),c={};c.module='Widgets',c.view='Index',c.parent='Settings',c.source=$('input[name=\'tabid\']').val(),AppConnector.request(c).done(function(c){var d=jQuery('div.contentsDiv').html(c);a.registerEvents(d),b.progressIndicator({mode:'hide'});});},registerSaveEvent:function e(a,b){var c='',d={};d.data={module:app.getModuleName(),parent:app.getParentModuleName(),action:'SaveAjax',mode:a,params:b},d.async='saveWidget'!=a,d.dataType='json',AppConnector.request(d).done(function(a){var b=a.result,d={text:b.message,type:'success'};Vtiger_Helper_Js.showPnotify(d),c=b.success;});},loadFilters:function h(a){var b=['filter','checkbox','switchHeader'],c=a.find('select[name=\'relatedmodule\'] option:selected').val();for(var d in b){var e=app.getMainParams(b[d]+'All',!0),f=a.find('select[name=\''+b[d]+'\']'),g=a.find('input#'+b[d]+'_selected').val();f.empty(),f.append($('<option/>',{value:'-',text:app.vtranslate('None')})),e[c]===void 0?f.closest('.form-group').addClass('d-none'):(f.closest('.form-group').removeClass('d-none'),$.each(e[c],function(a,b){'object'===('undefined'==typeof b?'undefined':_typeof(b))&&(b=b.label);var c={value:a,text:b};g==a&&(c.selected='selected'),f.append($('<option/>',c));}),App.Fields.Picklist.showSelect2ElementView(f));}},relatedModuleFields:function d(a){var b=parseInt(a.find('select[name=\'relatedmodule\']').val()),c=a.find('select[name=\'relatedfields\']');c.hasClass('select2-hidden-accessible')&&(c.select2('close'),c.val(null),c.trigger('change'),c.find('optgroup').each(function(a,c){c=$(c),b===c.data('module')?(c.removeClass('d-none'),c.prop('disabled',!1)):(c.addClass('d-none'),c.prop('disabled','disabled')),c.find('option').each(function(a,c){c=$(c),b===c.data('module')?(c.removeClass('d-none'),c.prop('disabled',!1)):(c.addClass('d-none'),c.prop('disabled','disabled'));});}),c.trigger('change:select2'));},changeRelatedModule:function c(){var a=this,b=jQuery('.form-modalAddWidget');a.loadFilters(b);},registerEvents:function c(a){var b=this;this.loadWidgets(),'undefined'==typeof a&&(a=jQuery('.WidgetsManage')),App.Fields.Picklist.showSelect2ElementView(a.find('.select2')),a.find('select.js-module__list').on('change',function(a){var c=$(a.currentTarget);$('input[name=\'tabid\']').val(c.val()),b.reloadWidgets();}),a.find('.js-widget__add').on('click',function(){var a=jQuery.progressIndicator({position:'html'}),c=$('.WidgetsManage select.js-module__list').val();app.showModalWindow(null,'index.php?parent=Settings&module=Widgets&view=Widget&mod='+c,function(c){a.progressIndicator({mode:'hide'});var d=jQuery('form',c);d.on('submit',function(a){a.preventDefault();var c=d.find('[name="type"]').val();b.createStep2(c);});});}),a.find('.js-widget__edit').on('click',function(a){var c=$(a.currentTarget),d=c.closest('.blockSortable');app.showModalWindow(null,'index.php?parent=Settings&module=Widgets&view=Widget&mode=edit&id='+d.data('id'),function(a){jQuery('#massEditHeader.modal-title').text(app.vtranslate('JS_EDIT_WIDGET')),app.showPopoverElementView(a.find('.js-help-info')),'RelatedModule'==b.getType()&&(b.loadFilters(a),b.relatedModuleFields(a),a.find('select[name=\'relatedmodule\']').on('change',function(){b.changeRelatedModule(),b.relatedModuleFields(a);}));var c=jQuery('form',a);c.on('submit',function(a){a.preventDefault();var d=$.progressIndicator({message:app.vtranslate('Loading data'),blockInfo:{enabled:!0}}),e=c.serializeFormData();b.registerSaveEvent('saveWidget',{data:e,tabid:$('input[name=\'tabid\']').val()}),b.reloadWidgets(),app.hideModalWindow(),d.progressIndicator({mode:'hide'});});});}),a.find('.js-widget__remove').on('click',function(a){var c=$(a.currentTarget),d=c.closest('.blockSortable');b.registerSaveEvent('removeWidget',{wid:d.data('id')}),b.reloadWidgets();});}});
//# sourceMappingURL=Widgets.min.js.map
