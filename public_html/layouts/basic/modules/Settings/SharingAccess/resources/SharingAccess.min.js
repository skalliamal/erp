'use strict';

jQuery.Class('Settings_Sharing_Access_Js',{},{contentTable:!1,contentsContainer:!1,init:function a(){this.setContentTable('.sharingAccessDetails').setContentContainer('#sharingAccessContainer');},setContentTable:function b(a){return a instanceof jQuery?(this.contentTable=a,this):(this.contentTable=jQuery(a),this)},setContentContainer:function b(a){return a instanceof jQuery?(this.contentsContainer=a,this):(this.contentsContainer=jQuery(a),this)},getContentTable:function a(){return this.contentTable},getContentContainer:function a(){return this.contentsContainer},getCustomRuleContainerClassName:function b(a){return 'js-'+a+'-custom-rule-list'},showCustomRulesNextToElement:function e(a,b){var c=a.data('moduleName'),d=jQuery('<tr class="'+this.getCustomRuleContainerClassName(c)+'"><td class="js-custom-rule-container" data-js="container" colspan="6"></td></tr>');jQuery('td',d).append(b),jQuery('.ruleListContainer',d).css('display','none'),a.after(d).addClass('collapseRow'),jQuery('.ruleListContainer',d).slideDown('slow');},getCustomRules:function d(a){var b=jQuery.Deferred(),c={};return c.for_module=a,c.module=app.getModuleName(),c.parent=app.getParentModuleName(),c.view='IndexAjax',c.mode='showRules',AppConnector.request(c).done(function(a){b.resolve(a);}).fail(function(a){b.reject(a);}),b.promise()},save:function d(a){var b=jQuery.Deferred(),c=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});return 'undefined'==typeof a&&(a={}),AppConnector.request(a).done(function(a){c.progressIndicator({mode:'hide'}),b.resolve(a);}).fail(function(a){c.progressIndicator({mode:'hide'}),b.reject(a);}),b.promise()},saveCustomRule:function e(a){var b=this,c=a.serializeFormData();'undefined'==typeof c&&(c={});var d=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});c.module=app.getModuleName(),c.parent=app.getParentModuleName(),c.action='IndexAjax',c.mode='saveRule',AppConnector.request(c).done(function(c){d.progressIndicator({mode:'hide'}),app.hideModalWindow(),b.displaySaveCustomRuleResponse(c);var e=jQuery('[name="for_module"]',a).val();b.loadCustomRulesList(e);});},loadCustomRulesList:function d(a){var b=this,c=this.getContentTable();b.getCustomRules(a).done(function(d){var e=jQuery('.'+b.getCustomRuleContainerClassName(a),c);e.find('td.js-custom-rule-container').html(d);});},displaySaveCustomRuleResponse:function e(a){var b=this,c=a.success,d={};d=c?{text:app.vtranslate('JS_CUSTOM_RULE_SAVED_SUCCESSFULLY'),type:'success'}:{text:app.vtranslate('JS_CUSTOM_RULE_SAVING_FAILED'),type:'error'},b.showNotify(d);},showNotify:function c(a){var b={text:a.text,type:a.type,delay:'3000'};Vtiger_Helper_Js.showPnotify(b);},editCustomRule:function d(a){var b=this,c=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});app.showModalWindow(null,a,function(a){c.progressIndicator({mode:'hide'});var d=a.find('.js-edit-rule-form');d.on('submit',function(a){a.preventDefault();var c=$(a.currentTarget);b.saveCustomRule(c,a);});});},deleteCustomRule:function e(a){var b=a.data('url'),c=a.closest('.js-custom-rule-entries'),d=app.vtranslate('LBL_DELETE_CONFIRMATION');Vtiger_Helper_Js.showConfirmationBox({message:d}).done(function(){AppConnector.request(b).done(function(a){if(!0==a.success){c.fadeOut('slow');var b=c.closest('.js-custom-rule-table'),d=c.nextAll('js-custom-rule-entries');0<d.length&&jQuery.each(d,function(a,b){var c=jQuery(b).find('.js-sequence-number'),d=parseInt(c.text())-1;c.text(d);}),c.remove();var e=b.find('.js-custom-rule-entries');1>e.length&&(b.find('.js-custom-rule-headers').fadeOut('slow').remove(),b.parent().find('.js-record-details').removeClass('d-none'),b.addClass('d-none'));}else Vtiger_Helper_Js.showPnotify(a.error.message);});});},registerSharingAccessEdit:function b(){var a=this.getContentContainer();a.one('click','input:radio',function(){a.find('button:submit').removeClass('d-none');});},registerDependentModulesPrivilegesChange:function e(){var a=this,b=a.getContentContainer(),c=this.getContentTable(),d=JSON.parse(b.find('.dependentModules').val());jQuery.each(d,function(a,b){var d=c.find('[data-module-name="'+a+'"]').find('[data-action-state="Private"]');d.on('change',function(a){var d=jQuery(a.currentTarget);if(d.is(':checked')){var e=app.vtranslate('JS_DEPENDENT_PRIVILEGES_SHOULD_CHANGE');bootbox.alert(e),jQuery.each(b,function(a,b){c.find('[data-module-name="'+b+'"]').find('[data-action-state="Private"]').attr('checked','checked');});}});});},registerEvents:function d(){var a=this,b=this.getContentTable(),c=this.getContentContainer();a.registerSharingAccessEdit(),a.registerDependentModulesPrivilegesChange(),b.on('click','td.triggerCustomSharingAccess',function(c){var d=jQuery(c.currentTarget),e=d.closest('tr'),f=e.data('moduleName'),g=jQuery('.'+a.getCustomRuleContainerClassName(f),b);if(0<g.length)return void(app.isHidden(g)?(g.show(),jQuery('.ruleListContainer',g).slideDown('slow'),e.addClass('collapseRow'),d.find('button.arrowDown').addClass('d-none'),d.find('button.arrowUp').removeClass('d-none').show()):(jQuery('.ruleListContainer',g).slideUp('slow',function(){g.css('display','none');}),d.find('button.arrowUp').addClass('d-none'),d.find('button.arrowDown').removeClass('d-none').show(),e.removeClass('collapseRow')));var h=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});a.getCustomRules(f).done(function(b){h.progressIndicator({mode:'hide'}),a.showCustomRulesNextToElement(e,b),d.find('button.arrowDown').addClass('d-none'),d.find('button.arrowUp').removeClass('d-none').show();});}),b.on('click','.js-add-custom-rule',function(b){var c=jQuery(b.currentTarget);a.editCustomRule(c.data('url'));}),b.on('click','.js-edit',function(b){var c=jQuery(b.currentTarget),d=c.data('url');a.editCustomRule(d);}),b.on('click','.js-delete',function(b){var c=jQuery(b.currentTarget);a.deleteCustomRule(c);}),c.on('submit','#js-edit-sharing-access',function(b){b.preventDefault();var d=jQuery(b.currentTarget),e=d.serializeFormData();a.save(e).done(function(){c.find('button:submit').addClass('d-none'),a.registerSharingAccessEdit();var b={text:app.vtranslate('JS_NEW_SHARING_RULES_APPLIED_SUCCESSFULLY'),type:'success'};a.showNotify(b);});});}}),jQuery(document).ready(function(){var a=new Settings_Sharing_Access_Js;a.registerEvents();});
//# sourceMappingURL=SharingAccess.min.js.map
