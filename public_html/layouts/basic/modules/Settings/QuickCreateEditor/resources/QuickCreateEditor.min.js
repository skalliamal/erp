'use strict';

jQuery.Class('Settings_QuickCreateEditor_Js',{},{updatedBlockSequence:{},updatedBlockFieldsList:[],showSaveButton:function c(){var a=jQuery('#relatedTabOrder'),b=a.find('.saveRelatedList');'disabled'==b.attr('disabled')&&b.removeAttr('disabled');},makeFieldsListSortable:function d(){var a=this,b=jQuery('#quickCreateEditorContainer').find('.contents'),c=b.find('.editFieldsTable');jQuery('#quickCreateEditorContainer .contents .editFieldsTable').each(function(){jQuery(this).find('ul[name=sortable1], ul[name=sortable2]').sortable({containment:'#moduleBlocks',revert:!0,tolerance:'pointer',cursor:'move',connectWith:jQuery(this).find('.connectedSortable'),update:function e(b,c){c.item;if(a.showSaveFieldSequenceButton(),c.sender){var d=c.sender.closest('.editFieldsTable');a.reArrangeBlockFields(d);}}});});},showSaveFieldSequenceButton:function d(){var a=this,b=jQuery('#detailViewLayout'),c=b.find('.saveFieldSequence');a.updatedBlockFieldsList=[],c.removeClass('visibility');},hideSaveFieldSequenceButton:function c(){var a=jQuery('#detailViewLayout'),b=a.find('.saveFieldSequence');b.addClass('visibility');},reArrangeBlockFields:function f(a){var b=a.find('ul[name=sortable1]'),c=a.find('ul[name=sortable2]');if(b.children().length<c.children().length){var d=c.children(':last');b.append(d);}else if(b.children().length>c.children().length+1){var e=b.children(':last');c.append(e);}},createUpdatedBlockFieldsList:function k(){var a=this,b=jQuery('#quickCreateEditorContainer').find('.contents'),c=b.find('.block'),d=c.find('ul[name=sortable1]'),e=[];d.each(function(a,b){var c=jQuery(b),d=c.find('.editFields').length;e.push(d);});var f=d.find('.editFields'),g=1;f.each(function(b,c){var d=jQuery(c),f=d.data('fieldId');a.updatedBlockFieldsList.push({fieldid:f,sequence:g}),g+=2,b==e[0]-1&&(g=1);});var h=c.find('ul[name=sortable2]'),i=h.find('.editFields'),j=2;e=[],h.each(function(a,b){var c=jQuery(b),d=c.find('.editFields').length;e.push(d);}),i.each(function(b,c){var d=jQuery(c),f=d.data('fieldId');a.updatedBlockFieldsList.push({fieldid:f,sequence:j}),j+=2,b==e[0]-1&&(j=2);});},registerFieldSequenceSaveClick:function c(){var a=this,b=jQuery('#detailViewLayout');b.on('click','.saveFieldSequence',function(){a.hideSaveFieldSequenceButton(),a.createUpdatedBlockFieldsList(),a.updateFieldSequence();});},updateFieldSequence:function d(){var a=this,b=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),c={};c.module=app.getModuleName(),c.parent=app.getParentModuleName(),c.action='SaveSequenceNumber',c.mode='move',c.updatedFields=a.updatedBlockFieldsList,AppConnector.request(c).done(function(){b.progressIndicator({mode:'hide'}),Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate('JS_FIELD_SEQUENCE_UPDATED')});}).fail(function(){b.progressIndicator({mode:'hide'});});},avoidDropDownClick:function b(a){a.find('.dropdown-menu').on('click',function(a){a.stopPropagation();});},addClickOutSideEvent:function c(a,b){a.one('clickoutside',b);},registerModulesChangeEvent:function d(){var a=this,b=jQuery('#quickCreateEditorContainer'),c=b.closest('.contentsDiv');App.Fields.Picklist.showSelect2ElementView(b.find('[name="quickCreateEditorModules"]'),{dropdownCss:{"z-index":0}}),b.on('change','[name="quickCreateEditorModules"]',function(b){var d=jQuery(b.currentTarget),e=d.val();a.getModuleQuickCreateEditor(e).done(function(b){c.html(b),a.registerEvents();});});},getModuleQuickCreateEditor:function f(a){var c=jQuery.Deferred(),d=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),e={};return e.module=app.getModuleName(),e.parent=app.getParentModuleName(),e.view='Index',e.sourceModule=a,AppConnector.requestPjax(e).done(function(a){d.progressIndicator({mode:'hide'}),c.resolve(a);}).fail(function(){d.progressIndicator({mode:'hide'}),c.reject();}),c.promise()},registerEvents:function b(){var a=this;a.registerModulesChangeEvent(),a.makeFieldsListSortable(),a.registerFieldSequenceSaveClick();}}),jQuery(document).ready(function(){var a=new Settings_QuickCreateEditor_Js;a.registerEvents();});
//# sourceMappingURL=QuickCreateEditor.min.js.map
