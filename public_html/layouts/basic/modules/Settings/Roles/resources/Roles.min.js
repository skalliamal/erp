'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

var Settings_Roles_Js={newPriviliges:!1,initDeleteView:function a(){jQuery('#roleDeleteForm').validationEngine(app.validationEngineOptions),jQuery('[data-action="popup"]').on('click',function(a){a.preventDefault();var b=$(a.currentTarget),c=b.data('field'),d=Vtiger_Popup_Js.getInstance();d.show(b.data('url')),d.retrieveSelectedRecords(function(a){try{a=JSON.parse(a);}catch(a){}'object'==('undefined'==typeof a?'undefined':_typeof(a))&&(jQuery('[name="'+c+'_display"]').val(a.label),a=a.value),jQuery('[name="'+c+'"]').val(a);});}),jQuery('#clearRole').on('click',function(){jQuery('[name="transfer_record_display"]').val(''),jQuery('[name="transfer_record"]').val('');});},initPopupView:function a(){jQuery('.roleEle').on('click',function(a){var b=$(a.currentTarget);jQuery.triggerParentEvent('postSelection',JSON.stringify({value:b.closest('li').data('roleid'),label:b.text()})),self.close();});},initEditView:function b(){function a(a,b){AppConnector.request({module:'Roles',action:'MoveAjax',parent:'Settings',record:a,parent_roleid:b}).done(function(a){a.success||(alert(app.vtranslate('JS_FAILED_TO_SAVE')),window.location.reload());});}jQuery('[rel="tooltip"]').tooltip(),jQuery('[data-action="modal"]').on('click',function(a){var b=$(a.currentTarget);app.showModalWindow(null,b.data('url'),function(){Settings_Roles_Js.initDeleteView();});}),jQuery('.toolbar').hide(),jQuery('.toolbar-handle').on('mouseover',function(a){var b=$(a.currentTarget);jQuery('.toolbar',b).css({display:'inline'});}),jQuery('.toolbar-handle').on('mouseout',function(a){var b=$(a.currentTarget);jQuery('.toolbar',b).hide();}),jQuery('.draggable').draggable({containment:'.treeView',start:function h(a,b){var c=jQuery(b.helper),d=c.data('refid'),e=jQuery('[data-grouprefid="'+d+'"]'),f=e.data('roleid');if('H5'==f||'H2'==f){var g={};g.title=app.vtranslate('JS_PERMISSION_DENIED'),g.text=app.vtranslate('JS_NO_PERMISSIONS_TO_MOVE'),g.type='error',Settings_Vtiger_Index_Js.showMessage(g);}},helper:function f(a){var b=$(a.currentTarget),c=b.closest('li'),d=+new Date,e=$('<div/>');return e.data('refid',d),e.html(c.clone()),c.attr('data-grouprefid',d),e}}),jQuery('.droppable').droppable({hoverClass:'btn-primary',tolerance:'pointer',drop:function l(b,c){var d=$(c.helper),e=d.data('refid'),f=$('[data-grouprefid="'+e+'"]'),g=$(this).closest('div'),h=g.closest('li').data('role'),i=g.closest('li').data('roleid'),j=f.data('role'),k=f.data('roleid');0==h.indexOf(j+'::')||'H5'==k||'H2'==k||(f.appendTo(g.next('ul')),a(k,i));}});},registerSubmitEvent:function c(){var a=this,b=jQuery('#EditView');b.on('submit',function(c){if('true'==b.data('submit')&&'true'==b.data('performCheck'))return !0;var d=jQuery('#profilesList'),e=app.getSelect2ElementFromSelect(d),f=Vtiger_MultiSelect_Validator_Js.invokeValidation(d);if(!0!=f)return e.validationEngine('showPrompt',f,'error','bottomLeft',!0),void c.preventDefault();if(e.validationEngine('hide'),0>=b.data('jqv').InvalidFields.length){var g=b.serializeFormData();a.checkDuplicateName({rolename:g.rolename,record:g.record}).done(function(){b.data('submit','true'),b.data('performCheck','true'),b.submit(),jQuery.progressIndicator({blockInfo:{enabled:!0}});}).fail(function(a){var b={};return b.text=a.message,b.type='error',Settings_Vtiger_Index_Js.showMessage(b),!1});}else b.removeData('submit'),app.formAlignmentAfterValidation(b);c.preventDefault();});},checkDuplicateName:function d(a){var b=jQuery.Deferred(),c={module:app.getModuleName(),parent:app.getParentModuleName(),action:'EditAjax',mode:'checkDuplicate',rolename:a.rolename,record:a.record};return AppConnector.request(c).done(function(a){var c=a.result,d=c.success;!0==d?b.reject(c):b.resolve(c);}).fail(function(a,c){b.reject(a,c);}),b.promise()},registerEvents:function a(){Settings_Roles_Js.initEditView(),Settings_Roles_Js.registerSubmitEvent();}};jQuery(document).ready(function(){Settings_Roles_Js.registerEvents();});
//# sourceMappingURL=Roles.min.js.map
