{"version":3,"file":"Edit8.min.js","sources":["Edit8.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nSettings_PDF_Edit_Js(\"Settings_PDF_Edit8_Js\", {}, {\n\tstep8Container: false,\n\tadvanceFilterInstance: false,\n\tckEditorInstance: false,\n\tfieldValueMap: false,\n\tinit: function () {\n\t\tthis.initialize();\n\t},\n\t/**\n\t * Function to get the container which holds all the reports step1 elements\n\t * @return jQuery object\n\t */\n\tgetContainer: function () {\n\t\treturn this.step8Container;\n\t},\n\t/**\n\t * Function to set the reports step1 container\n\t * @params : element - which represents the reports step1 container\n\t * @return : current instance\n\t */\n\tsetContainer: function (element) {\n\t\tthis.step8Container = element;\n\t\treturn this;\n\t},\n\t/**\n\t * Function  to intialize the reports step1\n\t */\n\tinitialize: function (container) {\n\t\tif (typeof container === \"undefined\") {\n\t\t\tcontainer = jQuery('#pdf_step8');\n\t\t}\n\t\tif (container.is('#pdf_step8')) {\n\t\t\tthis.setContainer(container);\n\t\t} else {\n\t\t\tthis.setContainer(jQuery('#pdf_step8'));\n\t\t}\n\t},\n\tsubmit: function () {\n\t\tvar aDeferred = jQuery.Deferred();\n\t\tvar form = this.getContainer();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tvar saveData = form.serializeFormData();\n\t\tsaveData['action'] = 'Save';\n\t\tsaveData['step'] = 8;\n\t\tAppConnector.request(saveData).done(function (data) {\n\t\t\tif (data.success == true) {\n\t\t\t\tSettings_Vtiger_Index_Js.showMessage({text: app.vtranslate('JS_PDF_SAVED_SUCCESSFULLY')});\n\n\t\t\t\tsetTimeout(function () {\n\t\t\t\t\twindow.location.href = \"index.php?module=PDF&parent=Settings&page=1&view=List\";\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({\n\t\t\t\t\t\t'mode': 'hide'\n\t\t\t\t\t});\n\t\t\t\t}, 1000);\n\t\t\t}\n\t\t}).fail(function (error, err) {\n\t\t\tapp.errorLog(error, err);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\tregisterCancelStepClickEvent: function (form) {\n\t\tjQuery('button.cancelLink', form).on('click', function () {\n\t\t\twindow.history.back();\n\t\t});\n\t},\n\tregisterWatermarkTypeChange: function (container) {\n\t\tvar watermarkType = container.find('#watermark_type');\n\n\t\twatermarkType.on('change', function () {\n\t\t\tcontainer.find('.watertext').toggleClass('d-none')\n\t\t\tcontainer.find('.waterimage').toggleClass('d-none')\n\t\t});\n\t},\n\tregisterUploadButton: function (form) {\n\t\tform.find('#uploadWM').on('click', function (e) {\n\t\t\te.preventDefault();\n\t\t\tvar fileSelect = form.find('#watermark_image');\n\t\t\t// Get the selected files from the input.\n\t\t\tvar files = fileSelect[0].files;\n\n\t\t\t// Create a new FormData object.\n\t\t\tvar formData = new FormData();\n\t\t\t// Loop through each of the selected files.\n\t\t\tfor (var i = 0; i < files.length; i++) {\n\t\t\t\tvar file = files[i];\n\n\t\t\t\t// Check the file type.\n\t\t\t\tif (!file.type.match('image.*')) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// Add the file to the request.\n\t\t\t\tformData.append('watermark[]', file, file.name);\n\t\t\t}\n\t\t\tformData.append('template_id', form.find('[name=\"record\"]').val());\n\t\t\t// Set up the request.\n\t\t\tvar xhr = new XMLHttpRequest();\n\n\t\t\t// Open the connection.\n\t\t\txhr.open('POST', 'index.php?module=PDF&parent=Settings&action=Watermark&mode=upload', true);\n\n\t\t\t// Set up a handler for when the request finishes.\n\t\t\txhr.onload = function () {\n\t\t\t\tif (xhr.status === 200) {\n\t\t\t\t\tvar templateId = form.find('[name=\"record\"]').val();\n\t\t\t\t\tvar fileName = files[0]['name'];\n\t\t\t\t\tvar fileExt = fileName.split('.');\n\t\t\t\t\tvar uploadedImage = templateId + '.' + fileExt[fileExt.length - 1];\n\n\t\t\t\t\tform.find('#watermark').html('<img src=\"storage/Pdf/watermark/' + uploadedImage + '\" class=\"col-md-9\" />');\n\t\t\t\t\tform.find('[name=\"watermark_image\"]').val('storage/Pdf/watermark/' + uploadedImage);\n\t\t\t\t\tform.find('#deleteWM').removeClass('d-none');\n\t\t\t\t}\n\t\t\t};\n\n\t\t\t// Send the Data.\n\t\t\txhr.send(formData);\n\t\t});\n\t},\n\tregisterDeleteUploadButton: function (form) {\n\t\tform.find('#deleteWM').on('click', function (e) {\n\t\t\te.preventDefault();\n\t\t\tvar params = {};\n\t\t\tparams.data = {\n\t\t\t\tparent: app.getParentModuleName(),\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'Watermark',\n\t\t\t\tmode: 'delete',\n\t\t\t\tid: form.find('[name=\"record\"]').val()\n\t\t\t};\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tvar response = data['result'];\n\t\t\t\tif (response) {\n\t\t\t\t\tform.find('#watermark').html('');\n\t\t\t\t\tform.find('[name=\"watermark_image\"]').val('');\n\t\t\t\t\tform.find('#deleteWM').addClass('d-none');\n\t\t\t\t}\n\t\t\t}).fail(function (data, err) {\n\t\t\t\tapp.errorLog(data, err);\n\t\t\t});\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tvar container = this.getContainer();\n\t\tApp.Fields.Picklist.changeSelectElementView(container);\n\t\tthis.registerCancelStepClickEvent(container);\n\t\tthis.registerWatermarkTypeChange(container);\n\t\tthis.registerUploadButton(container);\n\t\tthis.registerDeleteUploadButton(container);\n\t}\n});\n"],"names":["Settings_PDF_Edit_Js","step8Container","advanceFilterInstance","ckEditorInstance","fieldValueMap","init","initialize","getContainer","setContainer","element","container","jQuery","is","submit","Deferred","form","progressIndicatorElement","progressIndicator","saveData","serializeFormData","AppConnector","request","done","data","success","Settings_Vtiger_Index_Js","showMessage","text","app","vtranslate","setTimeout","window","location","href","fail","error","err","errorLog","aDeferred","promise","registerCancelStepClickEvent","on","history","back","registerWatermarkTypeChange","find","watermarkType","toggleClass","registerUploadButton","e","preventDefault","fileSelect","files","formData","i","length","file","type","match","append","name","val","xhr","open","onload","status","fileName","fileExt","split","uploadedImage","templateId","html","removeClass","send","registerDeleteUploadButton","params","parent","getParentModuleName","module","getModuleName","action","mode","id","dataType","response","addClass","registerEvents","App","Fields","Picklist","changeSelectElementView"],"mappings":"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"}