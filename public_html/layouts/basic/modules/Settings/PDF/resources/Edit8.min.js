'use strict';

Settings_PDF_Edit_Js("Settings_PDF_Edit8_Js",{},{step8Container:!1,advanceFilterInstance:!1,ckEditorInstance:!1,fieldValueMap:!1,init:function a(){this.initialize();},getContainer:function a(){return this.step8Container},setContainer:function b(a){return this.step8Container=a,this},initialize:function b(a){"undefined"==typeof a&&(a=jQuery("#pdf_step8")),a.is("#pdf_step8")?this.setContainer(a):this.setContainer(jQuery("#pdf_step8"));},submit:function e(){var a=jQuery.Deferred(),b=this.getContainer(),c=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),d=b.serializeFormData();return d.action="Save",d.step=8,AppConnector.request(d).done(function(a){!0==a.success&&(Settings_Vtiger_Index_Js.showMessage({text:app.vtranslate("JS_PDF_SAVED_SUCCESSFULLY")}),setTimeout(function(){window.location.href="index.php?module=PDF&parent=Settings&page=1&view=List",c.progressIndicator({mode:"hide"});},1e3));}).fail(function(a,b){app.errorLog(a,b);}),a.promise()},registerCancelStepClickEvent:function b(a){jQuery("button.cancelLink",a).on("click",function(){window.history.back();});},registerWatermarkTypeChange:function c(a){var b=a.find("#watermark_type");b.on("change",function(){a.find(".watertext").toggleClass("d-none"),a.find(".waterimage").toggleClass("d-none");});},registerUploadButton:function b(a){a.find("#uploadWM").on("click",function(b){b.preventDefault();for(var c,d=a.find("#watermark_image"),e=d[0].files,f=new FormData,g=0;g<e.length;g++)(c=e[g],!!c.type.match("image.*"))&&f.append("watermark[]",c,c.name);f.append("template_id",a.find("[name=\"record\"]").val());var h=new XMLHttpRequest;h.open("POST","index.php?module=PDF&parent=Settings&action=Watermark&mode=upload",!0),h.onload=function(){if(200===h.status){var b=a.find("[name=\"record\"]").val(),c=e[0].name,d=c.split("."),f=b+"."+d[d.length-1];a.find("#watermark").html("<img src=\"storage/Pdf/watermark/"+f+"\" class=\"col-md-9\" />"),a.find("[name=\"watermark_image\"]").val("storage/Pdf/watermark/"+f),a.find("#deleteWM").removeClass("d-none");}},h.send(f);});},registerDeleteUploadButton:function b(a){a.find("#deleteWM").on("click",function(b){b.preventDefault();var c={};c.data={parent:app.getParentModuleName(),module:app.getModuleName(),action:"Watermark",mode:"delete",id:a.find("[name=\"record\"]").val()},c.dataType="json",AppConnector.request(c).done(function(b){var c=b.result;c&&(a.find("#watermark").html(""),a.find("[name=\"watermark_image\"]").val(""),a.find("#deleteWM").addClass("d-none"));}).fail(function(a,b){app.errorLog(a,b);});});},registerEvents:function b(){var a=this.getContainer();App.Fields.Picklist.changeSelectElementView(a),this.registerCancelStepClickEvent(a),this.registerWatermarkTypeChange(a),this.registerUploadButton(a),this.registerDeleteUploadButton(a);}});
//# sourceMappingURL=Edit8.min.js.map
