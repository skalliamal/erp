'use strict';

jQuery.Class('Settings_LeadMapping_Js',{triggerEdit:function d(a){var b=jQuery.Deferred(),c=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});return AppConnector.request(a).done(function(a){var b=jQuery('.contentsDiv');b.html(a),c.progressIndicator({mode:'hide'});var d=new Settings_LeadMapping_Js;d.registerEventsForEditView();}).fail(function(){c.progressIndicator({mode:'hide'});}),b.promise()},triggerDelete:function f(a,b){var c=jQuery(a.currentTarget),d=c.closest('.listViewEntries'),e=d.data('cfmid');AppConnector.request(b+'&mappingId='+e).done(function(a){var b=a.result[0],c={text:b};a.success?d.remove():c.type='error',Settings_Vtiger_Index_Js.showMessage(c);});}},{registerEventsForEditView:function c(){var a=jQuery('#leadsMapping'),b=a.find('.select2');App.Fields.Picklist.showSelect2ElementView(b),this.registerEventForAddingNewMapping(),this.registerOnChangeEventForSourceModule(),this.registerEventToDeleteMapping(),this.registerEventForFormSubmit(),this.registerOnChangeEventOfTargetModule(),jQuery('select.accountsFields.select2,select.contactFields.select2').trigger('change',!1);},registerEventForAddingNewMapping:function a(){jQuery('#addMapping').on('click',function(){var a=jQuery('#convertLeadMapping'),b=a.find('tr:not(.newMapping):last[sequence-number]').attr('sequence-number'),c=parseInt(b)+1,d=jQuery('.newMapping').clone(!0,!0);d.attr('sequence-number',c),d.find('select.leadsFields.newSelect').attr('name','mapping['+c+'][lead]'),d.find('select.accountsFields.newSelect').attr('name','mapping['+c+'][account]'),d.find('select.contactFields.newSelect').attr('name','mapping['+c+'][contact]'),d.removeClass('d-none newMapping'),d.appendTo(a),d.find('.newSelect').removeClass('newSelect').addClass('select2');var e=d.find('.select2');App.Fields.Picklist.showSelect2ElementView(e),jQuery('select.accountsFields.select2,select.contactFields.select2',d).trigger('change',!1);});},registerOnChangeEventForSourceModule:function b(){var a=jQuery('#leadsMapping');a.on('change','.leadsFields',function(b){var c=jQuery(b.currentTarget),d=jQuery(c.closest('tr')),e=c.val(),f=c.find('option[value="'+e+'"]'),g=f.data('type'),h=d.find('select.accountsFields.select2'),i=d.find('select.contactFields.select2'),j=a.find('.newMapping').find('.accountsFields').children().filter('[data-type="'+g+'"]').clone(!0,!0),k=a.find('.newMapping').find('.contactFields').children().filter('option[data-type="'+g+'"]').clone(!0,!0);g=app.vtranslate('JS_'+g),d.find('.selectedFieldDataType').html(g);var l=app.vtranslate('JS_NONE');h.html(j),i.html(k),'None'!=g&&(h.prepend('<option data-type="'+l+'" label="'+l+'" value="0" selected>'+l+'</option>'),i.prepend('<option data-type="'+l+'" label="'+l+'" value="0" selected>'+l+'</option>')),h.trigger('chosen:updated').trigger('change',!1),i.trigger('chosen:updated').trigger('change',!1);});},registerEventToDeleteMapping:function b(){var a=jQuery('#leadsMapping');a.on('click','.deleteMapping',function(a){var b=jQuery(a.currentTarget),c=b.closest('tr'),d=c.attr('sequence-number');c.prepend('<input type="hidden" name="'+('mapping['+d+'][deletable]')+'" />'),c.data('deletable',!0).hide('slow');var e={text:app.vtranslate('JS_MAPPING_DELETED_SUCCESSFULLY')};Settings_Vtiger_Index_Js.showMessage(e);});},registerEventForFormSubmit:function a(){jQuery('#leadsMapping').on('submit',function(a){a.preventDefault();var b=jQuery(this).serializeFormData(),c={module:app.getModuleName(),parent:app.getParentModuleName(),action:'MappingSave',mapping:b},d=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});AppConnector.request(c).done(function(a){if(a.success){var b={module:app.getModuleName(),parent:app.getParentModuleName(),view:'MappingDetail'};AppConnector.request(b).done(function(a){var b=jQuery('.contentsDiv');b.html(a),d.progressIndicator({mode:'hide'});});}var c;c=a.result.status?{title:app.vtranslate('JS_MAPPING_SAVED_SUCCESSFULLY'),type:'info',width:'25%'}:{title:app.vtranslate('JS_INVALID_MAPPING'),text:a.result,type:'error',width:'25%'},Vtiger_Helper_Js.showPnotify(c);}).fail(function(){d.progressIndicator({mode:'hide'});});});},registerOnChangeEventOfTargetModule:function b(){var a=jQuery('#leadsMapping');a.on('change','select.accountsFields.select2,select.contactFields.select2',function(a,b){'undefined'==typeof b&&(b=!0);var c,d=jQuery(a.currentTarget),e=d.children().filter('option:selected').text(),f=d.children().filter('option:selected').val(),g=d.closest('tr'),h=!1;if('0'==f&&(f='false'),!b||'false'==f)return void d.attr('selectedId',f);var i=g.find('select.leadsFields.select2'),j=i.val(),k=i.find('option[value="'+j+'"]').text();if('0'==j){h=!0;var l={text:app.vtranslate('JS_CANT_MAP')+' '+e+' '+app.vtranslate('JS_WITH')+' '+k,type:'error'};Settings_Vtiger_Index_Js.showMessage(l);}if(d.hasClass('accountsFields')?c=jQuery('select.accountsFields.select2[selectedid="'+f+'"]'):d.hasClass('contactFields')&&(c=jQuery('select.contactFields.select2[selectedid="'+f+'"]')),0<c.length&&(h=!0),h){var m,n=d.attr('selectedid');'false'==n?(m=d.find('option[label="None"]').text(),d.attr('selectedId','false')):'false'!=n&&(m=d.find('option[value="'+n+'"]').text(),d.attr('selectedId',n));var o=e+' '+app.vtranslate('JS_IS_ALREADY_BEEN_MAPPED');Settings_Vtiger_Index_Js.showMessage({text:o,type:'error'}),d.val(0).trigger('change');}else!1==h&&d.attr('selectedId',f);});}});
//# sourceMappingURL=LeadMapping.min.js.map
