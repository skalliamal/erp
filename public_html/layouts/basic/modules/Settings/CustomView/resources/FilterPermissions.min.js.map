{"version":3,"file":"FilterPermissions.min.js","sources":["FilterPermissions.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Settings_CustomView_FilterPermissions_Js\", {}, {\n\tformElement: false,\n\tregisterButtonsEvent: function () {\n\t\tvar thisInstance = this;\n\t\tvar container = this.getForm();\n\t\tcontainer.find('button.moveItem').on('click', function (e) {\n\t\t\tthisInstance.setDefaultPreferences(e);\n\t\t});\n\t},\n\tregisterDisabledButtons: function () {\n\t\tvar container = this.getForm();\n\t\tcontainer.find('button.moveItem').each(function (n, e) {\n\t\t\tvar currentTarget = jQuery(e);\n\t\t\tvar sourceClass = currentTarget.data('source');\n\t\t\tvar source = container.find('.' + sourceClass);\n\t\t\tif (source.find('option').length && !source.is(':disabled')) {\n\t\t\t\tcurrentTarget.prop('disabled', false);\n\t\t\t} else {\n\t\t\t\tcurrentTarget.prop('disabled', true);\n\t\t\t}\n\t\t});\n\t},\n\tmove: function (currentTarget) {\n\t\tvar container = this.getForm();\n\t\tvar sourceClass = currentTarget.data('source');\n\t\tvar targetClass = currentTarget.data('target');\n\t\tvar target = container.find('.' + targetClass);\n\t\tvar source = container.find('.' + sourceClass).find('option:selected');\n\n\t\tvar values = {};\n\t\tvalues.val = source.val();\n\t\tvalues.label = source.text();\n\t\tvalues.blockLabel = source.closest('optgroup').attr('label');\n\n\t\tvar targetOption = '<option value=\"' + values.val + '\">' + values.label + '</option>';\n\t\tvar targetOpt = target.find('optgroup[label=\"' + values.blockLabel + '\"]');\n\t\tif (targetOpt.length) {\n\t\t\ttargetOpt.append(targetOption);\n\t\t} else {\n\t\t\ttarget.append('<optgroup label=\"' + values.blockLabel + '\">' + targetOption + '</optgroup>');\n\t\t}\n\t\tsource.remove();\n\t\tApp.Fields.Picklist.showSelect2ElementView(container.find('.select2'));\n\t},\n\t/**\n\t * Saves permission for filter\n\t * @param {jQuery.Event} e\n\t */\n\tsetDefaultPreferences: function (e) {\n\t\tvar thisInstance = this;\n\t\tvar container = this.getForm();\n\t\tvar progressIndicatorElement = $.progressIndicator({\n\t\t\tmessage: app.vtranslate('JS_SAVE_LOADER_INFO'),\n\t\t\tposition: this.getForm(),\n\t\t\tblockInfo: {\n\t\t\t\tenabled: true\n\t\t\t}\n\t\t});\n\t\tvar currentTarget = $(e.currentTarget);\n\t\tvar sourceClass = currentTarget.data('source');\n\t\tvar params = {\n\t\t\ttabid: container.find('#sourceModule').val(),\n\t\t\tuser: container.find('.' + sourceClass).val(),\n\t\t\tcvid: container.find('#cvid').val(),\n\t\t\toperator: currentTarget.data('operator'),\n\t\t\ttype: container.find('#type').val()\n\t\t};\n\t\tapp.saveAjax('setFilterPermissions', {}, params).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tif (data.result.success) {\n\t\t\t\t\tthisInstance.move(currentTarget);\n\t\t\t\t\tthisInstance.registerDisabledButtons();\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({text: data.result.message, type: 'success'});\n\t\t\t\t} else {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t\t\tVtiger_Helper_Js.showPnotify({text: data.result.message, type: 'error'});\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\t}\n\t\t});\n\t},\n\tgetForm: function () {\n\t\tif (this.formElement == false) {\n\t\t\tthis.setForm(jQuery('#modalFilterPermissions'));\n\t\t}\n\t\treturn this.formElement;\n\t},\n\tsetForm: function (element) {\n\t\tthis.formElement = element;\n\t\treturn this;\n\t},\n\tregisterEvents: function () {\n\t\tthis.registerButtonsEvent();\n\t\tthis.registerDisabledButtons();\n\t}\n\n});\n\njQuery(document).ready(function (e) {\n\tvar instance = new Settings_CustomView_FilterPermissions_Js();\n\tinstance.registerEvents();\n})\n"],"names":["jQuery","Class","formElement","registerButtonsEvent","container","getForm","find","on","e","thisInstance","setDefaultPreferences","registerDisabledButtons","each","n","sourceClass","currentTarget","data","source","length","is","prop","move","targetClass","target","values","val","label","text","blockLabel","closest","attr","targetOpt","append","targetOption","remove","App","Fields","Picklist","showSelect2ElementView","progressIndicatorElement","$","progressIndicator","message","app","vtranslate","position","blockInfo","enabled","params","tabid","user","cvid","operator","type","saveAjax","done","success","result","mode","Vtiger_Helper_Js","showPnotify","setForm","element","registerEvents","document","ready","instance"],"mappings":"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"}