'use strict';

jQuery.Class('Settings_CustomView_Index_Js',{},{container:!1,contents:!1,initEvents:function c(a){var b=this;a.on('click','.js-delete-filter',function(a){b.deleteFilter(a);}),a.on('change','.js-update-field',function(a){b.updateField(a);}),a.on('click','.js-update,.js-create-filter',function(a){b.update(a);}),a.on('change','.js-module-filter',function(a){b.registerFilterChange(a);});},update:function d(a){var b=$(a.currentTarget),c=b.data('editurl');Vtiger_CustomView_Js.loadFilterView(c);},updateField:function f(a){var b=this,c=$(a.currentTarget),d=c.closest('.js-filter-row');$.progressIndicator({message:app.vtranslate('JS_SAVE_LOADER_INFO'),blockInfo:{enabled:!0}});var e={cvid:d.data('cvid'),mod:d.data('mod'),name:c.attr('name'),value:c.val()};app.saveAjax('updateField',{},e).done(function(){b.getContainer().find('.js-module-filter').trigger('change');});},deleteFilter:function e(a){var b=this,c=$(a.currentTarget),d=c.closest('.js-filter-row');$.progressIndicator({message:app.vtranslate('JS_SAVE_LOADER_INFO'),blockInfo:{enabled:!0}}),app.saveAjax('delete',{},{cvid:d.data('cvid')}).done(function(){b.getContainer().find('.js-module-filter').trigger('change');});},makeFilterListSortable:function d(a){var b=this,c=a.find('tbody');1<c.children().length&&c.each(function(){jQuery(this).sortable({containment:'tbody',revert:!0,tolerance:'pointer',cursor:'move',helper:function c(a,b){return b.children().each(function(a,b){b=jQuery(b),b.width(b.width());}),b},update:function a(){b.updateSequence();}});});},updateSequence:function b(){var a=[];this.getContents().find('.js-filter-row').each(function(b,c){var d=$(c).data('cvid');a.push(d);}),app.saveAjax('upadteSequences',a).done(function(a){a.success&&Vtiger_Helper_Js.showPnotify({text:a.result.message,type:'success'});});},registerFilterChange:function f(a){var b=this,c=$.Deferred(),d=$.progressIndicator({message:app.vtranslate('JS_LOADING_PLEASE_WAIT'),blockInfo:{enabled:!0}}),e={module:app.getModuleName(),view:app.getViewName(),parent:app.getParentModuleName(),sourceModule:$(a.currentTarget).val()};return AppConnector.requestPjax(e).done(function(a){var e=b.getContents().html(a);b.makeFilterListSortable(e),b.getContainer().find('.js-create-filter').data('editurl',e.find('#js-add-filter-url').val()),d.progressIndicator({mode:'hide'}),c.resolve(a);}).fail(function(){c.reject();}),c.promise()},getContainer:function a(){return !1==this.container&&(this.container=jQuery('div.contentsDiv')),this.container},getContents:function a(){return !1==this.contents&&(this.contents=this.getContainer().find('.indexContents')),this.contents},registerEvents:function b(){var a=this.getContainer();this.initEvents(a),this.makeFilterListSortable(a);}});
//# sourceMappingURL=Index.min.js.map
