{"version":3,"file":"ApiAddress.min.js","sources":["ApiAddress.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Settings_ApiAddress_Configuration_Js\", {}, {\n\tregisterChangeApi: function (content) {\n\t\tcontent.find('#change_api').on('change', function () {\n\t\t\tvar value = $(this).val();\n\t\t\tcontent.find('.api_row').addClass('d-none');\n\t\t\tif (value) {\n\t\t\t\tcontent.find('.' + value).removeClass('d-none');\n\t\t\t}\n\t\t});\n\t},\n\tregisterSave: function (content) {\n\t\tvar thisInstance = this;\n\t\tcontent.find('.saveGlobal').on('click', function () {\n\t\t\tvar elements = {\n\t\t\t\tmin_length: $('[name=\"min_length\"]').val(),\n\t\t\t\tresult_num: $('[name=\"result_num\"]').val(),\n\t\t\t\tapi_name: 'global',\n\t\t\t};\n\t\t\tvar params = {};\n\t\t\tparams.data = {module: 'ApiAddress', parent: 'Settings', action: 'SaveConfig', 'elements': elements}\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(\n\t\t\t\tfunction (data) {\n\t\t\t\t\tvar response = data['result'];\n\t\t\t\t\tvar parametres = {\n\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(parametres);\n\t\t\t\t}).fail(function (data, err) {\n\t\t\t\tvar parametres = {\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t};\n\t\t\t\tVtiger_Helper_Js.showPnotify(parametres);\n\t\t\t});\n\t\t});\n\t\tcontent.find('.save').on('click', function () {\n\t\t\tvar elements = {};\n\t\t\tjQuery(this).closest('.apiContainer').find('.api').each(function () {\n\t\t\t\tvar name = jQuery(this).attr('name');\n\n\t\t\t\tif (jQuery(this).attr('type') == 'checkbox') {\n\t\t\t\t\telements[name] = jQuery(this).prop('checked') ? 1 : 0;\n\t\t\t\t} else {\n\t\t\t\t\telements[name] = jQuery(this).val();\n\t\t\t\t}\n\t\t\t});\n\t\t\telements['api_name'] = jQuery(this).closest('.apiContainer').find('.apiAdrress').data('api-name');\n\t\t\t// validate fields\n\t\t\tif (!thisInstance.registerValidate(elements)) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\telements = jQuery.extend({}, elements);\n\t\t\tvar params = {}\n\t\t\tparams.data = {module: 'ApiAddress', parent: 'Settings', action: 'SaveConfig', 'elements': elements}\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tvar response = data['result'];\n\t\t\t\tif (response['success']) {\n\t\t\t\t\tif (elements['key']) {\n\t\t\t\t\t\tthisInstance.registerReload();\n\t\t\t\t\t}\n\t\t\t\t\tvar parametry = {\n\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(parametry);\n\t\t\t\t} else {\n\t\t\t\t\tvar parametry = {\n\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(parametry);\n\t\t\t\t}\n\t\t\t}).fail(function (data, err) {\n\t\t\t\tvar parametry = {\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t};\n\t\t\t\tVtiger_Helper_Js.showPnotify(parametry);\n\t\t\t});\n\t\t});\n\t},\n\tregisterRemoveConnection: function (content) {\n\t\tvar thisInstance = this;\n\t\tcontent.find('.delete').on('click', function () {\n\t\t\tvar elements = {\n\t\t\t\t'key': '0',\n\t\t\t\t'nominatim': '0',\n\t\t\t\tapi_name: jQuery(this).closest('.apiContainer').find('.apiAdrress').data('api-name')\n\t\t\t};\n\t\t\tvar params = {}\n\t\t\tparams.data = {module: 'ApiAddress', parent: 'Settings', action: 'SaveConfig', 'elements': elements}\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tvar response = data['result'];\n\t\t\t\tif (response['success']) {\n\t\t\t\t\tthisInstance.registerReload();\n\t\t\t\t\tvar parametry = {\n\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\ttype: 'success'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(parametry);\n\t\t\t\t} else {\n\t\t\t\t\tvar parametry = {\n\t\t\t\t\t\ttext: response['message'],\n\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showPnotify(parametry);\n\t\t\t\t}\n\t\t\t}).fail(function (data, err) {\n\t\t\t\tvar parametry = {\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t};\n\t\t\t\tVtiger_Helper_Js.showPnotify(parametry);\n\t\t\t});\n\t\t});\n\t},\n\tregisterReload: function () {\n\t\tvar thisInstance = this;\n\t\tvar progress = jQuery.progressIndicator({\n\t\t\t'message': app.vtranslate('JS_LOADING_PLEASE_WAIT'),\n\t\t\t'position': '.contentsDiv',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\n\t\tjQuery.get(\"index.php?module=ApiAddress&parent=Settings&view=Configuration\", function (data) {\n\t\t\tjQuery('.contentsDiv').html(data);\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(jQuery('.contentsDiv').find('select.select2'));\n\t\t\tprogress.progressIndicator({'mode': 'hide'});\n\t\t\tthisInstance.registerEvents();\n\t\t});\n\t},\n\tregisterValidate: function (elements) {\n\t\tvar thisInstance = this;\n\t\tvar status = true;\n\t\tfor (var i in elements) {\n\t\t\tif (i == 'min_length' || i == 'result_num') {\n\t\t\t\tif (!thisInstance.registerValidatemin_length(elements[i])) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (i == 'key') {\n\t\t\t\tif (!thisInstance.registerValidatekey(elements.key, elements.api_name)) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn status;\n\n\t},\n\tregisterValidatemin_length: function (val) {\n\t\tvar filter = /^\\d+$/;\n\n\t\tif (!filter.test(val) || (1 == val || 0 == val)) {\n\t\t\tvar par = {\n\t\t\t\ttext: app.vtranslate('JS_WRONG_NUMBER'),\n\t\t\t\ttype: 'error'\n\t\t\t};\n\t\t\tVtiger_Helper_Js.showPnotify(par);\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t},\n\tregisterValidatekey: function (val, apiName) {\n\t\tvar status = true;\n\n\t\tif ('opencage_data' == apiName) {\n\t\t\tvar test = \"https://api.opencagedata.com/geocode/v1/json?query=test&pretty=1&key=\" + val;\n\t\t\tjQuery.ajax({\n\t\t\t\turl: test,\n\t\t\t\tasync: false,\n\t\t\t\tcomplete: function (data) {\n\t\t\t\t\tif (data.status == 403) {\n\t\t\t\t\t\tvar parametry = {\n\t\t\t\t\t\t\ttext: app.vtranslate('Invalid API key'),\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(parametry);\n\t\t\t\t\t\tstatus = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t} else {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn status;\n\t},\n\tregisterEvents: function () {\n\t\tvar thisInstance = this;\n\t\tvar content = $('.contentsDiv');\n\n\t\tthisInstance.registerChangeApi(content);\n\t\tthisInstance.registerSave(content);\n\t\tthisInstance.registerRemoveConnection(content);\n\t}\n});\n"],"names":["jQuery","Class","registerChangeApi","content","find","on","$","val","addClass","value","removeClass","registerSave","min_length","result_num","api_name","params","data","module","parent","action","elements","async","dataType","AppConnector","request","done","parametres","text","response","type","Vtiger_Helper_Js","showPnotify","fail","app","vtranslate","closest","each","attr","name","prop","thisInstance","registerValidate","extend","registerReload","parametry","registerRemoveConnection","progress","progressIndicator","get","html","App","Fields","Picklist","showSelect2ElementView","registerEvents","registerValidatemin_length","filter","test","par","registerValidatekey","apiName","ajax","url","complete","status"],"mappings":"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"}