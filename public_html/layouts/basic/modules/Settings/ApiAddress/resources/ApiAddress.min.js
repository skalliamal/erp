'use strict';

jQuery.Class('Settings_ApiAddress_Configuration_Js',{},{registerChangeApi:function b(a){a.find('#change_api').on('change',function(){var b=$(this).val();a.find('.api_row').addClass('d-none'),b&&a.find('.'+b).removeClass('d-none');});},registerSave:function c(a){var b=this;a.find('.saveGlobal').on('click',function(){var a={min_length:$('[name="min_length"]').val(),result_num:$('[name="result_num"]').val(),api_name:'global'},b={};b.data={module:'ApiAddress',parent:'Settings',action:'SaveConfig',elements:a},b.async=!1,b.dataType='json',AppConnector.request(b).done(function(a){var b=a.result,c={text:b.message,type:'success'};Vtiger_Helper_Js.showPnotify(c);}).fail(function(){var a={text:app.vtranslate('JS_ERROR'),type:'error'};Vtiger_Helper_Js.showPnotify(a);});}),a.find('.save').on('click',function(){var a={};if(jQuery(this).closest('.apiContainer').find('.api').each(function(){var b=jQuery(this).attr('name');a[b]='checkbox'==jQuery(this).attr('type')?jQuery(this).prop('checked')?1:0:jQuery(this).val();}),a.api_name=jQuery(this).closest('.apiContainer').find('.apiAdrress').data('api-name'),!b.registerValidate(a))return !1;a=jQuery.extend({},a);var c={};c.data={module:'ApiAddress',parent:'Settings',action:'SaveConfig',elements:a},c.async=!1,c.dataType='json',AppConnector.request(c).done(function(c){var d=c.result;if(d.success){a.key&&b.registerReload();var e={text:d.message,type:'success'};Vtiger_Helper_Js.showPnotify(e);}else{var e={text:d.message,type:'error'};Vtiger_Helper_Js.showPnotify(e);}}).fail(function(){var a={text:app.vtranslate('JS_ERROR'),type:'error'};Vtiger_Helper_Js.showPnotify(a);});});},registerRemoveConnection:function c(a){var b=this;a.find('.delete').on('click',function(){var a={key:'0',nominatim:'0',api_name:jQuery(this).closest('.apiContainer').find('.apiAdrress').data('api-name')},c={};c.data={module:'ApiAddress',parent:'Settings',action:'SaveConfig',elements:a},c.async=!1,c.dataType='json',AppConnector.request(c).done(function(a){var c=a.result;if(c.success){b.registerReload();var d={text:c.message,type:'success'};Vtiger_Helper_Js.showPnotify(d);}else{var d={text:c.message,type:'error'};Vtiger_Helper_Js.showPnotify(d);}}).fail(function(){var a={text:app.vtranslate('JS_ERROR'),type:'error'};Vtiger_Helper_Js.showPnotify(a);});});},registerReload:function c(){var a=this,b=jQuery.progressIndicator({message:app.vtranslate('JS_LOADING_PLEASE_WAIT'),position:'.contentsDiv',blockInfo:{enabled:!0}});jQuery.get('index.php?module=ApiAddress&parent=Settings&view=Configuration',function(c){jQuery('.contentsDiv').html(c),App.Fields.Picklist.showSelect2ElementView(jQuery('.contentsDiv').find('select.select2')),b.progressIndicator({mode:'hide'}),a.registerEvents();});},registerValidate:function d(a){return !0},registerValidatemin_length:function d(a){var b=/^\d+$/;if(!b.test(a)||1==a||0==a){var c={text:app.vtranslate('JS_WRONG_NUMBER'),type:'error'};return Vtiger_Helper_Js.showPnotify(c),!1}return !0},registerValidatekey:function d(a,b){var c=!0;if('opencage_data'==b){jQuery.ajax({url:'https://api.opencagedata.com/geocode/v1/json?query=test&pretty=1&key='+a,async:!1,complete:function d(a){if(403==a.status){var b={text:app.vtranslate('Invalid API key'),type:'error'};Vtiger_Helper_Js.showPnotify(b),c=!1;}}});}else return !0;return c},registerEvents:function c(){var a=this,b=$('.contentsDiv');a.registerChangeApi(b),a.registerSave(b),a.registerRemoveConnection(b);}});
//# sourceMappingURL=ApiAddress.min.js.map
