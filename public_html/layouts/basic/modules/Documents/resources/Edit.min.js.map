{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_Edit_Js(\"Documents_Edit_Js\", {}, {\n\n\tINTERNAL_FILE_LOCATION_TYPE: 'I',\n\tEXTERNAL_FILE_LOCATION_TYPE: 'E',\n\n\tgetMaxiumFileUploadingSize: function (container) {\n\t\treturn container.find('.maxUploadSize').data('value');\n\t},\n\n\tisFileLocationInternalType: function (fileLocationElement) {\n\t\tif (fileLocationElement.val() == this.INTERNAL_FILE_LOCATION_TYPE) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\tisFileLocationExternalType: function (fileLocationElement) {\n\t\tif (fileLocationElement.val() == this.EXTERNAL_FILE_LOCATION_TYPE) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t},\n\n\tconvertFileSizeInToDisplayFormat: function (fileSizeInBytes) {\n\t\tvar i = -1;\n\t\tvar byteUnits = [' kB', ' MB', ' GB', ' TB', 'PB', 'EB', 'ZB', 'YB'];\n\t\tdo {\n\t\t\tfileSizeInBytes = fileSizeInBytes / 1024;\n\t\t\ti++;\n\t\t} while (fileSizeInBytes > 1024);\n\n\t\treturn Math.max(fileSizeInBytes, 0.1).toFixed(1) + byteUnits[i];\n\n\t},\n\n\tregisterFileLocationTypeChangeEvent: function (container) {\n\t\tvar thisInstance = this;\n\t\tcontainer.on('change', 'select[name=\"filelocationtype\"]', function (e) {\n\t\t\tvar fileLocationTypeElement = container.find('[name=\"filelocationtype\"]');\n\t\t\tvar fileNameElement = container.find('[name=\"filename\"]');\n\t\t\tvar newFileNameElement;\n\t\t\tif (thisInstance.isFileLocationInternalType(fileLocationTypeElement)) {\n\t\t\t\tnewFileNameElement = jQuery('<input type=\"file\"/>');\n\t\t\t} else {\n\t\t\t\tnewFileNameElement = jQuery('<input type=\"text\" />');\n\t\t\t}\n\t\t\tvar oldElementAttributeList = fileNameElement.get(0).attributes;\n\n\t\t\tfor (var index = 0; index < oldElementAttributeList.length; index++) {\n\t\t\t\tvar attributeObject = oldElementAttributeList[index];\n\t\t\t\t//Dont update the type attribute\n\t\t\t\tif (attributeObject.name == 'type' || attributeObject.name == 'value' || attributeObject.name == 'class') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tvar value = attributeObject.value;\n\t\t\t\tvar className = '';\n\t\t\t\tif (attributeObject.name == 'data-fieldinfo') {\n\t\t\t\t\tvalue = JSON.parse(value);\n\t\t\t\t\tif (thisInstance.isFileLocationExternalType(fileLocationTypeElement)) {\n\t\t\t\t\t\tvalue['type'] = 'url';\n\t\t\t\t\t\tclassName = 'form-control';\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvalue['type'] = 'file';\n\t\t\t\t\t}\n\t\t\t\t\tvalue = JSON.stringify(value);\n\t\t\t\t}\n\t\t\t\tnewFileNameElement.attr(attributeObject.name, value);\n\t\t\t\tnewFileNameElement.addClass(className);\n\t\t\t}\n\t\t\tfileNameElement.replaceWith(newFileNameElement);\n\t\t\tvar fileNameElementTd = newFileNameElement.closest('.fieldValue');\n\t\t\tvar uploadFileDetails = fileNameElementTd.find('.uploadedFileDetails');\n\t\t\tif (thisInstance.isFileLocationExternalType(fileLocationTypeElement)) {\n\t\t\t\tuploadFileDetails.addClass('d-none').removeClass('show');\n\t\t\t} else {\n\t\t\t\tuploadFileDetails.addClass('show').removeClass('d-none');\n\t\t\t}\n\t\t});\n\t},\n\n\tregisterFileChangeEvent: function (container) {\n\t\tvar thisInstance = this;\n\t\tcontainer.on('change', 'input[name=\"filename\"]', function (e) {\n\t\t\tif (e.target.type == \"text\")\n\t\t\t\treturn false;\n\t\t\tfile = e.target.files[0];\n\t\t\tvar element = container.find('[name=\"filename\"]');\n\t\t\t//ignore all other types than file\n\t\t\tif (element.attr('type') != 'file') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tvar uploadFileSizeHolder = element.closest('.fileUploadContainer').find('.uploadedFileSize');\n\t\t\tvar fileSize = element.get(0).files[0].size;\n\t\t\tvar maxFileSize = thisInstance.getMaxiumFileUploadingSize(container);\n\t\t\tif (fileSize > maxFileSize) {\n\t\t\t\talert(app.vtranslate('JS_EXCEEDS_MAX_UPLOAD_SIZE'));\n\t\t\t\telement.val('');\n\t\t\t\tuploadFileSizeHolder.text('');\n\t\t\t} else {\n\t\t\t\tuploadFileSizeHolder.text(thisInstance.convertFileSizeInToDisplayFormat(fileSize));\n\t\t\t}\n\n\t\t});\n\t},\n\n\t/**\n\t * Function to save the quickcreate module\n\t * @param accepts form element as parameter\n\t * @return returns deferred promise\n\t */\n\tquickCreateSave: function (form) {\n\t\tvar thisInstance = this;\n\t\tvar aDeferred = jQuery.Deferred();\n\t\t//Using formData object to send data to server as a multipart/form-data form submit\n\t\tvar formData = new FormData(form[0]);\n\t\tvar fileLocationTypeElement = form.find('[name=\"filelocationtype\"]');\n\t\tif (typeof file !== \"undefined\" && thisInstance.isFileLocationInternalType(fileLocationTypeElement)) {\n\t\t\tformData.append(\"filename\", file);\n\t\t\tfile = false;\n\t\t}\n\t\tif (formData) {\n\t\t\tvar params = {\n\t\t\t\turl: \"index.php\",\n\t\t\t\ttype: \"POST\",\n\t\t\t\tdata: formData,\n\t\t\t\tprocessData: false,\n\t\t\t\tcontentType: false\n\t\t\t};\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\taDeferred.resolve(data);\n\t\t\t}).fail(function (textStatus, errorThrown) {\n\t\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t\t});\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\tregisterBasicEvents: function (container) {\n\t\tthis._super(container);\n\t\tthis.registerFileLocationTypeChangeEvent(container);\n\t\tthis.registerFileChangeEvent(container);\n\t},\n\n\tregisterEvents: function () {\n\t\tthis._super();\n\t}\n});\n\n\n"],"names":["Vtiger_Edit_Js","INTERNAL_FILE_LOCATION_TYPE","EXTERNAL_FILE_LOCATION_TYPE","getMaxiumFileUploadingSize","container","find","data","isFileLocationInternalType","fileLocationElement","val","isFileLocationExternalType","convertFileSizeInToDisplayFormat","fileSizeInBytes","i","max","toFixed","registerFileLocationTypeChangeEvent","on","fileLocationTypeElement","fileNameElement","newFileNameElement","thisInstance","jQuery","oldElementAttributeList","get","attributes","index","length","attributeObject","name","value","className","JSON","parse","stringify","attr","addClass","replaceWith","closest","uploadFileDetails","fileNameElementTd","removeClass","registerFileChangeEvent","e","target","type","file","files","element","fileSize","size","maxFileSize","alert","app","vtranslate","uploadFileSizeHolder","text","quickCreateSave","form","aDeferred","Deferred","formData","append","AppConnector","request","url","processData","contentType","done","resolve","fail","textStatus","errorThrown","reject","promise","registerBasicEvents","_super","registerEvents"],"mappings":"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"}