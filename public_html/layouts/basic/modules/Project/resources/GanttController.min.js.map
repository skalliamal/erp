{"version":3,"file":"GanttController.min.js","sources":["GanttController.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\n$.Class(\"Project_Gantt_Js\", {}, {\n\tfilterSelectElement: false,\n\tgetFilterSelectElement: function () {\n\t\tif (this.filterSelectElement == false) {\n\t\t\tthis.filterSelectElement = jQuery('#customFilter');\n\t\t}\n\t\treturn this.filterSelectElement;\n\t},\n\tgetDefaultParams: function () {\n\t\tvar params = {\n\t\t\tmodule: app.getModuleName(),\n\t\t\taction: 'GanttData',\n\t\t};\n\t\tif (app.getParentModuleName()) {\n\t\t\tparams.parent = app.getParentModuleName();\n\t\t}\n\t\treturn params;\n\t},\n\tgetCurrentCvId: function () {\n\t\treturn jQuery('#customFilter').find('option:selected').data('id');\n\t},\n\tgetGanttData(urlParams) {\n\t\tlet aDeferred = $.Deferred();\n\t\tif (typeof urlParams === \"undefined\") {\n\t\t\turlParams = {};\n\t\t}\n\t\tconst progressIndicatorElement = $.progressIndicator({\n\t\t\tposition: 'html',\n\t\t\tblockInfo: {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tlet defaultParams = this.getDefaultParams();\n\t\turlParams = $.extend(defaultParams, urlParams);\n\t\tAppConnector.request(urlParams).done(function (data) {\n\t\t\tprogressIndicatorElement.progressIndicator({mode: 'hide'});\n\t\t\taDeferred.resolve(data);\n\t\t\tapp.notifyPostAjaxReady();\n\t\t}).fail(function (textStatus, errorThrown) {\n\t\t\taDeferred.reject(textStatus, errorThrown);\n\t\t});\n\t\treturn aDeferred.promise();\n\t},\n\t/**\n\t * load gantt\n\t */\n\tloadGantt(container = '.js-gantt__container', ganttData = false) {\n\t\tcontainer = $(container);\n\t\tlet parent = container.parent();\n\t\tlet html = container.html();\n\t\tcontainer.remove();\n\t\tcontainer = $(parent).append(html);\n\t\tthis.gantt = new Gantt(container);\n\t\tconst projectId = parent.find('input[name=\"projectId\"]').val();\n\t\tif (!ganttData) {\n\t\t\tthis.gantt.loadProjectFromAjax({\n\t\t\t\tmodule: 'Project',\n\t\t\t\taction: 'GanttData',\n\t\t\t\tprojectId: projectId\n\t\t\t});\n\t\t}\n\t},\n\t/**\n\t * reload gantt with new data\n\t * @param data\n\t */\n\treloadData(data) {\n\t\tthis.gantt.reloadData(data);\n\t},\n\t/*\n\t * Function to register the event for changing the custom Filter\n\t */\n\tregisterChangeCustomFilterEvent: function () {\n\t\tvar thisInstance = this;\n\t\tthis.getFilterSelectElement().on('change', function (event) {\n\t\t\t$(`.nav-item[data-cvid='${thisInstance.getCurrentCvId()}'] .nav-link`).tab('show');\n\t\t\tvar currentTarget = jQuery(event.currentTarget);\n\t\t\tvar selectOption = currentTarget.find(':selected');\n\t\t\tapp.setMainParams('pageNumber', '1');\n\t\t\tapp.setMainParams('pageToJump', '1');\n\t\t\tapp.setMainParams('orderBy', selectOption.data('orderby'));\n\t\t\tapp.setMainParams('sortOrder', selectOption.data('sortorder'));\n\t\t\tthisInstance.getGanttData({\n\t\t\t\t\"viewname\": jQuery(this).val(),\n\t\t\t}).done(function (data) {\n\t\t\t\tthisInstance.reloadData(data.result);\n\t\t\t});\n\t\t\tevent.stopPropagation();\n\t\t});\n\t},\n\tgetSelectOptionFromChosenOption: function (liElement) {\n\t\tvar id = liElement.attr(\"id\");\n\t\tvar idArr = id.split(\"-\");\n\t\tvar currentOptionId = '';\n\t\tif (idArr.length > 0) {\n\t\t\tcurrentOptionId = idArr[idArr.length - 1];\n\t\t} else {\n\t\t\treturn false;\n\t\t}\n\t\treturn jQuery('#filterOptionId_' + currentOptionId);\n\t},\n\tchangeCustomFilterElementView: function () {\n\t\tvar thisInstance = this;\n\t\tvar filterSelectElement = this.getFilterSelectElement();\n\t\tif (filterSelectElement.length > 0 && filterSelectElement.is(\"select\")) {\n\t\t\tApp.Fields.Picklist.showSelect2ElementView(filterSelectElement, {\n\t\t\t\ttemplateSelection: function (data) {\n\t\t\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\t\t\tresultContainer.append(jQuery(jQuery('.filterImage').clone().get(0)).show());\n\t\t\t\t\tresultContainer.append(data.text);\n\t\t\t\t\treturn resultContainer;\n\t\t\t\t},\n\t\t\t\tcustomSortOptGroup: true,\n\t\t\t\tcloseOnSelect: true\n\t\t\t});\n\n\t\t\tvar select2Instance = filterSelectElement.data('select2');\n\t\t\tjQuery('.filterActionsDiv').appendTo(select2Instance.$dropdown.find('.select2-dropdown:last')).removeClass('d-none').on('click', function (e) {\n\t\t\t\tthisInstance.registerCreateFilterClickEvent(e);\n\t\t\t});\n\t\t}\n\t},\n\tregisterEvents: function () {\n\t\tthis.changeCustomFilterElementView();\n\t\tthis.registerChangeCustomFilterEvent();\n\t\tVtiger_Helper_Js.showHorizontalTopScrollBar();\n\t\tthis.loadGantt();\n\t},\n});\n\n"],"names":["$","Class","filterSelectElement","getFilterSelectElement","jQuery","getDefaultParams","module","app","getModuleName","action","getParentModuleName","params","parent","getCurrentCvId","find","data","getGanttData","urlParams","Deferred","progressIndicator","position","blockInfo","defaultParams","extend","AppConnector","request","done","progressIndicatorElement","mode","aDeferred","resolve","notifyPostAjaxReady","fail","textStatus","errorThrown","reject","promise","loadGantt","ganttData","container","html","remove","append","gantt","val","loadProjectFromAjax","projectId","reloadData","registerChangeCustomFilterEvent","on","event","thisInstance","tab","currentTarget","selectOption","setMainParams","result","stopPropagation","getSelectOptionFromChosenOption","liElement","attr","idArr","id","split","currentOptionId","length","changeCustomFilterElementView","is","App","Fields","Picklist","showSelect2ElementView","templateSelection","clone","get","show","resultContainer","text","customSortOptGroup","closeOnSelect","appendTo","select2Instance","$dropdown","removeClass","e","registerCreateFilterClickEvent","registerEvents","Vtiger_Helper_Js","showHorizontalTopScrollBar"],"mappings":";;AAGAA,EAAEC,KAAF,CAAQ,kBAAR,CAA4B,EAA5B,CAAgC,CAC/BC,sBAD+B,CAE/BC,uBAAwB,YAAY,CAInC,OAHI,SAAKD,mBAGT,GAFC,KAAKA,mBAAL,CAA2BE,OAAO,eAAP,CAE5B,EAAO,KAAKF,mBACZ,CAP8B,CAQ/BG,iBAAkB,YAAY,CAC7B,MAAa,CACZC,OAAQC,IAAIC,aAAJ,EADI,CAEZC,OAAQ,WAFI,CAAb,CAOA,WAHQC,mBAAJ,EAGJ,GAFCC,EAAOC,MAAP,CAAgBL,IAAIG,mBAAJ,EAEjB,EAAOC,CACP,CAjB8B,CAkB/BE,eAAgB,YAAY,CAC3B,cAAc,eAAP,EAAwBC,IAAxB,CAA6B,iBAA7B,EAAgDC,IAAhD,CAAqD,IAArD,CACP,CApB8B,CAqB/BC,YArB+B,YAqBlBC,CArBkB,CAqBP,CACvB,MAAgBjB,EAAEkB,QAAF,EAAhB,CACyB,WAArB,UAFmB,GAGtBD,EAAY,EAHU,QAKUjB,EAAEmB,iBAAF,CAAoB,CACpDC,SAAU,MAD0C,CAEpDC,UAAW,CACV,UADU,CAFyC,CAApB,CALV,CAWnBC,EAAgB,KAAKjB,gBAAL,EAXG,CAoBvB,SARYL,EAAEuB,MAAF,CAASD,CAAT,CAAwBL,CAAxB,CAQZ,CAPAO,aAAaC,OAAb,CAAqBR,CAArB,EAAgCS,IAAhC,CAAqC,SAAUX,CAAV,CAAgB,CACpDY,EAAyBR,iBAAzB,CAA2C,CAACS,KAAM,MAAP,CAA3C,CADoD,CAEpDC,EAAUC,OAAV,CAAkBf,CAAlB,CAFoD,CAGpDR,IAAIwB,mBAAJ,GACA,CAJD,EAIGC,IAJH,CAIQ,SAAUC,CAAV,CAAsBC,CAAtB,CAAmC,CAC1CL,EAAUM,MAAV,CAAiBF,CAAjB,CAA6BC,CAA7B,EACA,CAND,CAOA,CAAOL,EAAUO,OAAV,EACP,CA1C8B,CA8C/BC,SA9C+B,aA8CkC,MAAA,wDAA3C,sBAA2C,CAAnBC,CAAmB,6DAChEC,EAAYvC,EAAEuC,CAAF,CADoD,OAEnDA,EAAU3B,MAAV,EAFmD,CAG5D4B,EAAOD,EAAUC,IAAV,EAHqD,CAIhED,EAAUE,MAAV,EAJgE,CAKhEF,EAAYvC,EAAEY,CAAF,EAAU8B,MAAV,CAAiBF,CAAjB,CALoD,CAMhE,KAAKG,KAAL,CAAa,SAAA,CAAUJ,CAAV,CANmD,CAOhE,MAAkB3B,EAAOE,IAAP,CAAY,yBAAZ,EAAuC8B,GAAvC,EAAlB,CACKN,CAR2D,EAS/D,KAAKK,KAAL,CAAWE,mBAAX,CAA+B,CAC9BvC,OAAQ,SADsB,CAE9BG,OAAQ,WAFsB,CAG9BqC,UAAWA,CAHmB,CAA/B,EAMD,CA7D8B,CAkE/BC,UAlE+B,YAkEpBhC,CAlEoB,CAkEd,CAChB,KAAK4B,KAAL,CAAWI,UAAX,CAAsBhC,CAAtB,EACA,CApE8B,CAwE/BiC,gCAAiC,YAAY,CAC5C,MAAmB,IAAnB,CACA,KAAK7C,sBAAL,GAA8B8C,EAA9B,CAAiC,QAAjC,CAA2C,SAAUC,CAAV,CAAiB,CAC3DlD,2BAA0BmD,EAAatC,cAAb,EAA1B,kBAAuEuC,GAAvE,CAA2E,MAA3E,CAD2D,OAEvChD,OAAO8C,EAAMG,aAAb,CAFuC,CAGvDC,EAAeD,EAAcvC,IAAd,CAAmB,WAAnB,CAHwC,CAI3DP,IAAIgD,aAAJ,CAAkB,YAAlB,CAAgC,GAAhC,CAJ2D,CAK3DhD,IAAIgD,aAAJ,CAAkB,YAAlB,CAAgC,GAAhC,CAL2D,CAM3DhD,IAAIgD,aAAJ,CAAkB,SAAlB,CAA6BD,EAAavC,IAAb,CAAkB,SAAlB,CAA7B,CAN2D,CAO3DR,IAAIgD,aAAJ,CAAkB,WAAlB,CAA+BD,EAAavC,IAAb,CAAkB,WAAlB,CAA/B,CAP2D,CAQ3DoC,EAAanC,YAAb,CAA0B,CACzB,SAAYZ,OAAO,IAAP,EAAawC,GAAb,EADa,CAA1B,EAEGlB,IAFH,CAEQ,SAAUX,CAAV,CAAgB,CACvBoC,EAAaJ,UAAb,CAAwBhC,EAAKyC,MAA7B,EACA,CAJD,CAR2D,CAa3DN,EAAMO,eAAN,GACA,CAdD,EAeA,CAzF8B,CA0F/BC,gCAAiC,WAAUC,CAAV,CAAqB,OAC5CA,EAAUC,IAAV,CAAe,IAAf,CAD4C,CAEjDC,EAAQC,EAAGC,KAAH,CAAS,GAAT,CAFyC,CAGjDC,EAAkB,EAH+B,CAIrD,GAAmB,CAAf,GAAMC,MAAV,CACCD,EAAkBH,EAAMA,EAAMI,MAAN,CAAe,CAArB,CADnB,gBAKA,cAAc,mBAAqBD,CAA5B,CACP,CApG8B,CAqG/BE,8BAA+B,YAAY,OACvB,IADuB,CAEtChE,EAAsB,KAAKC,sBAAL,EAFgB,CAG1C,GAAiC,CAA7B,GAAoB8D,MAApB,EAAkC/D,EAAoBiE,EAApB,CAAuB,QAAvB,CAAtC,CAAwE,CACvEC,IAAIC,MAAJ,CAAWC,QAAX,CAAoBC,sBAApB,CAA2CrE,CAA3C,CAAgE,CAC/DsE,kBAAmB,WAAUzD,CAAV,CAAgB,CAClC,MAAsBX,OAAO,eAAP,CAAtB,CAGA,SAFgBsC,MAAhB,CAAuBtC,OAAOA,OAAO,cAAP,EAAuBqE,KAAvB,GAA+BC,GAA/B,CAAmC,CAAnC,CAAP,EAA8CC,IAA9C,EAAvB,CAEA,CADAC,EAAgBlC,MAAhB,CAAuB3B,EAAK8D,IAA5B,CACA,CAAOD,CACP,CAN8D,CAO/DE,qBAP+D,CAQ/DC,gBAR+D,CAAhE,CADuE,CAYvE,MAAsB7E,EAAoBa,IAApB,CAAyB,SAAzB,CAAtB,CACAX,OAAO,mBAAP,EAA4B4E,QAA5B,CAAqCC,EAAgBC,SAAhB,CAA0BpE,IAA1B,CAA+B,wBAA/B,CAArC,EAA+FqE,WAA/F,CAA2G,QAA3G,EAAqHlC,EAArH,CAAwH,OAAxH,CAAiI,SAAUmC,CAAV,CAAa,CAC7IjC,EAAakC,8BAAb,CAA4CD,CAA5C,EACA,CAFD,EAGA,CACD,CAzH8B,CA0H/BE,eAAgB,YAAY,CAC3B,KAAKpB,6BAAL,EAD2B,CAE3B,KAAKlB,+BAAL,EAF2B,CAG3BuC,iBAAiBC,0BAAjB,EAH2B,CAI3B,KAAKnD,SAAL,GACA,CA/H8B,CAAhC"}