{"version":3,"file":"Detail.min.js","sources":["Detail.js"],"sourcesContent":["/*+***********************************************************************************\n * The contents of this file are subject to the vtiger CRM Public License Version 1.0\n * (\"License\"); You may not use this file except in compliance with the License\n * The Original Code is:  vtiger CRM Open Source\n * The Initial Developer of the Original Code is vtiger.\n * Portions created by vtiger are Copyright (C) vtiger.\n * All Rights Reserved.\n *************************************************************************************/\n'use strict';\n\nVtiger_Detail_Js(\"Accounts_Detail_Js\", {}, {\n\t//It stores the Account Hierarchy response data\n\taccountHierarchyResponseCache: {},\n\t/*\n\t * function to get the AccountHierarchy response data\n\t */\n\tgetAccountHierarchyResponseData: function (params) {\n\t\tvar thisInstance = this;\n\t\tvar aDeferred = jQuery.Deferred();\n\n\t\t//Check in the cache\n\t\tif (!(jQuery.isEmptyObject(thisInstance.accountHierarchyResponseCache))) {\n\t\t\taDeferred.resolve(thisInstance.accountHierarchyResponseCache);\n\t\t} else {\n\t\t\tAppConnector.request(params).done(\n\t\t\t\tfunction (data) {\n\t\t\t\t\t//store it in the cache, so that we dont do multiple request\n\t\t\t\t\tthisInstance.accountHierarchyResponseCache = data;\n\t\t\t\t\taDeferred.resolve(thisInstance.accountHierarchyResponseCache);\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\t\treturn aDeferred.promise();\n\t},\n\tregisterButtons: function (container) {\n\t\tcontainer.find('.toChangeBtn').on('click', function (e) {\n\t\t\tvar currentTarget = $(e.currentTarget);\n\t\t\tvar fieldname = currentTarget.data('fieldname');\n\t\t\tvar params = {\n\t\t\t\tvalue: currentTarget.hasClass('btn-success') ? 0 : 1,\n\t\t\t\tfield: fieldname,\n\t\t\t\trecord: currentTarget.data('recordId'),\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'SaveAjax'\n\t\t\t};\n\t\t\tAppConnector.request(params).done(\n\t\t\t\tfunction (data) {\n\t\t\t\t\tif (currentTarget.hasClass('btn-warning')) {\n\t\t\t\t\t\tcurrentTarget.removeClass('btn-warning');\n\t\t\t\t\t\tcurrentTarget.addClass('btn-success');\n\t\t\t\t\t} else {\n\t\t\t\t\t\tcurrentTarget.addClass('btn-warning');\n\t\t\t\t\t\tcurrentTarget.removeClass('btn-success');\n\t\t\t\t\t}\n\t\t\t\t\tcurrentTarget.html(data.result[fieldname].display_value);\n\t\t\t\t\tvar params = {\n\t\t\t\t\t\ttitle: app.vtranslate('JS_LBL_PERMISSION'),\n\t\t\t\t\t\ttext: app.vtranslate('JS_SAVE_NOTIFY_OK'),\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t};\n\t\t\t\t\tVtiger_Helper_Js.showMessage(params);\n\t\t\t\t}\n\t\t\t);\n\t\t});\n\t},\n\t/*\n\t * function to display the AccountHierarchy response data\n\t */\n\tdisplayAccountHierarchyResponseData: function (data) {\n\t\tvar thisInstance = this;\n\t\tapp.showModalWindow(data, function (container) {\n\t\t\tvar bodyModal = container.find('.maxHeightModal');\n\t\t\tapp.showScrollBar(bodyModal, {\n\t\t\t\theight: bodyModal.height,\n\t\t\t\trailVisible: true,\n\t\t\t\tsize: '6px'\n\t\t\t});\n\t\t\tthisInstance.registerButtons(container);\n\t\t});\n\t},\n\tregisterHierarchyRecordCount: function () {\n\t\tvar hierarchyButton = $('.detailViewTitle .hierarchy');\n\t\tif (hierarchyButton.length) {\n\t\t\tvar params = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'RelationAjax',\n\t\t\t\trecord: app.getRecordId(),\n\t\t\t\tmode: 'getHierarchyCount',\n\t\t\t};\n\t\t\tAppConnector.request(params).done(function (response) {\n\t\t\t\tif (response.success) {\n\t\t\t\t\t$('.detailViewTitle .hierarchy .badge').html(response.result);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\t},\n\tregisterShowHierarchy: function () {\n\t\tvar thisInstance = this;\n\t\tvar hierarchyButton = $('.detailViewTitle');\n\t\tvar url = \"index.php?module=Accounts&view=AccountHierarchy&record=\" + app.getRecordId();\n\t\thierarchyButton.on('click', '.js-detail__icon, .recordLabelValue', function (e) {\n\t\t\tthisInstance.getAccountHierarchyResponseData(url).done(function (data) {\n\t\t\t\tthisInstance.displayAccountHierarchyResponseData(data);\n\t\t\t});\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tthis._super();\n\t\tthis.registerHierarchyRecordCount();\n\t\tthis.registerShowHierarchy();\n\t}\n});\n"],"names":["Vtiger_Detail_Js","accountHierarchyResponseCache","getAccountHierarchyResponseData","params","aDeferred","jQuery","Deferred","isEmptyObject","thisInstance","AppConnector","request","done","data","resolve","promise","registerButtons","container","find","on","e","$","currentTarget","fieldname","value","hasClass","field","record","module","app","getModuleName","action","removeClass","addClass","html","result","display_value","title","vtranslate","text","type","Vtiger_Helper_Js","showMessage","displayAccountHierarchyResponseData","showModalWindow","showScrollBar","bodyModal","height","railVisible","size","registerHierarchyRecordCount","hierarchyButton","length","getRecordId","mode","response","success","registerShowHierarchy","url","registerEvents","_super"],"mappings":"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"}