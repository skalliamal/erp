{"version":3,"file":"ActivityStateModal.min.js","sources":["ActivityStateModal.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Calendar_ActivityStateModal_Js\", {}, {\n\tregisterActivityState: function () {\n\t\tvar thisInstance = this;\n\t\tjQuery('#activityStateModal button:not(.close)').on('click', function (e) {\n\t\t\tvar currentTarget = jQuery(e.currentTarget);\n\t\t\tcurrentTarget.closest('.modal').addClass('d-none');\n\t\t\tif (currentTarget.data('type') == '1') {\n\t\t\t\tthisInstance.updateActivityState(currentTarget);\n\t\t\t}\n\t\t\tif (currentTarget.hasClass('showQuickCreate')) {\n\t\t\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t\t\t'position': 'html',\n\t\t\t\t\t'blockInfo': {\n\t\t\t\t\t\t'enabled': true\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tvar moduleName = 'Calendar';\n\t\t\t\tvar url = 'index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord=' + currentTarget.data('id');\n\t\t\t\tvar params = {};\n\t\t\t\tparams.noCache = true;\n\t\t\t\tvar subject = currentTarget.closest('.modalEditStatus').find('.modalSummaryValues .fieldVal').data('subject');\n\t\t\t\tvar headerInstance = Vtiger_Header_Js.getInstance();\n\t\t\t\theaderInstance.getQuickCreateForm(url, moduleName, params).done(function (data) {\n\t\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t\t\tif (currentTarget.data('type') == '0' && typeof subject !== \"undefined\" && subject.length > 0) {\n\t\t\t\t\t\tdata = jQuery(data);\n\t\t\t\t\t\tvar element = data.find('[name=\"subject\"]');\n\t\t\t\t\t\tif (element.length) {\n\t\t\t\t\t\t\telement.val(subject);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\theaderInstance.handleQuickCreateData(data, {\n\t\t\t\t\t\tcallbackFunction: function (data) {\n\t\t\t\t\t\t\tif (data && data.success && data.result.followup.value == currentTarget.data('id')) {\n\t\t\t\t\t\t\t\tthisInstance.updateActivityState(currentTarget);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t},\n\tupdateActivityState: function (currentTarget) {\n\t\tvar thisInstance = this;\n\t\tvar params = {\n\t\t\tmodule: 'Calendar',\n\t\t\taction: \"ActivityStateAjax\",\n\t\t\trecord: currentTarget.data('id'),\n\t\t\tstate: currentTarget.data('state')\n\t\t};\n\t\tapp.hideModalWindow();\n\t\tvar progressIndicatorElement = jQuery.progressIndicator({\n\t\t\t'position': 'html',\n\t\t\t'blockInfo': {\n\t\t\t\t'enabled': true\n\t\t\t}\n\t\t});\n\t\tAppConnector.request(params).done(function (data) {\n\t\t\tif (data.success) {\n\t\t\t\tvar viewName = app.getViewName();\n\t\t\t\tif (viewName === 'Detail') {\n\t\t\t\t\tvar widget = jQuery('.activityWidgetContainer .widgetContentBlock');\n\t\t\t\t\tvar thisInstance = Vtiger_Detail_Js.getInstance();\n\t\t\t\t\tif (widget.length) {\n\t\t\t\t\t\tthisInstance.loadWidget(widget);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar recentActivitiesTab = thisInstance.getTabByLabel(thisInstance.detailViewRecentActivitiesTabLabel);\n\t\t\t\t\t\tif (recentActivitiesTab) {\n\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (app.getModuleName() == 'Calendar') {\n\t\t\t\t\t\t\trecentActivitiesTab = ((!thisInstance.getSelectedTab().length || thisInstance.getSelectedTab().data('linkKey') == thisInstance.detailViewDetailsTabLabel) ? thisInstance.getTabContainer().find('[data-link-key=\"' + thisInstance.detailViewDetailsTabLabel + '\"]:not(.d-none)') : jQuery('<div></div>'));\n\t\t\t\t\t\t\tjQuery('.showModal.closeCalendarRekord').addClass('d-none');\n\t\t\t\t\t\t\trecentActivitiesTab.trigger('click');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (viewName == 'List') {\n\t\t\t\t\tvar listinstance = new Vtiger_List_Js();\n\t\t\t\t\tlistinstance.getListViewRecords();\n\t\t\t\t}\n\t\t\t\tif (viewName == 'DashBoard') {\n\t\t\t\t\t(new Vtiger_DashBoard_Js()).getContainer().find('a[name=\"drefresh\"]').trigger('click');\n\t\t\t\t}\n\t\t\t\tif (app.getModuleName() == 'Calendar' && viewName == 'Calendar') {\n\t\t\t\t\t(Calendar_CalendarView_Js.getInstanceByView()).loadCalendarData();\n\t\t\t\t}\n\t\t\t\t//updates the Calendar Reminder popup's status\n\t\t\t\tVtiger_Index_Js.requestReminder();\n\t\t\t\tprogressIndicatorElement.progressIndicator({'mode': 'hide'});\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t},\n\tregisterEvents: function () {\n\t\tthis.registerActivityState();\n\t}\n\n});\n\njQuery(document).ready(function (e) {\n\tvar instance = new Calendar_ActivityStateModal_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","registerActivityState","on","e","currentTarget","closest","addClass","data","thisInstance","updateActivityState","hasClass","progressIndicator","url","params","noCache","find","headerInstance","Vtiger_Header_Js","getInstance","getQuickCreateForm","done","progressIndicatorElement","length","element","val","subject","handleQuickCreateData","callbackFunction","success","result","followup","value","module","action","record","state","app","hideModalWindow","AppConnector","request","getViewName","Vtiger_Detail_Js","widget","loadWidget","getTabByLabel","detailViewRecentActivitiesTabLabel","recentActivitiesTab","trigger","getModuleName","getSelectedTab","detailViewDetailsTabLabel","getTabContainer","listinstance","getListViewRecords","getContainer","Calendar_CalendarView_Js","getInstanceByView","loadCalendarData","Vtiger_Index_Js","requestReminder","registerEvents","document","ready","instance"],"mappings":"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"}