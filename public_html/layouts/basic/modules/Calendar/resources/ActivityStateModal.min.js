'use strict';

jQuery.Class('Calendar_ActivityStateModal_Js',{},{registerActivityState:function b(){var a=this;jQuery('#activityStateModal button:not(.close)').on('click',function(b){var c=jQuery(b.currentTarget);if(c.closest('.modal').addClass('d-none'),'1'==c.data('type')&&a.updateActivityState(c),c.hasClass('showQuickCreate')){var d=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}}),e='index.php?module=Calendar&view=QuickCreateAjax&addRelation=true&sourceModule=Calendar&sourceRecord='+c.data('id'),f={};f.noCache=!0;var g=c.closest('.modalEditStatus').find('.modalSummaryValues .fieldVal').data('subject'),h=Vtiger_Header_Js.getInstance();h.getQuickCreateForm(e,'Calendar',f).done(function(b){if(d.progressIndicator({mode:'hide'}),'0'==c.data('type')&&'undefined'!=typeof g&&0<g.length){b=jQuery(b);var e=b.find('[name="subject"]');e.length&&e.val(g);}h.handleQuickCreateData(b,{callbackFunction:function d(b){b&&b.success&&b.result.followup.value==c.data('id')&&a.updateActivityState(c);}});});}});},updateActivityState:function e(a){var c={module:'Calendar',action:'ActivityStateAjax',record:a.data('id'),state:a.data('state')};app.hideModalWindow();var d=jQuery.progressIndicator({position:'html',blockInfo:{enabled:!0}});AppConnector.request(c).done(function(a){if(a.success){var b=app.getViewName();if('Detail'===b){var c=jQuery('.activityWidgetContainer .widgetContentBlock'),e=Vtiger_Detail_Js.getInstance();if(c.length)e.loadWidget(c);else{var f=e.getTabByLabel(e.detailViewRecentActivitiesTabLabel);f&&f.trigger('click'),'Calendar'==app.getModuleName()&&(f=e.getSelectedTab().length&&e.getSelectedTab().data('linkKey')!=e.detailViewDetailsTabLabel?jQuery('<div></div>'):e.getTabContainer().find('[data-link-key="'+e.detailViewDetailsTabLabel+'"]:not(.d-none)'),jQuery('.showModal.closeCalendarRekord').addClass('d-none'),f.trigger('click'));}}if('List'==b){var g=new Vtiger_List_Js;g.getListViewRecords();}'DashBoard'==b&&new Vtiger_DashBoard_Js().getContainer().find('a[name="drefresh"]').trigger('click'),'Calendar'==app.getModuleName()&&'Calendar'==b&&Calendar_CalendarView_Js.getInstanceByView().loadCalendarData(),Vtiger_Index_Js.requestReminder(),d.progressIndicator({mode:'hide'});}else return !1});},registerEvents:function a(){this.registerActivityState();}}),jQuery(document).ready(function(){var a=new Calendar_ActivityStateModal_Js;a.registerEvents();});
//# sourceMappingURL=ActivityStateModal.min.js.map
