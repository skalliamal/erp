{"version":3,"file":"PDF.min.js","sources":["PDF.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery.Class(\"Vtiger_PDF_Js\", {\n\tvalidateSubmit: function (container) {\n\t\tvar templateIds = [];\n\t\tvar i = 0;\n\t\tcontainer.find('[name=\"pdf_template[]\"]').each(function () {\n\t\t\tif (jQuery(this).is(':checked')) {\n\t\t\t\ttemplateIds[i] = jQuery(this).val();\n\t\t\t\ti++;\n\t\t\t}\n\t\t});\n\t\tif (templateIds.length > 0) {\n\t\t\tcontainer.find('#generate_pdf').attr('disabled', false);\n\t\t\tvar view = app.getUrlVar('view');\n\t\t\tif (templateIds.length > 1 || (view && view.replace('#', '') === 'List' && JSON.parse(container.find('[name=\"validRecords\"]').val()).length > 0)) {\n\t\t\t\tcontainer.find('#single_pdf').show();\n\t\t\t} else {\n\t\t\t\tcontainer.find('#single_pdf').hide();\n\t\t\t}\n\t\t} else {\n\t\t\tcontainer.find('#generate_pdf').attr('disabled', true);\n\t\t\tcontainer.find('#single_pdf').hide();\n\t\t}\n\t},\n\t/*\n\t * Function to register the click event for generate button\n\t */\n\tregisterPreSubmitEvent: function (container) {\n\t\tcontainer.find('#generate_pdf, #single_pdf, #email_pdf').on('click', function (e) {\n\t\t\tdocument.progressLoader = jQuery.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_PDF_GENERATING'),\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar templateIds = [];\n\t\t\tvar i = 0;\n\t\t\tcontainer.find('[name=\"pdf_template[]\"]').each(function () {\n\t\t\t\tif (jQuery(this).is(':checked')) {\n\t\t\t\t\ttemplateIds[i] = jQuery(this).val();\n\t\t\t\t\ti++;\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar view = app.getUrlVar('view');\n\t\t\tif (view && view.replace('#', '') === 'List') {\n\t\t\t\tcontainer.find('[name=\"record\"]').val(container.find('[name=\"validRecords\"]').val());\n\t\t\t}\n\n\t\t\tcontainer.find('[name=\"template\"]').val(templateIds);\n\t\t\tswitch (jQuery(this).attr('id')) {\n\t\t\t\tcase 'generate_pdf':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'single_pdf':\n\t\t\t\t\tcontainer.find('[name=\"single_pdf\"]').val(1);\n\t\t\t\t\tcontainer.find('#pdfExportModal').submit();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'email_pdf':\n\t\t\t\t\tcontainer.find('[name=\"email_pdf\"]').val(1);\n\t\t\t\t\tcontainer.find('#pdfExportModal').submit();\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tdocument.progressLoader.progressIndicator({'mode': 'hide'});\n\t\t\tapp.hideModalWindow();\n\t\t});\n\t},\n\tregisterValidateSubmit: function (container) {\n\t\tvar thisInstance = this;\n\t\tthisInstance.validateSubmit(container);\n\n\t\tcontainer.find('[name=\"pdf_template[]\"]').on('change', function () {\n\t\t\tthisInstance.validateSubmit(container);\n\t\t});\n\t},\n\tregisterListViewCheckRecords: function (container) {\n\t\tvar thisInstance = this;\n\t\tcontainer.find('[name=\"pdf_template[]\"]').on('change', function () {\n\t\t\tdocument.progressLoader = jQuery.progressIndicator({\n\t\t\t\tmessage: app.vtranslate('JS_PDF_RECALCULATING'),\n\t\t\t\tposition: 'html',\n\t\t\t\tblockInfo: {\n\t\t\t\t\tenabled: true\n\t\t\t\t}\n\t\t\t});\n\t\t\tvar selectedRecords = container.find('[name=\"selectedRecords\"]').val();\n\t\t\tvar selectedTemplates = [];\n\t\t\tcontainer.find('[name=\"pdf_template[]\"]:checked').each(function (i) {\n\t\t\t\tselectedTemplates[i] = jQuery(this).val();\n\t\t\t});\n\n\t\t\tvar params = {};\n\t\t\tparams.data = {\n\t\t\t\tmodule: app.getModuleName(),\n\t\t\t\taction: 'PDF',\n\t\t\t\tmode: 'validateRecords',\n\t\t\t\trecords: selectedRecords,\n\t\t\t\tview: app.getViewName(),\n\t\t\t\ttemplates: selectedTemplates\n\t\t\t};\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\tvar response = data['result'];\n\t\t\t\tif (data['success']) {\n\t\t\t\t\tcontainer.find('[name=\"validRecords\"]').val(JSON.stringify(response.valid_records));\n\t\t\t\t\tcontainer.find('#recordsInfo').text(response.message);\n\t\t\t\t\tsetTimeout(function () {\n\t\t\t\t\t\tdocument.progressLoader.progressIndicator({'mode': 'hide'})\n\t\t\t\t\t}, 500);\n\t\t\t\t\tthisInstance.validateSubmit(container);\n\t\t\t\t}\n\t\t\t}).fail(function (data, err) {\n\t\t\t\tapp.errorLog(data, err);\n\t\t\t});\n\t\t});\n\t},\n\tcountSelectedRecords: function (container) {\n\t\tvar selectedRecords = JSON.parse(container.find('[name=\"selectedRecords\"]').val());\n\n\t\treturn selectedRecords.length;\n\t},\n\tregisterEvents: function () {\n\t\tvar container = jQuery('div.modal-content');\n\t\tthis.registerPreSubmitEvent(container);\n\n\t\tif (app.getViewName() === 'Detail') {\n\t\t\tthis.registerValidateSubmit(container);\n\t\t}\n\t\tif (app.getViewName() === 'List') {\n\t\t\tthis.validateSubmit(container);\n\t\t\tthis.registerListViewCheckRecords(container);\n\t\t\tvar selectedRecords = JSON.parse(container.find('#all_records').val());\n\t\t\tvar recordsInput = container.find('[name=\"selectedRecords\"]');\n\t\t\tvar validInput = container.find('[name=\"validRecords\"]');\n\t\t\tcontainer.find('div.modal-body').append('<p id=\"recordsInfo\">' + app.vtranslate('JS_RECORD_INFO'), +'</p>');\n\t\t\trecordsInput.val(JSON.stringify(selectedRecords));\n\t\t\tvalidInput.val(JSON.stringify(selectedRecords));\n\t\t\tjQuery('#recordsInfo').text(selectedRecords.length + ' from ' + selectedRecords.length + ' are valid for chosen template.');\n\t\t\tthis.validateSubmit(container);\n\t\t}\n\t}\n});\njQuery(function () {\n\tvar instance = new Vtiger_PDF_Js();\n\tinstance.registerEvents();\n});\n"],"names":["jQuery","Class","validateSubmit","container","i","find","each","is","templateIds","val","length","attr","app","getUrlVar","view","replace","parse","show","hide","registerPreSubmitEvent","on","document","progressLoader","progressIndicator","message","vtranslate","position","blockInfo","enabled","submit","hideModalWindow","registerValidateSubmit","thisInstance","registerListViewCheckRecords","selectedTemplates","params","data","module","getModuleName","action","mode","records","selectedRecords","getViewName","templates","dataType","AppConnector","request","done","JSON","stringify","response","valid_records","text","setTimeout","fail","err","errorLog","countSelectedRecords","registerEvents","recordsInput","validInput","append","instance"],"mappings":"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"}