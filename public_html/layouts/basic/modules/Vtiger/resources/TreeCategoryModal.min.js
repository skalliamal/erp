'use strict';

jQuery.Class('Vtiger_TreeCategory_Js',{},{modalContainer:!1,treeInstance:!1,treeData:!1,windowParent:app.getWindowParent(),getModalContainer:function a(){return !1==this.modalContainer&&(this.modalContainer=jQuery('#modalTreeCategoryModal')),this.modalContainer},getRecords:function c(a){if(!1==this.treeData&&'undefined'!==a){var b=a.find('#treePopupValues').val();this.treeData=JSON.parse(b);}return this.treeData},generateTree:function d(a){var b=this;if(!1==b.treeInstance){b.treeInstance=a.find('#treePopupContents');var c=['search'];b.isActiveCategory()&&c.push('category'),'2'==b.getRelationType()&&c.push('checkbox'),'1'==b.getRelationType()&&c.push('edit'),b.treeInstance.jstree($.extend(!0,{core:{data:b.getRecords(),themes:{name:'proton',responsive:!0}},checkbox:{three_state:!1},plugins:c},b.treeInstance.data('params')));}},isActiveCategory:function a(){return '1'==this.getModalContainer().find('#isActiveCategory').val()},getRelationType:function a(){return this.getModalContainer().find('#relationType').val()},searching:function b(a){this.treeInstance.jstree(!0).search(a);},registerSearchEvent:function d(){var a=this,b=$('#valueSearchTree'),c=$('#btnSearchTree');b.on('keypress',function(c){13==c.which&&a.searching(b.val());}),c.on('click',function(){a.searching(b.val());});},registerSaveRecords:function e(a){var b=this,c=[],d=[];$.each(b.getRecords(),function(a,b){b.state&&b.state.selected&&'record'==b.type&&c.push(b.record_id),b.category&&b.category.checked&&d.push(b.record_id);}),a.find('[name="saveButton"]').on('click',function(){var e=[],f=[],g=[],h=[],i=[],j=[],k=$(this);k.attr('disabled','disabled'),$.each(b.treeInstance.jstree('get_selected',!0),function(a,b){-1==jQuery.inArray(b.original.record_id,c)&&'record'==b.original.type&&g.push(b.original.record_id),e.push(b.original.record_id);}),$.each(c,function(a,b){-1==jQuery.inArray(b,e)&&h.push(b);}),b.isActiveCategory()&&(f=b.treeInstance.jstree('getCategory'),$.each(f,function(a,b){-1==jQuery.inArray(b,d)&&i.push(b);}),$.each(d,function(a,b){-1==jQuery.inArray(b,f)&&j.push(b);}));var l={module:b.windowParent.app.getModuleName(),action:'RelationAjax',mode:'updateRelation',recordsToAdd:g,recordsToRemove:h,categoryToAdd:i,categoryToRemove:j,src_record:b.windowParent.app.getRecordId(),related_module:a.find('#relatedModule').val()};4<g.length?bootbox.dialog({title:app.vtranslate('JS_INFORMATION'),message:app.vtranslate('JS_SAVE_SELECTED_ITEMS_ALERT').replace('__LENGTH__',g.length),buttons:{success:{label:app.vtranslate('JS_LBL_SAVE'),className:'btn-success',callback:function a(){b.saveRecordsEvent(l);}},danger:{label:app.vtranslate('JS_LBL_CANCEL'),className:'btn-warning',callback:function a(){k.removeAttr('disabled');}}}}):b.saveRecordsEvent(l);});},saveRecordsEvent:function c(a){var b=this;AppConnector.request(a).done(function(){b.windowParent.Vtiger_Detail_Js.getInstance().reloadTabContent(),app.hideModalWindow();});},registerCounterSelected:function b(){var a=this;this.treeInstance.on('changed.jstree',function(){var b=0,c='';$.each(a.treeInstance.jstree('get_selected',!0),function(a,c){var d=c.original.record_id.toString();d.indexOf('T')&&b++;}),c=app.vtranslate('JS_SELECTED_ELEMENTS')+': '+b,$('.counterSelected').text(c);});},registerEvents:function b(){var a=this.getModalContainer();this.getRecords(a),this.generateTree(a),this.registerSaveRecords(a),this.registerSearchEvent(),this.registerCounterSelected();}}),jQuery(function(){var a=new Vtiger_TreeCategory_Js;a.registerEvents();});
//# sourceMappingURL=TreeCategoryModal.min.js.map
