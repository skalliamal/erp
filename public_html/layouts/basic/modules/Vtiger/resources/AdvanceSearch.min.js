'use strict';

Vtiger_BasicSearch_Js('Vtiger_AdvanceSearch_Js',{cache:{}},{elementContainer:!1,advanceFilter:!1,filterValidationRegistered:!1,filterForm:!1,parentContainer:!1,getContainer:function a(){return this.elementContainer},setContainer:function b(a){return this.elementContainer=a,this},getParentContainer:function a(){return this.parentContainer},setParentContainer:function b(a){return this.setMainContainer(a),this.parentContainer=a,this},getFilterForm:function a(){return $('form[name="advanceFilterForm"]',this.getContainer())},getAdvanceSearch:function e(){var a=$.Deferred(),b=this.getSearchModule();if(b in Vtiger_AdvanceSearch_Js.cache)return a.resolve(Vtiger_AdvanceSearch_Js.cache[b]),a.promise();var c={module:app.getModuleName(),searchModule:b,view:'BasicAjax',mode:'showAdvancedSearch'};app.getParentModuleName()&&(c.parent=app.getParentModuleName());var d=$.progressIndicator();return AppConnector.request(c).done(function(c){d.hide(),Vtiger_AdvanceSearch_Js.cache[b]=c,a.resolve(c);}).fail(function(b){a.reject(b);}),a.promise()},initiateSearch:function d(){var a=$.Deferred(),b=this,c=function(c){b.setContainer($('#advanceSearchContainer')),b.filterValidationRegistered=!1,b.registerEvents(),b.advanceFilter=new Vtiger_SearchAdvanceFilter_Js($('.filterContainer',c)),a.resolve();};return b.getAdvanceSearch().done(function(a){var b={};b.data=a,b.cb=c,app.hideModalWindow(),app.showModalWindow(b);}).fail(function(){a.reject();}),a.promise()},getNameFields:function b(){var a=this.getFilterForm();return a.find('[name="labelFields"]').data('value')},selectBasicSearchValue:function l(){var a=this.getParentContainer();if(!1==a)return !1;var b=a.find('.js-global-search__value').val();if(0<b.length){var c=this.getFilterForm(),d=this.getNameFields();if('undefined'==typeof d||null==d||0==d.length)return;var e=c.find('.anyConditionContainer');for(var f in d){var g=d[f];0!=f&&e.find('.addCondition').find('button').trigger('click');var h=e.find('.conditionList').find('.js-conditions-row:last'),i=h.find('select[name="columnname"]');i.find('option[data-field-name="'+g+'"]').attr('selected','selected'),i.trigger('change').trigger('chosen:updated');var j=h.find('select[name="comparator"]');j.find('option[value="c"]').attr('selected','selected'),j.trigger('chosen:updated');var k=h.find('[name="value"]');k.val(b);}}},search:function c(){var a=this.advanceFilter.getValues(),b=this.getSearchModule();return this._search({module:app.getModuleName(),searchModule:b,advfilterlist:JSON.stringify(a)})},showSearchResults:function g(a){var c=$.Deferred(),d=function(a){c.resolve(a);},e=$('<div class="row"><span class="col-md-4 searchHolder"></span><span class="col-md-8 filterHolder marginLeftZero d-none"></span></div>');$('.searchHolder',e).html(a),a=e;var f={};return f.data=a,f.cb=d,app.showModalWindow(f),c.promise()},saveFilter:function c(a){var b=$.Deferred();return a.source_module=this.getSearchModule(),a.status=1,a.advfilterlist=JSON.stringify(this.advanceFilter.getValues(!1)),a.module='CustomView',a.action='Save',AppConnector.request(a).done(function(a){if(!a.success){var c={title:app.vtranslate('JS_MESSAGE'),text:a.error.message,type:'error'};Vtiger_Helper_Js.showPnotify(c);}b.resolve(a);}),b.promise()},saveAndViewFilter:function b(a){this.saveFilter(a).done(function(a){var b=a.result.listviewurl;window.location.href=b;},function(){});},isSearchAndFilterComponentsShown:function c(){var a=$('#'+Window.lastModalId),b=$('.filterHolder',a).find('#advanceSearchContainer');return !(0>=b.length)},performSearch:function c(){var a=this,b=this.isSearchAndFilterComponentsShown();this.search().done(function(c){a.setContainer(a.getContainer().detach()),a.showSearchResults(c).done(function(){a.registerShowFiler(),b&&a.showFilter();});});},showFilter:function b(){var a=this;app.hideModalWindow(function b(){app.showModalWindow(a.getContainer());});},performValidation:function c(){var a=this;this.formValidationDeferred=$.Deferred();var b=this.getFilterForm();return this.filterValidationRegistered||(this.filterValidationRegistered=!0,b.validationEngine({onValidationComplete:function d(b,c){c?a.formValidationDeferred.resolve():a.formValidationDeferred.reject();}})),b.submit(),this.formValidationDeferred.promise()},registerShowFiler:function b(){var a=this;$('#showFilter').on('click',function(){a.showFilter();});},registerEvents:function c(){var a=this,b=this.getContainer();b.on('change','#searchModuleList',function(b){var c=$(b.currentTarget),d=c.val();a.setSearchModule(d),a.initiateSearch().done(function(){a.selectBasicSearchValue();});}),$('#advanceSearchButton').on('click',function(){var b=a.getSearchModule();return 0>=b.length?void app.getChosenElementFromSelect($('#searchModuleList')).validationEngine('showPrompt',app.vtranslate('JS_SELECT_MODULE'),'error','topRight',!0):void a.performValidation().done(function(){a.performSearch();}).fail(function(){})}),$('#advanceIntiateSave').on('click',function(a){var b=$(a.currentTarget);b.addClass('d-none');var c=b.closest('.actions');$('.js-name-filter',c).removeClass('d-none').focus(),$('#advanceSave').removeClass('d-none');}),$('#advanceSave').on('click',function(b){var c=$(b.currentTarget).closest('.actions'),d=$('input[name="viewname"]',c),e=d.val();if(0>=e.length)return void d.validationEngine('showPrompt',app.vtranslate('JS_REQUIRED_FIELD'),'error','topRight',!0);var f=a.getSearchModule();return 0>=f.length?void app.getChosenElementFromSelect($('#searchModuleList')).validationEngine('showPrompt',app.vtranslate('JS_SELECT_MODULE'),'error','topRight',!0):void a.performValidation().done(function(){var b={};b.viewname=e,a.saveAndViewFilter(b);})}),this.getFilterForm().on('submit',function(a){a.preventDefault();}),this.setSearchModule($('#searchModuleList').val());}});
//# sourceMappingURL=AdvanceSearch.min.js.map
