'use strict';

var _typeof = typeof Symbol === "function" && typeof Symbol.iterator === "symbol" ? function (obj) {
  return typeof obj;
} : function (obj) {
  return obj && typeof Symbol === "function" && obj.constructor === Symbol && obj !== Symbol.prototype ? "symbol" : typeof obj;
};

jQuery.Class('Vtiger_Widget_Js',{widgetPostLoadEvent:'Vtiget.Dashboard.PostLoad',widgetPostRefereshEvent:'Vtiger.Dashboard.PostRefresh',getInstance:function(e,t,a){'undefined'==typeof a&&(a=app.getModuleName());var i=window[a+'_'+t+'_Widget_Js'],n=window['Vtiger_'+t+'_Widget_Js'],o=window['YetiForce_'+t+'_Widget_Js'],r=YetiForce_Widget_Js,d=void 0;return d='undefined'==typeof i?'undefined'==typeof n?'undefined'==typeof o?new r(e,!1,t):new o(e,!1,t):new n(e,!1,t):new i(e,!1,t),d}},{container:!1,plotContainer:!1,chartInstance:!1,chartData:[],paramCache:!1,init:function(e,t){e=$(e),this.setContainer(e),this.registerWidgetPostLoadEvent(e),t||this.registerWidgetPostRefreshEvent(e),this.registerCache(e);},areColorsFromDividingField:function e(){return !!Number(this.getContainer().find('[name="colorsFromDividingField"]').val())},getSourceChartType:function e(){return this.getContainer().find('[name="typeChart"]').val()},isMultiFilter:function e(){return 'undefined'!=typeof this.filterIds&&1<this.filterIds.length},getWidgetData:function t(){if('undefined'!=typeof this.widgetData)return this.widgetData;var e=this.getContainer().find('.widgetData');return !!e.length&&(this.widgetData=JSON.parse(e.val()))},globalChartFunctions:{scales:{formatAxesLabels:function(e){return 0<String(e).length&&!isNaN(Number(e))?app.parseNumberToShow(e):e}},datalabels:{display:function a(e){var t=e.chart.getDatasetMeta(e.datasetIndex);return !0!==t.hidden},formatter:function(e,t){return 'undefined'!=typeof this.widgetData&&'undefined'!=typeof this.widgetData.valueType&&'count'===this.widgetData.valueType?app.parseNumberToShow(e,0):'undefined'!=typeof t.chart.data.datasets[t.datasetIndex].dataFormatted&&'undefined'!=typeof t.chart.data.datasets[t.datasetIndex].dataFormatted[t.dataIndex]?t.chart.data.datasets[t.datasetIndex].dataFormatted[t.dataIndex]:0<String(e).length&&isNaN(Number(e))?app.parseNumberToShow(e):e}},tooltips:{label:function(e,t){return 'undefined'!=typeof t.datasets[e.datasetIndex].dataFormatted&&'undefined'!==t.datasets[e.datasetIndex].dataFormatted[e.index]?t.datasets[e.datasetIndex].dataFormatted[e.index]:0<String(t.datasets[e.datasetIndex].data[e.index]).length&&!isNaN(Number(t.datasets[e.datasetIndex].data[e.index]))?'undefined'!=typeof this.widgetData&&'undefined'!=typeof this.widgetData.valueType&&'count'===this.widgetData.valueType?app.parseNumberToShow(t.datasets[e.datasetIndex].data[e.index],0):app.parseNumberToShow(t.datasets[e.datasetIndex].data[e.index]):t.datasets[e.datasetIndex].data[e.index]},title:function(e,t){var a=e[0];return 'undefined'!=typeof t.datasets[a.datasetIndex].titlesFormatted&&'undefined'!==t.datasets[a.datasetIndex].titlesFormatted[a.index]?t.datasets[a.datasetIndex].titlesFormatted[a.index]:0<String(t.labels[a.index]).length&&!isNaN(Number(t.labels[a.index]))?'undefined'!=typeof this.widgetData&&'undefined'!=typeof this.widgetData.valueType&&'count'===this.widgetData.valueType?app.parseNumberToShow(t.labels[a.index],0):app.parseNumberToShow(t.labels[a.index]):t.labels[a.index]}},legend:{onClick:function i(t,e){var a=this.chartInstance.config.type;return 'undefined'==typeof Chart.defaults[a]?Chart.defaults.global.legend.onClick.apply(this.chartInstance,[t,e]):Chart.defaults[a].legend.onClick.apply(this.chartInstance,[t,e])},generateLabels:function i(e){var t=e.config.type,a=void 0;return a='undefined'==typeof Chart.defaults[t]?Chart.defaults.global.legend.labels.generateLabels(e):Chart.defaults[t].legend.labels.generateLabels(e),(this.areColorsFromDividingField()||this.isMultiFilter())&&(e.config.options.legend.labels.boxWidth=12,a.forEach(function(e){e.fillStyle='rgba(0,0,0,0)',e.strokeStyle='rgba(0,0,0,0.15)';})),a},display:function e(){return !!(this.isMultiFilter()||this.areColorsFromDividingField())}},plugins:{hideVerticalBarDatalabelsIfNeeded:function u(e){for(var t=function(e){var t=[],a=e.data;if('undefined'!=typeof a&&'undefined'!=typeof a.datasets&&Array.isArray(a.datasets))for(var n,o=0,i=a.datasets.length;o<i;o++)n=e.getDatasetMeta(o),'undefined'!=typeof n.data&&Array.isArray(n.data)&&t.push(n);return t},a=t(e),n=e.data.datasets,o=0,r=n.length;o<r;o++){var d=n[o],s=a[o];if(!s.hidden){var l=s.data;'undefined'==typeof d._models&&(d._models={}),'undefined'==typeof d.datalabels&&(d.datalabels={}),'undefined'==typeof d.datalabels.display&&(d.datalabels.display=!0);for(var h,b=0,m=l.length;b<m;b++)if(h=l[b],'undefined'!=typeof h.$datalabels&&'undefined'!=typeof h.$datalabels._model){var _=h.$datalabels._model;if(null!==_&&'undefined'!=typeof _)d._models[b]=_;else if(null!==d._models[b]&&'undefined'!=typeof d._models[b])_=d._models[b];else return !1;var c=_.size.width+_.padding.width+2*_.borderWidth,g=_.size.height+_.padding.height+2*_.borderWidth,p=h.height(),f=10;'undefined'!=typeof e.config.options.verticalBarLabelsThreshold&&(f=e.config.options.verticalBarLabelsThreshold),h.$datalabels._model=h._view.width+f<c||p+f<g?null:_;}}}},hideHorizontalBarDatalabelsIfNeeded:function(e){for(var t=function(e){var t=[],a=e.data;if('undefined'!=typeof a&&'undefined'!=typeof a.datasets&&Array.isArray(a.datasets))for(var n,o=0,i=a.datasets.length;o<i;o++)n=e.getDatasetMeta(o),'undefined'!=typeof n.data&&Array.isArray(n.data)&&t.push(n);return t},a=t(e),n=e.data.datasets,o=0,r=n.length;o<r;o++){var d=n[o],s=a[o];if(!s.hidden){var l=s.data;'undefined'==typeof d._models&&(d._models={}),'undefined'==typeof d.datalabels&&(d.datalabels={}),'undefined'==typeof d.datalabels.display&&(d.datalabels.display=!0);for(var u,h=0,b=l.length;h<b;h++)if(u=l[h],'undefined'!=typeof u.$datalabels&&'undefined'!=typeof u.$datalabels._model){var m=u.$datalabels._model;if(null!==m&&'undefined'!=typeof m)d._models[h]=m;else if(null!==d._models[h]&&'undefined'!=typeof d._models[h])m=d._models[h];else return !1;var c=m.size.width+m.padding.width+2*m.borderWidth,g=m.size.height+m.padding.height+2*m.borderWidth,p=u.width,f=10;'undefined'!=typeof e.config.options.horizontalBarLabelsThreshold&&(f=e.config.options.horizontalBarLabelsThreshold),u.$datalabels._model=u._view.height+f<g||p+f<c?null:m;}}}},fixXAxisLabels:function(e){var t=function(e,t){return 'undefined'==typeof t.scales&&(t.scales={}),'undefined'==typeof t.scales.xAxes&&(t.scales.xAxes=[{}]),t.scales.xAxes.forEach(function(e){'undefined'==typeof e.ticks&&(e.ticks={}),e.ticks.callback=function(e){return 13<e.length?e.substr(0,10)+'...':e};}),t},a=function(e,t){return 'undefined'==typeof t.scales&&(t.scales={}),'undefined'==typeof t.scales.xAxes&&(t.scales.xAxes=[{}]),t.scales.xAxes.forEach(function(e){'undefined'==typeof e.ticks&&(e.ticks={}),e.ticks.minRotation=90;}),t};e.data.datasets.forEach(function(n){if(n._updated)return !1;var i=function(o){if(n._meta.hasOwnProperty(o)){for(var p=0,i=n._meta[o].data.length;p<i;p++){var r=n._meta[o].data[p],d=r._xScale.ticks[p],s=r._xScale.ctx,l=r._xScale.width/n._meta[o].data.length;'undefined'!=typeof r._xScale.options.categoryPercentage&&(l*=r._xScale.options.categoryPercentage);var f=s.measureText(d).width;if(l<f){var c=d.substr(0,10)+'...',g=s.measureText(c).width;if(l<g?(e.options=a(e.data,e.options),e.options=t(e.data,e.options)):e.options=t(e.data,e.options),!n._updated){n._updated=!0,e.update(),e.data.datasets.forEach(function(e,t){e._meta[o].data.forEach(function(a,i){a._view.x=a._xScale.getPixelForValue(t,i),a._view.base=a._xScale.getBasePixel(),a._view.width=a._xScale.width/e._meta[o].data.length*a._xScale.options.categoryPercentage*a._xScale.options.barPercentage;});});break}}}n._updated=!0;}};for(var o in n._meta)i(o);});},fixYAxisLabels:function(e){var t=function(e,t){return 'undefined'==typeof t.scales&&(t.scales={}),'undefined'==typeof t.scales.yAxes&&(t.scales.yAxes=[{}]),t.scales.yAxes.forEach(function(e){'undefined'==typeof e.ticks&&(e.ticks={}),e.ticks.callback=function(e){return 13<e.length?e.substr(0,10)+'...':e};}),t};e.data.datasets.forEach(function(a){if(a._updated)return !1;var i=function(n){if(a._meta.hasOwnProperty(n)){for(var d=0,i=a._meta[n].data.length;d<i;d++){var o=a._meta[n].data[d],r=o._view.label;if(13<r.length&&(e.options=t(e.data,e.options),!a._updated)){a._updated=!0,e.update(),e.data.datasets.forEach(function(e,t){e._meta[n].data.forEach(function(a,i){'undefined'!=typeof a._xScale&&(a._view.x=a._xScale.getPixelForValue(t,i),a._view.base=a._xScale.getBasePixel(),a._view.width=a._xScale.width/e._meta[n].data.length*a._xScale.options.categoryPercentage*a._xScale.options.barPercentage);});});break}}a._updated=!0;}};for(var n in a._meta)i(n);});}}},getFunctionFromReplacementString:function(e){var t=!1;'()'===e.substr(e.length-2)&&(e=e.substr(0,e.length-2),t=!0);var a=e.split(':');2!==a.length&&app.errorLog(new Error('Function replacement string should look like \'function:path.to.fn\' not like \''+e+'\''));var i=a[1].split('.').reduce(function(e,t){return e[t]},this.globalChartFunctions);return 'function'!=typeof i&&app.errorLog(new Error('Global function does not exists: '+a[1])),t?i.call(this):i.bind(this)},isReplacementString:function(e){return !('string'!=typeof e)&&'function:'===e.substr(0,9)},parseOptionsObject:function(e){var t=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1],a=arguments[2],i={};for(var n in e){var o=e[n];i[n]=t?'_'===n.substr(0,1)?o:Array.isArray(o)?this.parseOptionsArray(o,t,a):'object'===('undefined'==typeof o?'undefined':_typeof(o))&&null!==o?this.parseOptionsObject(o,t,a):o:'_'===n.substr(0,1)?o:this.isReplacementString(o)?this.getFunctionFromReplacementString(o,t,a):Array.isArray(o)?this.parseOptionsArray(o,t,a):'object'===('undefined'==typeof o?'undefined':_typeof(o))&&null!==o?this.parseOptionsObject(o,t,a):o;}return i},parseOptionsArray:function(e){var t=this,a=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1],i=arguments[2];return e.map(function(e){if(t.isReplacementString(e))return t.getFunctionFromReplacementString(value);return Array.isArray(e)?t.parseOptionsArray(e,a,i):'object'===('undefined'==typeof e?'undefined':_typeof(e))&&null!==e?t.parseOptionsObject(e,a,i):e})},parseOptions:function(e){var t=!!(1<arguments.length&&arguments[1]!==void 0)&&arguments[1],a=arguments[2];if(Array.isArray(e))return this.parseOptionsArray(e,t,a);return 'object'===('undefined'==typeof e?'undefined':_typeof(e))&&null!==e?this.parseOptionsObject(e,t,a):void app.errorLog(new Error('Unknown options format ['+('undefined'==typeof e?'undefined':_typeof(e))+'] - should be object.'))},removeStackedFromName:function a(e){var t=e.indexOf('Stacked');return 0<t?e.substr(0,t):e},getGlobalDefaultChartsOptions:function(e){var t={bar:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:'function:legend.display()'},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:'function:scales.formatAxesLabels'}}],yAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,callback:'function:scales.formatAxesLabels'}}]}},dataset:{datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.2)',borderColor:'rgba(255,255,255,0.2)',borderWidth:2,borderRadius:2,anchor:'center',align:'center',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[{beforeDraw:'function:plugins.fixXAxisLabels'},{beforeDraw:'function:plugins.hideVerticalBarDatalabelsIfNeeded'}]},barStacked:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:'function:legend.display()'},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{xAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:'function:scales.formatAxesLabels'}}],yAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,callback:'function:scales.formatAxesLabels'}}]}},dataset:{datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.2)',borderColor:'rgba(255,255,255,0.2)',borderWidth:2,borderRadius:2,anchor:'center',align:'center',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[{beforeDraw:'function:plugins.fixXAxisLabels'},{beforeDraw:'function:plugins.hideVerticalBarDatalabelsIfNeeded'}]},horizontalBar:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:'function:legend.display()'},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:'function:scales.formatAxesLabels'}}],yAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,callback:'function:scales.formatAxesLabels'}}]}},dataset:{datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.2)',borderColor:'rgba(255,255,255,0.2)',borderWidth:2,borderRadius:2,anchor:'center',align:'center',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[{beforeDraw:'function:plugins.fixYAxisLabels'},{beforeDraw:'function:plugins.hideHorizontalBarDatalabelsIfNeeded'}]},horizontalBarStacked:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:'function:legend.display()'},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{xAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:'function:scales.formatAxesLabels'}}],yAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,callback:'function:scales.formatAxesLabels'}}]}},dataset:{datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.2)',borderColor:'rgba(255,255,255,0.2)',borderWidth:2,borderRadius:2,anchor:'center',align:'center',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[{beforeDraw:'function:plugins.fixYAxisLabels'},{beforeDraw:'function:plugins.hideHorizontalBarDatalabelsIfNeeded'}]},line:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:'function:legend.display()'},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:'function:scales.formatAxesLabels',labelOffset:0}}],yAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,callback:'function:scales.formatAxesLabels'}}]}},dataset:{fill:!1,datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.5)',borderColor:'rgba(255,255,255,0.5)',borderWidth:2,borderRadius:2,anchor:'bottom',align:'bottom',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[{beforeDraw:'function:plugins.fixXAxisLabels'}]},lineStacked:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:'function:legend.display()'},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:'function:scales.formatAxesLabels',labelOffset:0}}],yAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,callback:'function:scales.formatAxesLabels'}}]}},dataset:{fill:!1,datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.5)',borderColor:'rgba(255,255,255,0.5)',borderWidth:2,borderRadius:2,anchor:'bottom',align:'bottom',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[{beforeDraw:'function:plugins.fixXAxisLabels'}]},linePlain:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:'function:legend.display()'},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:'function:scales.formatAxesLabels',labelOffset:0}}],yAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,callback:'function:scales.formatAxesLabels'}}]}},dataset:{lineTension:0,fill:!1,datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.5)',borderColor:'rgba(255,255,255,0.5)',borderWidth:2,borderRadius:2,anchor:'bottom',align:'bottom',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[{beforeDraw:'function:plugins.fixXAxisLabels'}]},linePlainStacked:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:'function:legend.display()'},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{xAxes:[{ticks:{autoSkip:!1,beginAtZero:!0,maxRotation:90,callback:'function:scales.formatAxesLabels',labelOffset:0}}],yAxes:[{stacked:!0,ticks:{autoSkip:!1,beginAtZero:!0,callback:'function:scales.formatAxesLabels'}}]}},dataset:{fill:!1,lineTension:0,datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.5)',borderColor:'rgba(255,255,255,0.5)',borderWidth:2,borderRadius:2,anchor:'bottom',align:'bottom',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[{beforeDraw:'function:plugins.fixXAxisLabels'}]},pie:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:!0,labels:{generateLabels:'function:legend.generateLabels'}},cutoutPercentage:0,layout:{padding:{bottom:12}},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{}},dataset:{datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.5)',borderColor:'rgba(255,255,255,0.5)',borderWidth:2,borderRadius:4,anchor:'end',align:'center',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[]},doughnut:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:!0,onClick:'function:legend.onClick',labels:{generateLabels:'function:legend.generateLabels'}},cutoutPercentage:50,layout:{padding:{bottom:12}},tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{}},dataset:{datalabels:{font:{size:11},color:'white',backgroundColor:'rgba(0,0,0,0.5)',borderColor:'rgba(255,255,255,0.5)',borderWidth:2,borderRadius:4,anchor:'end',align:'center',formatter:'function:datalabels.formatter',display:'function:datalabels.display'}},plugins:[]},funnel:{basic:{maintainAspectRatio:!1,title:{display:!1},legend:{display:!1},sort:'desc',tooltips:{mode:'point',callbacks:{label:'function:tooltips.label',title:'function:tooltips.title'}},scales:{yAxes:[{display:!0,beginAtZero:!0,ticks:{callback:'function:scales.formatAxesLabels'}}]}},dataset:{datalabels:{display:!1}},plugins:[{beforeDraw:'function:plugins.fixYAxisLabels'}]}};if('undefined'!=typeof t[e])return t[e];var a=this.removeStackedFromName(e);return 'undefined'==typeof t[a]?void app.errorLog(new Error(e+' chart does not exists!')):t[a]},getDefaultBasicOptions:function(e,t){return this.getGlobalDefaultChartsOptions(e,t).basic},getDefaultDatasetOptions:function(e,t){return this.getGlobalDefaultChartsOptions(e,t).dataset},getDefaultPlugins:function(e,t){return this.getGlobalDefaultChartsOptions(e,t).plugins},getContainer:function(){return this.container},setContainer:function(e){return this.container=e,this},isEmptyData:function(){return 0===this.getContainer().find('.widgetData').length||0<this.getContainer().find('.noDataMsg').length},getUserDateFormat:function(){return CONFIG.dateFormat},getChartContainer:function(e){return 'undefined'==typeof e&&(e=!1),!1!==this.plotContainer&&e||(this.plotContainer=this.getContainer().find('.widgetChartContainer').find('canvas').get(0)),this.plotContainer},registerRecordsCount:function(){var e=this,t=e.getContainer().find('.recordCount');t.on('click',function(){var e=t.data('url');AppConnector.request(e).done(function(e){t.find('.count').html(e.result.totalCount),t.find('[data-fa-i2svg]').addClass('d-none').attr('aria-hidden',!0),t.find('a').removeClass('d-none').attr('aria-hidden',!1);});});},loadScrollbar:function(){var e=$(this.getChartContainer(!1));if('undefined'==typeof e)return !1;var t=e.closest('.dashboardWidget'),a=t.find('.dashboardWidgetContent'),i=t.find('.dashboardWidgetFooter'),n=t.innerHeight()-t.find('.dashboardWidgetHeader').outerHeight();i.length&&(n-=i.outerHeight());a.length&&(a.css('height',n+'px'),a.css('max-height',n+'px'),'undefined'==typeof this.scrollbar?this.scrollbar=app.showNewScrollbar(a,{wheelPropagation:!0}):this.scrollbar.update());},restrictContentDrag:function(){this.getContainer().on('mousedown.draggable',function(t){var e=jQuery(t.target),a=!!(0<e.closest('.dashboardWidgetHeader').length);a||t.stopPropagation();});},generateData:function(){var e=this,t=e.getContainer().find('.widgetData').val();return 'undefined'==typeof t?e.chartData=t:(e.chartData=JSON.parse(t),e.chartData)},positionNoDataMsg:function(){var e=this.getContainer(),t=e.find('.dashboardWidgetContent'),a=t.find('.noDataMsg');a.position({my:'center center',at:'center center',of:t});},printHtml:function r(e){var t=this,a=e.closest('.dashboardWidget'),i=a.find('.dashboardTitle').prop('title'),n=a.find('.js-print__container').get(0),o=$('<img style="width:100%">');o.get(0).onload=function(){var e=$(n).outerWidth(),a=$(n).outerHeight();600>e&&(e=600),400>a&&(a=400),t.printImage(o.get(0),i,e,a);},app.htmlToImage(n,function(e){o.get(0).src=e;});},downloadHtmlAsImage:function i(e){var t=e.closest('.dashboardWidget'),a=t.find('.dashboardTitle').prop('title');app.htmlToImage(t.find('.js-print__container').get(0),function(e){var t=document.createElement('a');t.setAttribute('href',e),t.setAttribute('download',a+'.png'),t.click();});},registerPrintAndDownload:function e(){var t=this;$('.js-print--download',this.getContainer()).on('click',function(a){t.downloadHtmlAsImage($(a.target));}),$('.js-print',this.getContainer()).on('click',function(a){t.printHtml($(a.target));});},postLoadWidget:function(){this.isEmptyData()?this.positionNoDataMsg():this.loadChart(this.options),this.registerSectionClick(),this.registerFilter(),this.registerFilterChangeEvent(),this.restrictContentDrag(),this.registerContentAutoResize(),app.showPopoverElementView(this.getContainer().find('.js-popover-tooltip')),this.registerWidgetSwitch(),this.registerChangeSorting(),this.registerLoadMore(),this.registerHeaderButtons(),this.registerPrintAndDownload(),this.loadScrollbar();},postRefreshWidget:function(){this.loadScrollbar(),this.isEmptyData()?this.positionNoDataMsg():this.loadChart(this.options),this.registerSectionClick(),this.registerLoadMore();},setSortingButton:function(e){if(e.length){var t=this.getContainer(),a=t.find('a[name="drefresh"]'),i=a.data('url');i=i.replace('&sortorder=desc',''),i=i.replace('&sortorder=asc',''),i+='&sortorder=';var n=e.data('sort'),o='desc',r='fa-sort-amount-down';'desc'==n&&(o='asc',r='fa-sort-amount-up'),e.data('sort',o),e.attr('title',e.data(o)),e.attr('alt',e.data(o)),i+=o;var d=e.find('[data-fa-i2svg]');d.removeClass().addClass('[data-fa-i2svg]').addClass(r),a.data('url',i);}},getChartImage:function a(){var e=this.chartInstance.toBase64Image(),t=new Image;return t.src=e,t},printImage:function o(e,t,a,i){var n=window.open('','PRINT','height='+i+',width='+a);n.document.write('<html><head><title>'+t+'</title>'),n.document.write('</head><body >'),n.document.write($('<div>').append(e).html()),n.document.write('</body></html>'),n.document.close(),n.focus(),setTimeout(function(){n.print(),n.close();},1e3);},registerHeaderButtons:function(){var e=this,t=this.getContainer(),i=t.find('.dashboardWidgetHeader'),a=i.find('.downloadWidget'),n=i.find('.printWidget');n.on('click',function(){var t=e.getChartImage();e.printImage(t,i.find('.dashboardTitle').text(),600,400);}),a.on('click',function(){var n=$(e.getChartImage()),o=$('<a>').attr('href',n.attr('src')).attr('download',i.find('.dashboardTitle').text()+'.png').appendTo(t);o[0].click(),o.remove();});},registerChangeSorting:function(){var t=this,a=this.getContainer();t.setSortingButton(a.find('.changeRecordSort')),a.find('.changeRecordSort').on('click',function(i){var e=a.find('a[name="drefresh"]');t.setSortingButton(jQuery(i.currentTarget)),e.click();});},registerWidgetSwitch:function(){var t=this,e=this.getContainer().find('.dashboardWidgetHeader .js-switch--calculations');t.setUrlSwitch(e),e.on('change',function(a){var e=$(a.currentTarget),i=e.closest('.dashboardWidgetHeader'),n=i.find('a[name="drefresh"]');t.setUrlSwitch(e).done(function(e){e&&n.click();});});},setUrlSwitch:function(e){var t=jQuery.Deferred();return e.each(function(a,i){var e=jQuery(i),n=e.closest('.dashboardWidgetHeader'),o=n.find('a[name="drefresh"]'),r=o.data('url'),d=e.data('urlparams');if(''!==d){var s=e.data('url-value');r=r.replace('&'+d+'='+s,''),r+='&'+d+'='+s,o.data('url',r),t.resolve(!0);}else t.reject();}),t.promise()},getFilterData:function(){return {}},refreshWidget:function(){var e=this,t=this.getContainer(),a=t.find('a[name="drefresh"]'),i=a.data('url'),n=t.find('.dashboardWidgetContent'),o=i,r=t.find('.widgetFilter');0<r.length&&(o={},o.url=i,o.data={},r.each(function(e,t){var a=$(t),i=a.attr('name');o.data[i]='checkbox'===a.attr('type')?a.is(':checked'):a.val();}));var d=t.find('.js-chartFilter__additional-filter-field');0<d.length&&(o={},o.url=i,o.data={},d.each(function(e,t){var a=jQuery(t),i=a.attr('name'),n=!1;'[]'===i.substr(-2)&&(n=!0,i=i.substr(0,i.length-2),!Array.isArray(o.data[i])&&(o.data[i]=[])),'checkbox'===a.attr('type')?n?o.data[i].push(a.is(':checked')):o.data[i]=a.is(':checked'):n?o.data[i].push(a.val()):o.data[i]=a.val();}));var s=t.find('.dashboardWidgetContent'),l=t.find('.dashboardWidgetFooter');s.html(''),l.html(''),s.progressIndicator(),this.paramCache&&(d.length||r.length)&&e.setFilterToCache(o.url,o.data),AppConnector.request(o).done(function(e){e=$(e);var t=e.filter('.widgetFooterContent');s.progressIndicator({mode:'hide'}),t.length&&(t=t.clone(!0,!0),l.html(t),e.each(function(t){jQuery(this).hasClass('widgetFooterContent')&&e.splice(t,1);})),n.html(e).trigger(YetiForce_Widget_Js.widgetPostRefereshEvent);}).fail(function(){s.progressIndicator({mode:'hide'});});},registerFilter:function(){var e=this.getContainer(),t=e.find('.listSearchContributor'),a=e.find('a[name="drefresh"]'),i=a.data('url'),n=e.find('.select2noactive');t.css('width','100%'),t.parent().addClass('w-100'),t.each(function(e,t){var a=$(t).data('fieldinfo');$(t).attr('placeholder',a.label).data('placeholder',a.label);}),App.Fields.Picklist.changeSelectElementView(n,'select2',{containerCssClass:'form-control'}),App.Fields.Date.register(e),App.Fields.Date.registerRange(e),t.on('change apply.daterangepicker',function(){var t=[];e.find('.listSearchContributor').each(function(e,a){var i=[],n=$(a),o=n.data('fieldinfo'),r=n.attr('name'),d=n.val();if('object'===('undefined'==typeof d?'undefined':_typeof(d))&&(null==d?d='':d=d.join('##')),d=d.trim(),0>=d.length)return !0;var s='a';o.hasOwnProperty('searchOperator')?s=o.searchOperator:0<=jQuery.inArray(o.type,['modules','time','userCreator','owner','picklist','tree','boolean','fileLocationType','userRole','companySelect','multiReferenceValue'])?s='e':'date'===o.type||'datetime'===o.type?s='bw':('multipicklist'===o.type||'categoryMultipicklist'===o.type)&&(s='c'),i.push(r),i.push(s),i.push(d),('tree'===o.type||'categoryMultipicklist'===o.type)&&i.push($('.listViewHeaders .searchInSubcategories[data-columnname="'+r+'"]').prop('checked')),t.push(i);});var n=i+'&search_params='+JSON.stringify(t);a.data('url',n),a.trigger('click');});},registerFilterChangeEvent:function(){var e=this.getContainer();e.on('change','.widgetFilter',function(t){$(t.currentTarget).closest('li').find('a[name="drefresh"]').trigger('click');}),e.find('.widgetFilterByField').length&&(App.Fields.Picklist.showSelect2ElementView(e.find('.select2noactive')),this.getContainer().on('change','.widgetFilterByField .form-control',function(t){$(t.currentTarget).closest('li').find('a[name="drefresh"]').trigger('click');}));},registerWidgetPostLoadEvent:function(e){var t=this;e.on(YetiForce_Widget_Js.widgetPostLoadEvent,function(){t.postLoadWidget();});},registerWidgetPostRefreshEvent:function(e){var t=this;e.off(YetiForce_Widget_Js.widgetPostRefereshEvent),e.on(YetiForce_Widget_Js.widgetPostRefereshEvent,function(){t.postRefreshWidget();});},registerSectionClick:function(){var t=this,a=!1;$(t.chartInstance.canvas).on('click',function(a){'undefined'!=typeof t.getDataFromEvent(a,['links']).links&&(window.location.href=t.getDataFromEvent(a,['links']).links);}).on('mousemove',function(i){'undefined'==typeof t.getDataFromEvent(i,['links']).links?a&&($(this).css('cursor','auto'),a=!1):!a&&($(this).css('cursor','pointer'),a=!0);}).on('mouseout',function(){a&&($(this).css('cursor','auto'),a=!1);});},registerLoadMore:function(){var e=this,t=e.getContainer(),a=t.find('.dashboardWidgetContent');a.off('click','.showMoreHistory'),a.on('click','.showMoreHistory',function(t){var e=jQuery(t.currentTarget);e.hide();var i=jQuery(t.delegateTarget).closest('.dashboardWidget');jQuery(i).find('.slimScrollDiv').css('overflow','visible');var n=i.find('.owner').val(),o=i.find('[name=\'type\']').val(),r=e.data('url')+'&content=true&owner='+n;0<i.find('[name=\'type\']').length&&(r+='&type='+o),0<i.find('.changeRecordSort').length&&(r+='&sortorder='+i.find('.changeRecordSort').data('sort')),a.progressIndicator(),AppConnector.request(r).done(function(t){a.progressIndicator({mode:'hide'}),jQuery(i).find('.dashboardWidgetContent').append(t),e.parent().remove();});});},setFilterToCache:function(e,t){var a=e,n=this.getContainer();for(var o in a=a.replace('&content=','&notcontent='),t)'object'==_typeof(t[o])&&(t[o]=JSON.stringify(t[o])),a+='&'+o+'='+t[o];var i=app.getMainParams('current_user_id'),r=n.data('name');app.cacheSet(r+i,a);},registerCache:function(e){1==e.data('cache')&&(this.paramCache=!0);},registerContentAutoResize:function t(){var e=this;this.getContainer().closest('.grid-stack').on('gsresizestop',function(){e.loadScrollbar();});},loadChart:function(){var e=this;if('undefined'==typeof this.chartData||'undefined'==typeof this.getChartContainer())return !1;this.getWidgetData();var t=this.getType(),a=this.generateData();a.datasets=this.loadDatasetOptions(a);var i=this.parseOptions(this.loadBasicOptions(a)),n=this.parseOptions(this.loadPlugins(a));a=this.parseOptions(a);var o=this.chartInstance=new Chart(this.getChartContainer().getContext('2d'),{type:t,data:a,options:i,plugins:n});return a.datasets=a.datasets.map(function(t,a){return t.datasetIndex=a,e.parseOptions(t,!0,t)}),o},getDataFromEvent:function(t,e){var a=this.chartInstance,i=a.getElementAtEvent(t);if(0===i.length)return !1;var n=i[0],o=n._index,r=n._datasetIndex,d={label:a.data.labels[o],value:a.data.datasets[0].data[o]};return 'undefined'!=typeof e&&Array.isArray(e)&&e.forEach(function(e){'undefined'!=typeof a.data.datasets[r][e]&&'undefined'!=typeof a.data.datasets[r][e][o]&&(d[e]=a.data.datasets[r][e][o]);}),d},loadBasicOptions:function(e){return this.formatTooltipTitles(e),this.formatTooltipLabels(e),this.mergeOptions(this.getBasicOptions(e),this.getDefaultBasicOptions(this.getSubType(),e))},loadDatasetOptions:function(e){var t=this;return e.datasets.map(function(a){var i=t.mergeOptions(a,t.getDatasetOptions(e),t.getDefaultDatasetOptions(t.getSubType(),e));return i})},loadPlugins:function(e){return this.mergeOptionsArray(this.getPlugins(e),this.getDefaultPlugins(this.getSubType(),e))},formatTooltipTitles:function(e){var t=this;e.datasets.forEach(function(a){'undefined'==typeof a.titlesFormatted&&(a.titlesFormatted=[],a.data.forEach(function(i,n){var o=e.labels[n];if(0<String(o).length&&!isNaN(Number(o))&&('undefined'!=typeof t.widgetData&&'undefined'!=typeof t.widgetData.valueType&&'count'===t.widgetData.valueType?o=app.parseNumberToShow(o,0):o=app.parseNumberToShow(o)),'undefined'!=typeof a.label){var r=a.label;0<String(r).length&&!isNaN(Number(r))&&('undefined'!=typeof t.widgetData&&'undefined'!=typeof t.widgetData.valueType&&'count'===t.widgetData.valueType?r=app.parseNumberToShow(r,0):r=app.parseNumberToShow(r)),o+=' ('+r+')';}a.titlesFormatted.push(o);}));});},formatTooltipLabels:function(e){var t=this;e.datasets.forEach(function(e){'undefined'==typeof e.dataFormatted&&(e.dataFormatted=[],e.data.forEach(function(a){var i=a;0<String(a).length&&!isNaN(Number(a))&&('undefined'!=typeof t.widgetData&&'undefined'!=typeof t.widgetData.valueType&&'count'===t.widgetData.valueType?i=app.parseNumberToShow(a,0):i=app.parseNumberToShow(a)),e.dataFormatted.push(i);}));});},mergeOptionsArray:function(e,t){var a=this;if('undefined'!=typeof e)return e;e=[];var i=t.map(function(t,i){return Array.isArray(t)&&!e.hasOwnProperty(key)?a.mergeOptionsArray(e[i],t):'object'===('undefined'==typeof t?'undefined':_typeof(t))&&null!==t&&('undefined'==typeof e[i]||'object'===_typeof(e[i])&&null!==e[i])?a.mergeOptionsObject(e[i],t):e[i]}).filter(function(e){return 'undefined'!=typeof e});return i},mergeOptionsObject:function(e,t){for(var a in'undefined'==typeof e&&(e={}),t)t.hasOwnProperty(a)&&(Array.isArray(t[a])?!e.hasOwnProperty(a)&&(e[a]=this.mergeOptionsArray(void 0,t[a])):'object'!==_typeof(t[a])||null===t[a]||e.hasOwnProperty(a)&&('object'!==_typeof(e[a])||null===e[a]||Array.isArray(e[a]))?!e.hasOwnProperty(a)&&(e[a]=t[a]):e[a]=this.mergeOptionsObject(e[a],t[a]));return e},mergeOptions:function(){for(var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length,a=Array(1<t?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];for(var o=0,i=a.length;o<i;o++)'object'!==_typeof(a[o])||Array.isArray(a[o])?app.errorLog(new Error('Options argument should be an object! Chart subType: '+this.getSubType()+' ['+a[o].toString()+']')):e=this.mergeOptionsObject(e,a[o]);return e},getBasicOptions:function(){return {responsive:!0,maintainAspectRatio:!1}},getDatasetOptions:function(){return {}},getPlugins:function(){},getType:function(){return 'bar'},getSubType:function(){return this.getType()}}),Vtiger_Widget_Js('YetiForce_Widget_Js',{},{}),YetiForce_Widget_Js('YetiForce_Bar_Widget_Js',{},{getType:function(){return 'bar'}}),YetiForce_Bar_Widget_Js('YetiForce_BarStacked_Widget_Js',{},{getSubType:function e(){return 'barStacked'}}),YetiForce_Bar_Widget_Js('YetiForce_Horizontal_Widget_Js',{},{getType:function e(){return 'horizontalBar'}}),YetiForce_Horizontal_Widget_Js('YetiForce_HorizontalStacked_Widget_Js',{},{getType:function e(){return 'horizontalBar'},getSubType:function e(){return 'horizontalBarStacked'}}),YetiForce_Widget_Js('YetiForce_Funnel_Widget_Js',{},{getType:function(){return 'funnel'}}),YetiForce_Widget_Js('YetiForce_Pie_Widget_Js',{},{getType:function(){return 'pie'}}),YetiForce_Pie_Widget_Js('YetiForce_PieDivided_Widget_Js',{},{getSubType:function e(){return 'pieDivided'}}),YetiForce_Pie_Widget_Js('YetiForce_Donut_Widget_Js',{},{getType:function(){return 'doughnut'}}),YetiForce_Donut_Widget_Js('YetiForce_Axis_Widget_Js',{},{}),YetiForce_Widget_Js('YetiForce_BarDivided_Widget_Js',{},{getType:function(){return 'bar'},getSubType:function(){return 'barDivided'}}),YetiForce_Widget_Js('YetiForce_Line_Widget_Js',{},{getType:function(){return 'line'}}),YetiForce_Line_Widget_Js('YetiForce_LineStacked_Widget_Js',{},{getType:function e(){return 'line'},getSubType:function e(){return 'lineStacked'}}),YetiForce_Line_Widget_Js('YetiForce_LinePlain_Widget_Js',{},{getSubType:function(){return 'linePlain'}}),YetiForce_LineStacked_Widget_Js('YetiForce_LinePlainStacked_Widget_Js',{},{getSubType:function e(){return 'linePlainStacked'}}),YetiForce_Bar_Widget_Js('YetiForce_TicketsByStatus_Widget_Js',{},{getBasicOptions:function e(){return {legend:{display:!0},scales:{xAxes:[{stacked:!0}],yAxes:[{stacked:!0}]}}}}),YetiForce_Widget_Js('YetiForce_Calendar_Widget_Js',{},{calendarView:!1,calendarCreateView:!1,registerCalendar:function l(){var t=this,e=this,a=e.getContainer(),i=jQuery('#time_format').val();i=24==i?'H(:mm)':'h(:mm) A';var n=CONFIG.firstDayOfWeekNo,o=jQuery('#start_hour').val(),r=o.split(':');o=r[0];var d=app.getMainParams('defaultDate');this.paramCache&&d!=moment().format('YYYY-MM-DD')&&(d=1==moment(d).format('D')?moment(d):moment(d).add(1,'M')),e.getCalendarView().fullCalendar({header:{left:' ',center:'prev title next',right:' '},defaultDate:d,timeFormat:i,axisFormat:i,firstHour:o,firstDay:n,defaultView:'month',editable:!1,slotMinutes:15,theme:!1,defaultEventMinutes:0,eventLimit:!0,allDaySlot:!1,monthNames:[app.vtranslate('JS_JANUARY'),app.vtranslate('JS_FEBRUARY'),app.vtranslate('JS_MARCH'),app.vtranslate('JS_APRIL'),app.vtranslate('JS_MAY'),app.vtranslate('JS_JUNE'),app.vtranslate('JS_JULY'),app.vtranslate('JS_AUGUST'),app.vtranslate('JS_SEPTEMBER'),app.vtranslate('JS_OCTOBER'),app.vtranslate('JS_NOVEMBER'),app.vtranslate('JS_DECEMBER')],monthNamesShort:[app.vtranslate('JS_JAN'),app.vtranslate('JS_FEB'),app.vtranslate('JS_MAR'),app.vtranslate('JS_APR'),app.vtranslate('JS_MAY'),app.vtranslate('JS_JUN'),app.vtranslate('JS_JUL'),app.vtranslate('JS_AUG'),app.vtranslate('JS_SEP'),app.vtranslate('JS_OCT'),app.vtranslate('JS_NOV'),app.vtranslate('JS_DEC')],dayNames:[app.vtranslate('JS_SUNDAY'),app.vtranslate('JS_MONDAY'),app.vtranslate('JS_TUESDAY'),app.vtranslate('JS_WEDNESDAY'),app.vtranslate('JS_THURSDAY'),app.vtranslate('JS_FRIDAY'),app.vtranslate('JS_SATURDAY')],dayNamesShort:[app.vtranslate('JS_SUN'),app.vtranslate('JS_MON'),app.vtranslate('JS_TUE'),app.vtranslate('JS_WED'),app.vtranslate('JS_THU'),app.vtranslate('JS_FRI'),app.vtranslate('JS_SAT')],buttonText:{today:app.vtranslate('JS_TODAY'),month:app.vtranslate('JS_MONTH'),week:app.vtranslate('JS_WEEK'),day:app.vtranslate('JS_DAY')},allDayText:app.vtranslate('JS_ALL_DAY'),eventLimitText:app.vtranslate('JS_MORE'),eventRender:function i(e,t){for(var a in t='<div class="cell-calendar">',e.event)t+='<a class="" href="javascript:;" data-date="'+e.date+'" data-type="'+a+'" title="'+e.event[a].label+'"><span class="'+e.event[a].className+(20>=e.width?' small-badge':'')+(24<=e.width?' big-badge':'')+' badge badge-secondary u-font-size-95per">'+e.event[a].count+'</span></a>\n';return t+='</div>',t}}),e.getCalendarView().find('td.fc-day-top').on('mouseenter',function(){jQuery('<span class="plus pull-left fas fa-plus"></span>').prependTo($(this));}).on('mouseleave',function(){$(this).find('.plus').remove();}),e.getCalendarView().find('td.fc-day-top').on('click',function(){var t=$(this).data('date'),a={noCache:!0};a.data={date_start:t,due_date:t},a.callbackFunction=function(){e.getCalendarView().closest('.dashboardWidget').find('a[name="drefresh"]').trigger('click');},Vtiger_Header_Js.getInstance().quickCreateModule('Calendar',a);});var s=a.find('.js-switch--calendar');s.on('change',function(i){var e=$(i.currentTarget);'undefined'==typeof e.data('on-text')?'undefined'!=typeof e.data('off-text')&&a.find('.widgetFilterSwitch').val('history'):a.find('.widgetFilterSwitch').val('current'),t.refreshWidget();});},loadCalendarData:function p(){var e=this;e.getCalendarView().fullCalendar('removeEvents');var t=e.getCalendarView().fullCalendar('getView'),a=CONFIG.dateFormat.toUpperCase(),i=t.start.format(a),n=t.end.format(a),o=e.getContainer(),r=o.find('.owner').val();'all'==r&&(r='');var d={module:'Calendar',action:'Calendar',mode:'getEvents',start:i,end:n,user:r,widget:!0};if(0<o.find('.customFilter').length){var s=o.find('.customFilter').val();d.customFilter=s;}if(0<o.find('.widgetFilterSwitch').length&&(d.time=o.find('.widgetFilterSwitch').val()),this.paramCache){var l=this.getContainer().find('a[name="drefresh"]'),c=l.data('url'),g={owner:r,customFilter:s,start:i};e.setFilterToCache(c,g);}AppConnector.request(d).done(function(t){var a=e.getCalendarView().find('.fc-bg :first').height()-e.getCalendarView().find('.fc-day-number').height()-10,n=e.getCalendarView().find('.fc-day-number').width()/2-10;for(var r in t.result)t.result[r].width=n,t.result[r].height=a;e.getCalendarView().fullCalendar('addEventSource',t.result),e.getCalendarView().find('.cell-calendar a').on('click',function(){var t=e.getContainer(),a='index.php?module=Calendar&view=List';a+=s?'&viewname='+t.find('select.widgetFilter.customFilter').val():'&viewname=All',a+='&search_params=[[';var i=t.find('.widgetFilter.owner option:selected');if('all'!=i.val()&&(a+='["assigned_user_id","e","'+i.val()+'"],'),0<o.find('.widgetFilterSwitch').length){var n=o.find('.widgetFilterSwitch').data();a+='["activitystatus","e","'+n[d.time]+'"],';}var r=moment($(this).data('date')).format(e.getUserDateFormat().toUpperCase());window.location.href=a+'["activitytype","e","'+$(this).data('type')+'"],["date_start","bw","'+r+','+r+'"]]]';});});},getCalendarView:function e(){return !1==this.calendarView&&(this.calendarView=this.getContainer().find('#calendarview')),this.calendarView},getMonthName:function a(){var e=this,t=e.getCalendarView().find('.fc-toolbar h2').text();t&&this.getContainer().find('.headerCalendar .month').html('<h3>'+t+'</h3>');},registerChangeView:function o(){var e=this,t=this.getContainer();t.find('.fc-toolbar').addClass('d-none');var a=t.find('.fc-toolbar h2').text();if(a){var i=t.find('.headerCalendar').removeClass('d-none').find('.month').append('<h3>'+a+'</h3>'),n=t.find('.headerCalendar button');n.each(function(){var t=jQuery(this).data('type');jQuery(this).on('click',function(){e.getCalendarView().find('.fc-toolbar .'+t).trigger('click'),e.loadCalendarData(),e.getMonthName();});});}},postLoadWidget:function e(){this.registerCalendar(),this.loadCalendarData(!0),this.registerChangeView(),this.registerFilterChangeEvent(),app.showPopoverElementView(this.getContainer().find('.js-popover-tooltip'));},refreshWidget:function a(){var e=this,t=this.getContainer().find('.dashboardWidgetContent');t.progressIndicator(),e.loadCalendarData(),t.progressIndicator({mode:'hide'});}}),YetiForce_Widget_Js('YetiForce_CalendarActivities_Widget_Js',{},{modalView:!1,postLoadWidget:function e(){this._super(),this.registerActivityChange(),this.registerListViewButton();},postRefreshWidget:function e(){this._super(),this.registerActivityChange();},registerActivityChange:function a(){var t=this,e=this.getContainer().find('.dashboardWidgetContent');e.find('.changeActivity').on('click',function(a){if(!(jQuery(a.target).is('a')||t.modalView)){var e=jQuery(this).data('url');if('undefined'!=typeof e){var i=function(){t.modalView=!1;};t.modalView=!0,app.showModalWindow(null,e,i);}}});},registerListViewButton:function a(){var e=this,t=e.getContainer();t.find('.goToListView').on('click',function(){if('OverdueActivities'==t.data('name'))var e='PLL_OVERDUE';else var e='PLL_IN_REALIZATION,PLL_PLANNED';var a='index.php?module=Calendar&view=List&viewname=All';a+='&search_params=[[';var i=t.find('.widgetFilter.owner option:selected');'all'!=i.val()&&(a+='["assigned_user_id","e","'+i.val()+'"],'),a+='["activitystatus","e","'+e+'"]]]',window.location.href=a;});}}),YetiForce_CalendarActivities_Widget_Js('YetiForce_AssignedUpcomingCalendarTasks_Widget_Js',{},{}),YetiForce_CalendarActivities_Widget_Js('YetiForce_CreatedNotMineActivities_Widget_Js',{},{}),YetiForce_CalendarActivities_Widget_Js('YetiForce_OverDueActivities_Widget_Js',{},{}),YetiForce_CalendarActivities_Widget_Js('YetiForce_AssignedOverDueCalendarTasks_Widget_Js',{},{}),YetiForce_Widget_Js('YetiForce_Productssoldtorenew_Widget_Js',{},{modalView:!1,postLoadWidget:function e(){this._super(),this.registerAction(),this.registerListViewButton();},postRefreshWidget:function e(){this._super(),this.registerAction();},registerAction:function a(){var t=this,e=this.getContainer().find('.dashboardWidgetContent');e.find('.rowAction').on('click',function(a){if(!(jQuery(a.target).is('a')||t.modalView)){var e=jQuery(this).data('url');if('undefined'!=typeof e){var i=function(){t.modalView=!1;};t.modalView=!0,app.showModalWindow(null,e,i);}}});},registerListViewButton:function a(){var e=this,t=e.getContainer();t.find('.goToListView').on('click',function(){var e=jQuery(this).data('url'),a=t.find('.orderby'),i=t.find('.changeRecordSort');a.length&&(e+='&orderby='+a.val()),i.length&&(e+='&sortorder='+i.data('sort').toUpperCase()),window.location.href=e;});}}),YetiForce_Productssoldtorenew_Widget_Js('YetiForce_ServicesSoldToRenew_Widget_Js',{},{}),YetiForce_Bar_Widget_Js('YetiForce_AllTimeControl_Widget_Js',{},{getBasicOptions:function(){return {legend:{display:!0},scales:{yAxes:[{stacked:!0,ticks:{callback:function(e){return app.formatToHourText(e,'short',!1,!1)}}}],xAxes:[{stacked:!0,ticks:{minRotation:0}}]},tooltips:{callbacks:{label:function a(e,t){return t.datasets[e.datasetIndex].original_label+': '+app.formatToHourText(e.yLabel)},title:function a(e,t){return t.fullLabels[e[0].index]}}}}},getDatasetOptions:function(){return {datalabels:{formatter:function(e){return app.formatToHourText(e)}}}}}),YetiForce_Bar_Widget_Js('YetiForce_LeadsBySource_Widget_Js',{},{}),YetiForce_Pie_Widget_Js('YetiForce_ClosedTicketsByPriority_Widget_Js',{},{}),YetiForce_Bar_Widget_Js('YetiForce_ClosedTicketsByUser_Widget_Js',{},{}),YetiForce_Bar_Widget_Js('YetiForce_OpenTickets_Widget_Js',{},{}),YetiForce_Bar_Widget_Js('YetiForce_AccountsByIndustry_Widget_Js',{},{}),YetiForce_Funnel_Widget_Js('YetiForce_EstimatedvalueByStatus_Widget_Js',{},{getBasicOptions:function(){return {sort:'data-desc'}},getPlugins:function(){return []}}),YetiForce_Bar_Widget_Js('YetiForce_NotificationsBySender_Widget_Js',{},{}),YetiForce_Bar_Widget_Js('YetiForce_NotificationsByRecipient_Widget_Js',{},{}),YetiForce_Bar_Widget_Js('YetiForce_TeamsEstimatedSales_Widget_Js',{},{generateChartData:function s(){var e=this,t=this.getContainer(),a=t.find('.widgetData').val(),i=JSON.parse(a),n=[[],[],[],[]],o=0;if(i.hasOwnProperty('compare'))for(var r in i){var d=e.parseChartData(i[r],n);n[0].push(d[0]),n[3].push(d[3]),n=[n[0],d[1],d[2],n[3],['#CC6600','#208CB3']];}else{var d=e.parseChartData(i,n);n=[[d[0]],d[1],d[2],[d[3]],['#208CB3']];}var o=n[1];return o=o+2+25*(o/100),{chartData:n[0],yMaxValue:o,labels:n[2],data_labels:n[3],placement:'inside',location:'n',colors:n[4]}},parseChartData:function d(e,t){var a=[],i=[],n=0;for(var o in e){var r=e[o];r[0]=parseInt(r[0]),n+=r[0],i.push(app.getDecodedValue(r[1])),a.push(r[0]),parseInt(r[0])>t[1]&&(t[1]=parseInt(r[0]));}return [a,t[1],i,'&nbsp; \u03A3 '+n+'&nbsp;']},registerSectionClick:function n(){var e=this.getContainer(),t=e.find('.widgetData').val(),a=JSON.parse(t),i=a&&a.hasOwnProperty('compare');this.getContainer().off('jqplotDataClick').on('jqplotDataClick',function(e,t,n){if(t)var o=a.compare[n][2];else if(i)var o=a[0][n][2];else var o=a[n][2];window.location.href=o;});}}),YetiForce_TeamsEstimatedSales_Widget_Js('YetiForce_ActualSalesOfTeam_Widget_Js',{},{}),YetiForce_Widget_Js('YetiForce_History_Widget_Js',{},{postLoadWidget:function e(){this._super(),this.registerLoadMore();},postRefreshWidget:function e(){this._super(),this.registerLoadMore();},registerLoadMore:function n(){var e=this,t=e.getContainer(),a=t.find('.dashboardWidgetContent'),i=a.find('.load-more');i.on('click',function(){var t=e.getContainer(),a=t.find('a[name="drefresh"]'),n=a.data('url'),o=n,r=t.find('.widgetFilter');0<r.length&&(o={url:n,data:{}},r.each(function(e,t){var a=jQuery(t),i=a.attr('name'),n=a.val();o.data[i]=n;}));var d=e.getFilterData();jQuery.isEmptyObject(d)||('string'==typeof o&&(o={url:n,data:{}}),o.data=jQuery.extend(o.data,e.getFilterData())),o.data.page=i.data('nextpage');var s=t.find('.dashboardWidgetContent');s.progressIndicator(),AppConnector.request(o).done(function(t){s.progressIndicator({mode:'hide'}),i.replaceWith(t),e.registerLoadMore();}).fail(function(){s.progressIndicator({mode:'hide'});});});}}),YetiForce_Widget_Js('YetiForce_MiniList_Widget_Js',{},{postLoadWidget:function e(){app.hideModalWindow(),this.restrictContentDrag(),this.registerFilterChangeEvent(),this.registerRecordsCount(),app.showPopoverElementView(this.getContainer().find('.js-popover-tooltip'));},postRefreshWidget:function e(){this.registerRecordsCount();}}),YetiForce_Widget_Js('YetiForce_Notebook_Widget_Js',{},{postLoadWidget:function e(){this.reinitNotebookView();},reinitNotebookView:function t(){var e=this;app.showScrollBar(jQuery('.dashboard_notebookWidget_viewarea',this.container),{height:'200px'}),jQuery('.dashboard_notebookWidget_edit',this.container).on('click',function(){e.editNotebookContent();}),jQuery('.dashboard_notebookWidget_save',this.container).on('click',function(){e.saveNotebookContent();});},editNotebookContent:function e(){jQuery('.dashboard_notebookWidget_text',this.container).show(),jQuery('.dashboard_notebookWidget_view',this.container).hide(),$('body').on('click',function(t){0===$(t.target).closest('.dashboard_notebookWidget_view').length&&0===$(t.target).closest('.dashboard_notebookWidget_text').length&&$('.dashboard_notebookWidget_save').trigger('click');});},saveNotebookContent:function o(){$('body').off('click');var e=this,t=jQuery('.dashboard_notebookWidget_textarea',this.container),a=this.container.data('url'),i=a+'&content=true&mode=save&contents='+encodeURIComponent(t.val()),n=this.container.find('.dashboardWidgetContent');n.progressIndicator(),AppConnector.request(i).done(function(t){n.progressIndicator({mode:'hide'}),jQuery('.dashboardWidgetContent',e.container).html(t),e.reinitNotebookView();});}}),YetiForce_Widget_Js('YetiForce_KpiBar_Widget_Js',{},{generateChartData:function i(){var e=this.getContainer(),t=e.find('.widgetData').val(),a=JSON.parse(t);return {chartData:[[[a.result,a.all]]],yMaxValue:a.maxValue,labels:''}},loadChart:function t(){var e=this.generateChartData();this.getChartContainer(!1).jqplot(e.chartData,{animate:!$.jqplot.use_excanvas,seriesDefaults:{renderer:jQuery.jqplot.BarRenderer,rendererOptions:{showDataLabels:!0,dataLabels:'value',barDirection:'horizontal'}},axes:{xaxis:{min:0,max:e.yMaxValue},yaxis:{renderer:jQuery.jqplot.CategoryAxisRenderer}}});}}),YetiForce_Widget_Js('YetiForce_ChartFilter_Widget_Js',{},{chartfilterInstance:!1,init:function i(e){this.setContainer(jQuery(e));var t=e.find('[name="typeChart"]').val(),a=!!Number(e.find('[name="stacked"]').val());if(a&&(t+='Stacked'),this.chartfilterInstance=YetiForce_Widget_Js.getInstance(e,t),this.chartfilterInstance){var n=e.find('[name="filterIds"]').val();n&&(this.chartfilterInstance.filterIds=JSON.parse(n));}this.registerRecordsCount();}});
//# sourceMappingURL=Widget.min.js.map
