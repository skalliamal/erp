'use strict';

jQuery.Class("Vtiger_AdvanceFilter_Js",{getInstance:function f(a){var b,c=app.getModuleName(),d=c+"_AdvanceFilterEx_Js",e=c+"_AdvanceFilter_Js";return b="undefined"==typeof window[d]?"undefined"==typeof window[e]?"undefined"==typeof window.Vtiger_AdvanceFilterEx_Js?new window.Vtiger_AdvanceFilter_Js(a):new window.Vtiger_AdvanceFilterEx_Js(a):new window[e](a):new window[d](a),b}},{filterContainer:!1,fieldTypeConditionMapping:!1,conditonOperatorLabelMapping:!1,dateConditionInfo:!1,fieldModelInstance:!1,validationSupportedFieldConditionMap:{email:["e","n"]},allConditionValidationNeededFieldList:["double","integer","currency"],validationForControlsRegistered:!1,init:function b(a){"undefined"==typeof a&&(a=jQuery(".filterContainer")),a.is(".filterContainer")?this.setFilterContainer(a):this.setFilterContainer(jQuery(".filterContainer",a)),this.initialize();},getModuleName:function a(){return "AdvanceFilter"},initialize:function a(){this.registerEvents(),this.initializeOperationMappingDetails(),this.loadFieldSpecificUiForAll();},initializeOperationMappingDetails:function b(){var a=this.getFilterContainer();return this.fieldTypeConditionMapping=jQuery("input[name=\"advanceFilterOpsByFieldType\"]",a).data("value"),this.conditonOperatorLabelMapping=jQuery("input[name=\"advanceFilterOptions\"]",a).data("value"),this.dateConditionInfo=jQuery("[name=\"date_filters\"]").data("value"),this},getFilterContainer:function a(){return this.filterContainer},setFilterContainer:function b(a){return this.filterContainer=a,this},getDateSpecificConditionInfo:function a(){return this.dateConditionInfo},getConditionListFromType:function c(a){var b=this.fieldTypeConditionMapping[a];return ("D"==a||"DT"==a)&&(b=b.concat(this.getDateConditions(a))),b},getDateConditions:function d(a){if("D"!=a&&"DT"!=a)return [];var b=this.getFilterContainer(),c=this.getDateSpecificConditionInfo();return Object.keys(c)},getConditionLabel:function b(a){return a in this.conditonOperatorLabelMapping?this.conditonOperatorLabelMapping[a]:a in this.getDateSpecificConditionInfo()?this.getDateSpecificConditionInfo()[a].label:a},isEmptyFieldSelected:function c(a){var b=a.find("option:selected");return !("none"!=b.val())},getAddConditionElement:function b(){var a=this.getFilterContainer();return jQuery(".addCondition button",a)},addNewCondition:function f(a){var b=$(".basic",a),c=b.find(".js-conditions-row").clone(!0,!0),d=c.find("select").addClass("select2"),e=$(".conditionList",a);return e.append(c),App.Fields.Picklist.showSelect2ElementView(d,{dropdownParent:a}),this},addConditionHandler:function d(a){var b=jQuery(a.currentTarget),c=b.closest("div.conditionGroup");this.addNewCondition(c);},getFieldSpecificType:function d(a){var b=a.data("fieldinfo"),c=b.type;return "reference"==c?"V":a.data("fieldtype")},loadConditions:function o(a){var b=a.closest("div.js-conditions-row"),c=b.find("select[name=\"comparator\"]"),d=b.find("[name=\"column_condition\"]"),e=c.val(),f=a.find("option:selected"),g=this.getFieldSpecificType(f),h=this.getConditionListFromType(g),i=f.data("field-name"),j=f.data("fieldinfo");"undefined"==typeof h&&(h={},h.none="None");var k="";for(var l in h)if((-1==jQuery.inArray(j.type,["rangeTime","image"])||-1!=jQuery.inArray(h[l],["y","ny"]))&&(-1==jQuery.inArray(j.type,["userCreator","owner","picklist","modules","tree","inventoryLimit","languages","currencyList","fileLocationType"])||-1==jQuery.inArray(h[l],["s","ew","c","k"]))&&("om"!==h[l]||-1!=jQuery.inArray(j.type,["owner","sharedOwner","userCreator"]))&&(-1==jQuery.inArray(h[l],["wr","nwr"])||-1!=jQuery.inArray(j.type,["owner"]))&&(-1==jQuery.inArray(h[l],["s","ew"])||-1==jQuery.inArray(j.type,["taxes","multipicklist","categoryMultipicklist","sharedOwner"]))&&(-1==jQuery.inArray(h[l],["bw","m","h"])||-1==jQuery.inArray(j.type,["time"]))&&("d"!==h[l]||"and"===d.val())&&h.hasOwnProperty(l)){var m=h[l],n=this.getConditionLabel(m);k+="<option value=\""+m+"\"",m==e&&(k+=" selected=\"selected\" "),k+=">"+n+"</option>";}return c.empty().html(k).trigger("chosen:updated"),c},getFieldSpecificUi:function g(a){var b=a.find("option:selected"),c=this.fieldModelInstance;if("d"===c.get("comparatorElementVal")){var d="<div class=\"checkbox\"><label><input type=\"checkbox\" name=\""+c.getName()+"\" value=\"0\" ";return (1===c.getValue()||"1"===c.getValue())&&(d+="checked"),d+=" >"+app.vtranslate("JS_IGNORE_EMPTY_VALUES")+"</label></div>",jQuery(d)}if("boolean"==c.getType().toLowerCase()){var e=a.closest(".js-conditions-row"),f=e.find("[data-value=\"value\"]").val(),d="<select class=\"chzn-select\" name=\""+c.getName()+"\">";return d+="<option value=\"0\"","0"==f&&(d+=" selected=\"selected\" "),d+=">"+app.vtranslate("JS_IS_DISABLED")+"</option>",d+="<option value=\"1\"","1"==f&&(d+=" selected=\"selected\" "),d+=">"+app.vtranslate("JS_IS_ENABLED")+"</option>",d+="</select>",jQuery(d)}return jQuery(c.getUiTypeSpecificHtml())},loadFieldSpecificUi:function m(a){var b=a.find("option:selected"),c=a.closest("div.js-conditions-row"),d=c.find(".fieldUiHolder"),e=c.find("select[name=\"comparator\"]"),f=b.data("fieldinfo"),g="string";"undefined"!=typeof f&&(g=f.type);var h=f.comparatorElementVal=e.val();("date"==g||"datetime"==g)&&(f.dateSpecificConditions=this.getDateSpecificConditionInfo());var i=this.getModuleName(),j=Vtiger_Field_Js.getInstance(f,i);this.fieldModelInstance=j;var k=this.getFieldSpecificUi(a),l=j.getName();-1<$.inArray(j.getType(),["multipicklist","sharedOwner","multiReferenceValue","taxes","categoryMultipicklist"])?l+="[]":-1<$.inArray(j.getType(),["userCreator","picklist","owner","languages","modules","inventoryLimit","currencyList","fileLocationType"])&&k.is("select")&&("e"==h||"n"==h)&&(l+="[]"),0<k.find(".input-group-addon").length?(k.find(".input-group").addClass("row"),k.find(".input-group").addClass("row"),k.find("input[type=\"text\"]").css("width","100%"),k.find("input[type=\"text\"]").addClass("form-control")):k.filter("[name=\""+l+"\"]").addClass("form-control"),k.filter("[name=\""+l+"\"]").attr("data-value","value").removeAttr("data-validation-engine"),k.find("[name=\""+l+"\"]").attr("data-value","value").removeAttr("data-validation-engine"),"currency"==j.getType()&&(k.filter("[name=\""+l+"\"]").attr("data-decimal-separator",f.decimal_separator).attr("data-group-separator",f.group_separator),k.find("[name=\""+l+"\"]").attr("data-decimal-separator",f.decimal_separator).attr("data-group-separator",f.group_separator)),d.html(k),k.is("select")?k.hasClass("chzn-select")?App.Fields.Picklist.changeSelectElementView(k):App.Fields.Picklist.showSelect2ElementView(k,{dropdownParent:c}):0<k.has("input.dateField").length?App.Fields.Date.register(k):0<k.has("input.dateRangeField").length?App.Fields.Date.registerRange(k,{ranges:!1}):0<k.has("input.clockPicker").length&&app.registerEventForClockPicker(k),this.addValidationToFieldIfNeeded(a);return -1==["y","today","tomorrow","yesterday","smallerthannow","greaterthannow","ny","om","wr","nwr"].indexOf(e.val())?d.show():d.hide(),this},loadFieldSpecificUiForAll:function c(){var a=jQuery(".conditionList"),b=jQuery("select[name=\"columnname\"]",a);return jQuery.each(b,function(a,b){var c=jQuery(b);"none"!=c.val()&&c.trigger("change",{_intialize:!0});}),this},addValidationToFieldIfNeeded:function f(a){var b=a.find("option:selected"),c=a.closest("div.js-conditions-row"),d=c.find("[data-value=\"value\"]"),e=b.attr("data-validator");return this.isFieldSupportsValidation(a)?(d.addClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]").attr("data-validation-engine","validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]").attr("data-fieldinfo",JSON.stringify(b.data("fieldinfo"))),"undefined"!=typeof e&&d.attr("data-validator",e)):d.removeClass("validate[funcCall[Vtiger_Base_Validator_Js.invokeValidation]]").removeAttr("data-validation-engine").removeAttr("data-fieldinfo"),this},isFieldSupportsValidation:function i(a){var b=a.find("option:selected"),c=this.fieldModelInstance,d=c.getType();if(0<=jQuery.inArray(d,this.allConditionValidationNeededFieldList))return !0;var e=a.closest("div.js-conditions-row"),f=e.find("select[name=\"comparator\"]"),g=f.find("option:selected"),h=f.val();return !!(d in this.validationSupportedFieldConditionMap&&0<=jQuery.inArray(h,this.validationSupportedFieldConditionMap[d]))},getValues:function g(){var a=this,b=this.getFilterContainer(),c=new Array("columnname","comparator","value","column_condition"),d={},e=0,f=jQuery(".conditionGroup",b);return f.each(function(b,g){var h=jQuery(g);d[b+1]={};var i=jQuery(".conditionList .js-conditions-row",h);d[b+1].columns={},i.each(function(f,g){var h=jQuery(g),j=jQuery("[name=\"columnname\"]",h),k=jQuery("[data-value=\"value\"]",h);if(a.isEmptyFieldSelected(j))return !0;var l=j.find("option:selected").data("fieldinfo"),m=l.type,n=l.hasOwnProperty("searchOperator"),o={};if("owner"==m||"userCreator"==m)for(var p in c){var q=c[p];if("value"==q&&k.is("select")){var r=k.val();o[q]=r?r.join(","):"";}else o[q]="value"==q&&k.is("input")?"checkbox"===k.attr("type")&&k.prop("checked")?1:k.val():jQuery("[name=\""+q+"\"]",h).val();}else if(-1<$.inArray(m,["picklist","multipicklist","modules","sharedOwner","multiReferenceValue","inventoryLimit","languages","currencyList","taxes","fileLocationType","categoryMultipicklist"]))for(var p in c){var q=c[p];if("value"==q&&"checkbox"===k.attr("type"))o[q]=k.prop("checked")?1:k.val();else if("value"==q&&k.is("input")){var s=k.val(),t=k.data("picklistvalues"),u=s.split(","),v=[];for(f=0;f<u.length;f++)"undefined"==typeof t[u[f]]?v.push(u[f]):v.push(t[u[f]]);var w=v.join(",");o[q]=w;}else if("value"==q&&k.is("select")&&-1<$.inArray(m,["picklist","multipicklist","modules","sharedOwner","multiReferenceValue","inventoryLimit","languages","currencyList","taxes","fileLocationType","categoryMultipicklist"])){var x=k.val();o[q]=null==x?x:x.join(",");}else o[q]=jQuery("[name=\""+q+"\"]",h).val();}else for(var p in c){var q=c[p];o[q]="value"==q?"checkbox"===k.attr("type")&&k.prop("checked")?1:k.val():jQuery("[name=\""+q+"\"]",h).val();}h.is(":last-child")&&(o.column_condition=""),d[b+1].columns[e]=o,e++;}),0<h.find("div.groupCondition").length&&(d[b+1].condition=f.find("div.groupCondition [name=\"condition\"]").val());}),d},deleteConditionHandler:function d(a){var b=jQuery(a.currentTarget),c=b.closest(".js-conditions-row");c.remove();},registerAddCondition:function b(){var a=this;this.getAddConditionElement().on("click",function(b){a.addConditionHandler(b);});},registerFieldChange:function c(){var a=this.getFilterContainer(),b=this;a.on("change","select[name=\"columnname\"]",function(a,c){var d=jQuery(a.currentTarget);if("undefined"==typeof c||!0!=c._intialize){var e=d.closest("div.js-conditions-row"),f=e.find("select[name=\"comparator\"]");f.empty();}b.loadConditions(d),b.loadFieldSpecificUi(d);});},registerConditionChange:function c(){var a=this.getFilterContainer(),b=this;a.on("change","select[name=\"comparator\"]",function(a){var c=jQuery(a.currentTarget),d=c.closest("div.js-conditions-row"),e=d.find("select[name=\"columnname\"]"),f=e.find("option:selected");b.loadFieldSpecificUi(e),b.addValidationToFieldIfNeeded(e);});},registerDeleteCondition:function c(){var a=this,b=this.getFilterContainer();b.on("click",".deleteCondition",function(b){a.deleteConditionHandler(b);});},registerEvents:function a(){this.registerAddCondition(),this.registerFieldChange(),this.registerDeleteCondition(),this.registerConditionChange();}}),Vtiger_Field_Js("AdvanceFilter_Field_Js",{},{getUiTypeSpecificHtml:function b(){var a=this.getUiTypeModel();return a.getUi()},getModuleName:function c(){var a=app.getModuleName(),b=this.getType();return -1<$.inArray(b,["picklist","userCreator","multipicklist","owner","userCreator","modules","date","datetime","sharedOwner","multiReferenceValue","inventoryLimit","languages","currencyList","taxes","fileLocationType","categoryMultipicklist"])&&(a="AdvanceFilter"),a}}),Vtiger_Picklist_Field_Js("AdvanceFilter_Picklist_Field_Js",{},{getUi:function g(){var a="<select class=\"select2\" multiple name=\""+this.getName()+"[]\">",b=this.getPickListValues(),c=app.htmlDecode(this.getValue()),d=c.split(",");for(var e in b)a+="<option value=\""+e+"\" ",-1!=jQuery.inArray(e,d)&&(a+=" selected "),a+=">"+b[e]+"</option>";a+="</select>";var f=jQuery(a);return this.addValidationToElement(f),f}}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Modules_Field_Js",{},{}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Inventorylimit_Field_Js",{},{}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Filelocationtype_Field_Js",{},{}),Vtiger_Multipicklist_Field_Js("AdvanceFilter_Multipicklist_Field_Js",{},{}),Vtiger_Multipicklist_Field_Js("AdvanceFilter_Categorymultipicklist_Field_Js",{},{}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Languages_Field_Js",{},{}),AdvanceFilter_Picklist_Field_Js("AdvanceFilter_Currencylist_Field_Js",{},{}),AdvanceFilter_Multipicklist_Field_Js("AdvanceFilter_Taxes_Field_Js",{},{}),Vtiger_Owner_Field_Js("AdvanceFilter_Owner_Field_Js",{},{getUi:function k(){var a=this.get("comparatorElementVal");if("e"==a||"n"==a||"shownerid"===this.getName()&&-1!=jQuery.inArray(a,["c","k"])){var b="<select class=\"select2\" multiple name=\""+this.getName()+"[]\">",c=this.getPickListValues(),d=app.htmlDecode(this.getValue()),e=d.split(",");for(var f in c){b+="<optgroup label=\""+f+"\">";var g=c[f];for(var h in g)b+="<option value=\""+h+"\" ",-1!=jQuery.inArray(h,e)&&(b+=" selected "),b+=">"+g[h]+"</option>";b+="</optgroup>";}b+="</select>";var i=jQuery(b);return this.addValidationToElement(i),i}var d=this.getValue(),c=this.getPickListValues(),j=[];jQuery.each(c,function(a,b){jQuery.each(b,function(a,b){j.push(jQuery.trim(b));});});var b="<input data-tags=\"\" type=\"hidden\" class=\"row select2\" name=\""+this.getName()+"\">",i=jQuery(b).val(d);return i.data("tags",j),this.addValidationToElement(i),i}}),Vtiger_Multireferencevalue_Field_Js("AdvanceFilter_Multireferencevalue_Field_Js",{},{}),AdvanceFilter_Owner_Field_Js("AdvanceFilter_Sharedowner_Field_Js",{},{}),AdvanceFilter_Owner_Field_Js("AdvanceFilter_Usercreator_Field_Js",{},{}),Vtiger_Date_Field_Js("AdvanceFilter_Date_Field_Js",{},{getUi:function t(){var a=this.get("comparatorElementVal"),b=this.get("dateSpecificConditions");if("bw"==a||"custom"==a){var c="<div class=\"date\"><input class=\"dateRangeField form-control\" data-calendar-type=\"range\" name=\""+this.getName()+"\" data-date-format=\""+this.getDateFormat()+"\" type=\"text\" ReadOnly=\"true\" value=\""+this.getValue()+"\"></div>",d=jQuery(c),e=d.find(".dateRangeField");if(-1!==e.val().indexOf(",")){var f=this.getValue().split(","),g=f[0],h=f[1];if(-1!==g.indexOf(" ")){var i=g.split(" ");g=i[0];}if(-1!==h.indexOf(" ")){var j=h.split(" ");h=j[0];}e.val(g+","+h);}else{var k=this.getValue().split(" "),l=k[0],m=k[0];""!=l&&""!=m&&e.val(l+","+m);}return this.addValidationToElement(d)}if(a in b){var n=b[a].startdate,o=b[a].enddate;if("today"==a||"tomorrow"==a||"yesterday"==a)var c="<input name=\""+this.getName()+"\" type=\"text\" ReadOnly=\"true\" value=\""+n+"\">";else var c="<input name=\""+this.getName()+"\" type=\"text\" ReadOnly=\"true\" value=\""+n+","+o+"\">";return jQuery(c)}var p=this._super(),q=p.find(".dateField").val(),r=q.split(" ");if("00:00:00"==r[1])q=r[0];else if("e"==a||"n"==a||"b"==a||"a"==a){var s=q.split(" ");q=s[0];}return p.find(".dateField").val(q),p}}),AdvanceFilter_Date_Field_Js("AdvanceFilter_Datetime_Field_Js",{},{});
//# sourceMappingURL=AdvanceFilter.min.js.map
