'use strict';

jQuery.Class("Vtiger_RelatedList_Js",{getInstance:function h(a,b,c,d){var e=app.getModuleName()+"_RelatedList_Js",f=Vtiger_RelatedList_Js;if("undefined"!=typeof window[e])var g=new window[e];else var g=new f;return g.parentRecordId=a,g.parentModuleName=b,g.selectedRelatedTabElement=c,g.moduleName=d,g.relatedTabsContainer=c.closest("div.related"),g.content=$("div.contents",g.relatedTabsContainer.closest("div.detailViewContainer")),g.relatedView=g.content.find("input.relatedView").val(),g},triggerMassAction:function m(a,b){var c=Vtiger_List_Js.getInstance(),d=c.checkListRecordSelected();if(!0!=d){var e=jQuery.progressIndicator(),f=c.readSelectedIds(!0),g=c.readExcludedIds(!0),h=c.getCurrentCvId(),i={viewname:h,selected_ids:f,excluded_ids:g},j=Vtiger_List_Js.getInstance();if(j.getListSearchInstance()){var k=j.getListSearchInstance().getAlphabetSearchValue();i.search_params=JSON.stringify(j.getListSearchInstance().getListSearchParams()),"undefined"!=typeof k&&0<k.length&&(i.search_key=j.getListSearchInstance().getAlphabetSearchField(),i.search_value=k,i.operator="s");}if("sendByForm"===b){var l=$("<form method=\"POST\" action=\""+a+"\">");"undefined"!=typeof csrfMagicName&&l.append($("<input />",{name:csrfMagicName,value:csrfMagicToken})),$.each(i,function(a,b){l.append($("<input />",{name:a,value:b}));}),$("body").append(l),l.submit(),e.progressIndicator({mode:"hide"});}else AppConnector.request({type:"POST",url:a,data:i}).done(function(a){if(e.progressIndicator({mode:"hide"}),a&&null!==a.result&&(a.result.notify&&Vtiger_Helper_Js.showMessage(a.result.notify),a.result.reloadList&&Vtiger_Detail_Js.reloadRelatedList(),a.result.procesStop))return e.progressIndicator({mode:"hide"}),!1}).fail(function(){e.progressIndicator({mode:"hide"});});}else c.noRecordSelectedAlert();}},{selectedRelatedTabElement:!1,parentRecordId:!1,parentModuleName:!1,moduleName:!1,relatedTabsContainer:!1,content:!1,listSearchInstance:!1,detailViewContentHolder:!1,relatedView:!1,frameProgress:!1,setSelectedTabElement:function b(a){this.selectedRelatedTabElement=a;},getSelectedTabElement:function a(){return this.selectedRelatedTabElement},getParentId:function a(){return this.parentRecordId},getRelatedContainer:function a(){return this.content},setRelatedContainer:function b(a){this.content=a,this.relatedView=a.find("input.relatedView").val();},getContentHolder:function a(){return !1==this.detailViewContentHolder&&(this.detailViewContentHolder=$("div.details div.contents")),this.detailViewContentHolder},getCurrentPageNum:function a(){return $("input[name=\"currentPageNum\"]",this.content).val()},setCurrentPageNumber:function b(a){$("input[name=\"currentPageNum\"]",this.content).val(a);},getOrderBy:function a(){return $("#orderBy",this.content).val()},getSortOrder:function a(){return $("#sortOrder",this.content).val()},getCompleteParams:function e(){var a=this.getRelatedContainer(),b={view:"Detail",module:this.parentModuleName,record:this.getParentId(),relatedModule:this.moduleName,sortorder:this.getSortOrder(),orderby:this.getOrderBy(),page:this.getCurrentPageNum(),relatedView:this.relatedView,mode:"showRelatedList"};if(a.find(".pagination").length&&(b.totalCount=a.find(".pagination").data("totalCount")),a.find(".entityState").length&&(b.entityState=a.find(".entityState").val()),this.listSearchInstance){var c=this.listSearchInstance.getAlphabetSearchValue();b.search_params=JSON.stringify(this.listSearchInstance.getListSearchParams());}if("undefined"!=typeof c&&0<c.length&&(b.search_key=this.listSearchInstance.getAlphabetSearchField(),b.search_value=c,b.operator="s"),"Calendar"==this.moduleName){var d=a.find(".js-switch--calendar");d.length&&(b.time=d.first().prop("checked")?"current":"history");}return b},loadRelatedList:function h(a){var b=jQuery.Deferred(),c=this;if("undefined"==typeof c.moduleName||0>=c.moduleName.length){var d=Vtiger_Detail_Js.getInstance();return d.loadWidgets(),b.promise()}var e=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),f=this.getCompleteParams(),g=c.relatedTabsContainer.find("li.active").data("reference");return AppConnector.request($.extend(f,a)).done(function(a){var d=Vtiger_Detail_Js.getInstance();d.loadWidgets(),e.progressIndicator({mode:"hide"}),"ProductsAndServices"!==g&&(c.relatedTabsContainer.find("li").removeClass("active"),c.selectedRelatedTabElement.addClass("active"),c.content.html(a),$(".pageNumbers",c.content).tooltip(),c.registerPostLoadEvents(),c.registerListEvents(),c.listSearchInstance&&c.listSearchInstance.registerBasicEvents()),b.resolve(a);}).fail(function(a,c){b.reject(a,c),e.progressIndicator({mode:"hide"});}),b.promise()},triggerDisplayTypeEvent:function c(){var a=app.cacheGet("widthType","narrowWidthType");if(a){var b=this.content.find(".listViewEntriesTable").find("td,th");b.attr("class",a);}},showSelectRelation:function d(a){var b=this,c=$.extend(this.getRecordsListParams(),a);app.showRecordsList(c,function(a,d){d.setSelectEvent(function(a){b.addRelations(Object.keys(a)).done(function(){app.event.trigger("RelatedListView.AfterSelectRelation",a,b,d,c);var e=Vtiger_Detail_Js.getInstance();b.loadRelatedList().done(function(){e.registerRelatedModulesRecordCount();}),"LBL_RECORD_SUMMARY"===b.getSelectedTabElement().data("link-key")&&(e.loadWidgets(),e.registerRelatedModulesRecordCount());});});});},getRecordsListParams:function a(){return {module:this.moduleName,src_module:this.parentModuleName,src_record:this.parentRecordId,multi_select:!0}},addRelations:function c(a){var b=jQuery.Deferred();return AppConnector.request({module:this.parentModuleName,action:"RelationAjax",mode:"addRelation",related_module:this.moduleName,src_record:this.parentRecordId,related_record_list:$.isArray(a)?JSON.stringify(a):a}).done(function(a){b.resolve(a);}).fail(function(a,c){b.reject(a,c);}),b.promise()},deleteRelation:function c(a){var b=jQuery.Deferred();return AppConnector.request({module:this.parentModuleName,action:"RelationAjax",mode:"deleteRelation",related_module:this.moduleName,src_record:this.parentRecordId,related_record_list:JSON.stringify(a)}).done(function(a){b.resolve(a);}).fail(function(a,c){b.reject(a,c);}),b.promise()},sortHandler:function d(a){var b=jQuery.Deferred(),c=a.data("nextsortorderval");if("undefined"!=typeof c)return this.loadRelatedList({orderby:a.data("fieldname"),sortorder:c}).done(function(a){b.resolve(a);}).fail(function(a,c){b.reject(a,c);}),b.promise()},nextPageHandler:function g(){var a=jQuery.Deferred(),b=this,c=jQuery("#pageLimit",this.content).val(),d=jQuery("#noOfEntries",this.content).val();if(d==c){var e=this.getCurrentPageNum(),f=parseInt(e)+1;this.loadRelatedList({page:f}).done(function(c){b.setCurrentPageNumber(f),a.resolve(c);}).fail(function(b,c){a.reject(b,c);});}return a.promise()},previousPageHandler:function e(){var a=jQuery.Deferred(),b=this,a=jQuery.Deferred(),c=this.getCurrentPageNum();if(1<c){var d=parseInt(c)-1;this.loadRelatedList({page:d}).done(function(c){b.setCurrentPageNumber(d),a.resolve(c);}).fail(function(b,c){a.reject(b,c);});}return a.promise()},selectPageHandler:function d(a){var b=jQuery.Deferred(),c=this,b=jQuery.Deferred();return this.loadRelatedList({page:a}).done(function(d){c.setCurrentPageNumber(a),b.resolve(d);}).fail(function(a,c){b.reject(a,c);}),b.promise()},pageJumpHandler:function l(a){var b=jQuery.Deferred(),c=this;if(13==a.which){var d=jQuery(a.currentTarget),e=Vtiger_WholeNumberGreaterThanZero_Validator_Js.invokeValidation(d);if("undefined"!=typeof e)d.validationEngine("showPrompt",e,"","topLeft",!0),a.preventDefault();else{d.validationEngine("hideAll");var f=parseInt(d.val()),g=parseInt(jQuery("#totalPageCount",c.content).text());if(f>g){var h=app.vtranslate("JS_PAGE_NOT_EXIST");d.validationEngine("showPrompt",h,"","topLeft",!0);}var i=d.parent().find(".formError");if(1>i.length){var j=jQuery("input[name=\"currentPageNum\"]",c.content).val();if(f==j){var k=app.vtranslate("JS_YOU_ARE_IN_PAGE_NUMBER")+" "+f;return Vtiger_Helper_Js.showMessage({text:k,type:"info"}),a.preventDefault(),!1}this.loadRelatedList({page:f}).done(function(a){c.setCurrentPageNumber(f),b.resolve(a);}).fail(function(a,c){b.reject(a,c);});}else a.preventDefault();}}return b.promise()},addRelatedRecord:function t(a,b){var c=jQuery.Deferred(),d=this,e=this.moduleName,f=this.getParentId(),g=this.parentModuleName,h={},i={},j=a.data("name"),k=a.data("url");i[j]=f;var l=new Array("view","module","mode","action"),m=function(a){var c,d,e;if("undefined"!=typeof k&&-1!==k.indexOf("?")){var h=k.split("?"),i=h[1],m=i.split("&");for(c=0;c<m.length;c++)d=m[c],e=d.split("="),"mode"==e[0]&&"Calendar"==e[1]&&a.find("a[data-tab-name=\"Task\"]").trigger("click");}if(jQuery("<input type=\"hidden\" name=\"sourceModule\" value=\""+g+"\" />").appendTo(a),jQuery("<input type=\"hidden\" name=\"sourceRecord\" value=\""+f+"\" />").appendTo(a),jQuery("<input type=\"hidden\" name=\"relationOperation\" value=\"true\" />").appendTo(a),"undefined"!=typeof j){var n=a.find("[name=\""+j+"\"]");0==n.length&&jQuery("<input type=\"hidden\" name=\""+j+"\" value=\""+f+"\" />").appendTo(a);}for(c=0;c<m.length;c++)d=m[c],e=d.split("="),"-1"==jQuery.inArray(e[0],l)&&0==a.find("[name=\""+e[0]+"\"]").length&&jQuery("<input type=\"hidden\" name=\""+e[0]+"\" value=\""+e[1]+"\" />").appendTo(a);"undefined"!=typeof b&&b();};if("undefined"!=typeof k&&-1!==k.indexOf("?"))for(var n=k.split("?"),o=n[1],p=o.split("&"),q=0;q<p.length;q++){var r=p[q],s=r.split("=");"-1"==jQuery.inArray(s[0],l)&&(i[s[0]]=s[1]);}return h.data=i,h.callbackFunction=function a(){d.loadRelatedList().done(function(a){c.resolve(a);});},h.callbackPostShown=m,h.noCache=!0,Vtiger_Header_Js.getInstance().quickCreateModule(e,h),c.promise()},getRelatedPageCount:function e(){var a=jQuery.Deferred(),b=this.content.find("#totalPageCount"),c=this.content.find("#totalCount"),d=b.text();return ""==d?(b.progressIndicator({}),AppConnector.request({module:this.parentModuleName,action:"RelationAjax",mode:"getRelatedListPageCount",record:this.getParentId(),relatedModule:this.moduleName}).done(function(d){var e=d.result.page,f=d.result.numberOfRecords;c.val(f),b.text(e),b.progressIndicator({mode:"hide"}),a.resolve();}).fail(function(){a.reject(!1);})):a.resolve(),a.promise()},favoritesRelation:function d(a,b){var c=jQuery.Deferred();return a?AppConnector.request({module:this.parentModuleName,action:"RelationAjax",mode:"updateFavoriteForRecord",record:this.getParentId(),relcrmid:a,relatedModule:this.moduleName,actionMode:b?"delete":"add"}).done(function(a){a.result&&c.resolve(!0);}).fail(function(){c.reject(!1);}):c.reject(!1),c.promise()},updatePreview:function d(a){var b=this.content.find(".listPreviewframe");this.frameProgress=$.progressIndicator({position:"html",message:app.vtranslate("JS_FRAME_IN_PROGRESS"),blockInfo:{enabled:!0}});var c="";app.getMainParams("defaultDetailViewName")&&(c=c+"&mode=showDetailViewByMode&requestMode="+app.getMainParams("defaultDetailViewName")),b.attr("src",a.replace("view=Detail","view=DetailPreview")+c);},registerUnreviewedCountEvent:function d(){var a=[],b=this.content,c=b.find(".unreviewed").length;b.find("tr.listViewEntries").each(function(){var b=jQuery(this).data("id");b&&a.push(b);});1>c||AppConnector.request({action:"ChangesReviewedOn",mode:"getUnreviewed",module:"ModTracker",sourceModule:this.moduleName,recordsId:a}).done(function(a){var c=a.result;$.each(c,function(a,c){0<c.a&&b.find("tr[data-id=\""+a+"\"] .unreviewed .badge.all").text(c.a).parent().removeClass("d-none"),0<c.m&&b.find("tr[data-id=\""+a+"\"] .unreviewed .badge.mail").text(c.m).parent().removeClass("d-none");});});},registerChangeEntityStateEvent:function c(){var a=this,b=this.content;b.on("click",".dropdownEntityState a",function(){var c=$(this);b.find(".entityState").val(c.data("value")),b.find(".pagination").data("totalCount",0),b.find(".dropdownEntityState button").find("span").attr("class",c.find("span").attr("class")),a.loadRelatedList({page:1});});},registerRowsEvent:function b(){var a=this;"List"===this.relatedView||"Detail"===this.relatedView?(this.content.find(".listViewEntries").on("click",function(a){$(a.target).is("td")&&("DetailPreview"==app.getViewName()?top.document.location.href=$(a.target).closest("tr").data("recordurl"):document.location.href=$(a.target).closest("tr").data("recordurl"));}),this.content.find(".showInventoryRow").on("click",function(){var a=$(this),b=a.closest("tr"),c=b.next();c.hasClass("listViewInventoryEntries")&&c.toggleClass("d-none");})):"ListPreview"===this.relatedView&&this.content.find(".listViewEntries").on("click",function(b){var c=$(b.target);if(!c.closest("div").hasClass("actions")&&!(c.is("button")||c.parent().is("button"))&&!c.closest("a").hasClass("noLinkBtn")&&!$(b.target,$(b.currentTarget)).is("td:first-child")&&!c.is("input[type=\"checkbox\"]")&&!$.contains($(b.currentTarget).find("td:last-child").get(0),c[0])&&!$.contains($(b.currentTarget).find("td:first-child").get(0),c[0])){var d=$(this).data("recordurl");a.content.find(".listViewEntriesTable .listViewEntries").removeClass("active"),$(this).addClass("active"),a.updatePreview(d);}});},registerSummationEvent:function b(){var a=this;this.content.on("click",".listViewSummation button",function(){var b=$(this),c=b.closest("td").find(".calculateValue"),d=a.getCompleteParams();d.action="RelationAjax",d.mode="calculate",d.fieldName=b.data("field"),d.calculateType=b.data("operator"),delete d.view;var e=$.progressIndicator({message:app.vtranslate("JS_CALCULATING_IN_PROGRESS"),position:"html",blockInfo:{enabled:!0}});app.hidePopover(b),AppConnector.request(d).done(function(a){a.success?c.html(a.result):c.html(""),e.progressIndicator({mode:"hide"});}),e.progressIndicator({mode:"hide"});});},registerPreviewEvent:function c(){var a=this,b=this.content.find(".js-detail-preview,.js-list-preview");b.height(app.getScreenHeight()-(this.content.offset().top+$(".js-footer").height())),this.content.find(".listPreviewframe").on("load",function(){a.frameProgress&&a.frameProgress.progressIndicator({mode:"hide"}),b.height($(this).contents().find(".bodyContents").height()+2);}),this.content.find(".listViewEntriesTable .listViewEntries").first().trigger("click");},registerPaginationEvents:function c(){var a=this,b=this.content;this.content.on("click","#relatedViewNextPageButton",function(){$(this).hasClass("disabled")||a.nextPageHandler();}),this.content.on("click","#relatedViewPreviousPageButton",function(){a.previousPageHandler();}),this.content.on("click","#relatedListPageJump",function(){a.getRelatedPageCount();}),this.content.on("click","#relatedListPageJumpDropDown > li",function(a){a.stopImmediatePropagation();}).on("keypress","#pageToJump",function(b){a.pageJumpHandler(b);}),this.content.on("click",".pageNumber",function(){return !$(this).hasClass("disabled")&&void a.selectPageHandler($(this).data("id"))}),this.content.on("click","#totalCountBtn",function(){app.hidePopover($(this));var c={module:a.parentModuleName,view:"Pagination",mode:"getRelationPagination",record:a.getParentId(),relatedModule:a.moduleName,noOfEntries:$("#noOfEntries",b).val(),page:b.find("[name=\"currentPageNum\"]").val()};b.find(".entityState").length&&(c.entityState=b.find(".entityState").val()),AppConnector.request(c).done(function(a){b.find(".paginationDiv").html(a);});});},registerListEvents:function c(){var a=this.content,b=this;this.content.on("click",".relatedListHeaderValues",function(){b.sortHandler($(this));}),this.content.find("a.favorites").on("click",function(){var a=jQuery.progressIndicator({position:"html",blockInfo:{enabled:!0}}),c=$(this),d=c.closest("tr");b.favoritesRelation(d.data("id"),c.data("state")).done(function(b){if(b){var d=c.data("state")?0:1;c.data("state",d),c.find("[data-fa-i2svg]").each(function(){jQuery(this).hasClass("d-none")?jQuery(this).removeClass("d-none"):jQuery(this).addClass("d-none");}),a.progressIndicator({mode:"hide"});var e=app.vtranslate("JS_REMOVED_FROM_FAVORITES");d&&(e=app.vtranslate("JS_ADDED_TO_FAVORITES")),Vtiger_Helper_Js.showPnotify({text:e,type:"success"});}});}),this.content.find("[name=\"addButton\"]").on("click",function(){var a=$(this);return !0===a.hasClass("quickCreateSupported")?void b.addRelatedRecord(a):void(window.location.href=a.data("url"))}),this.content.find("button.selectRelation").on("click",function(){var a=$(this).data("rf"),c={};a&&0<Object.keys(a).length&&(c={search_key:a.key,search_value:a.name}),b.showSelectRelation(c);}),this.content.find("button.relationDelete").on("click",function(a){a.stopImmediatePropagation();var c=$(this);Vtiger_Helper_Js.showConfirmationBox({message:app.vtranslate("JS_DELETE_CONFIRMATION")}).done(function(){var a=c.closest("tr");b.deleteRelation([a.data("id")]).done(function(a){if(a.result){var d=c.closest(".widgetContentBlock"),e=Vtiger_Detail_Js.getInstance();if(d.length){e.loadWidget(d);var f=b.getContentHolder().find("[data-type='Updates']");0<f.length&&e.loadWidget(f);}else b.loadRelatedList();e.registerRelatedModulesRecordCount();}else Vtiger_Helper_Js.showPnotify(app.vtranslate("JS_CANNOT_REMOVE_RELATION"));});});}),this.content.find(".js-switch--calendar").on("change",function(){b.loadRelatedList();}),this.content.find(".relatedViewGroup a").on("click",function(){var c=$(this);b.relatedView=c.data("view"),a.find(".pagination").data("totalCount",0),b.loadRelatedList({page:1});});},registerPostLoadEvents:function b(){var a=this;if(app.showPopoverElementView(this.content.find(".js-popover-tooltip")),this.registerRowsEvent(),this.registerListScroll(),"ListPreview"===this.relatedView&&(this.registerPreviewEvent(),!this.content.find(".gutter").length)){if(!this.content.find(".js-list-preview").length)return;this.getDomParams(this.content),this.toggleSplit(this.content),this.registerListPreviewEvents(this.content);}this.listSearchInstance=YetiForce_ListSearch_Js.getInstance(this.content,!1,this),app.event.trigger("RelatedList.AfterLoad",a);},getSecondColMinWidth:function d(a){var b,c;return a.find(".js-list__row").each(function(a){c=$(this).find(".js-list__field").first().width(),0===a?b=c:c>b?b=c:b;}),b},getDomParams:function b(a){this.listColumnFirstWidth=a.find(".listViewEntriesDiv .listViewHeaders th").first().width(),this.listColumnSecondWidth=this.getSecondColMinWidth(a),this.windowW=$(window).width(),this.mainBody=a.closest(".mainBody"),this.windowMinWidth=100*(15/this.windowW),this.windowMaxWidth=100-this.minWidth,this.sideBlocks=a.find(".js-side-block"),this.sideBlockLeft=this.sideBlocks.first(),this.sideBlockRight=this.sideBlocks.last(),this.list=a.find(".js-list-preview"),this.preview=a.find(".js-detail-preview"),this.rotatedText=a.find(".u-rotate-90"),this.footerH=$(".js-footer").outerHeight(),this.headerH=$(".js-header").outerHeight();},getDefaultSplitSizes:function b(){var a=100*((this.listColumnFirstWidth+this.listColumnSecondWidth+82)/this.windowW);return [a,100-a]},getSplitSizes:function b(){var a=app.moduleCacheGet("userRelatedSplitSet");return null===a?this.getDefaultSplitSizes():a},registerListPreviewEvents:function j(a){var b=this,c=a.find(".js-detail-preview"),d=a.closest(".mainBody");app.showNewScrollbarTopBottom(a.find(".js-list-preview--scroll")),app.showNewScrollbarLeft(this.list);var e=this.list.offset().top-this.headerH,f=this.sideBlocks.height(),g={height:d.height()},h={width:d.height()};this.gutter.addClass("js-fixed-scroll");var i=a.find(".js-fixed-scroll");if(!d.length){d=$(top.document).find(".mainBody"),this.headerH=$(top.document).find(".js-header").outerHeight();var k=$(top.document).find(".js-detail-preview");e=this.list.offset().top+k.offset().top-this.headerH+1,g={height:d.height()},h={width:d.height()};}this.list.on("click",".listViewEntries",function(){if(10>b.split.getSizes()[1]){var a=b.getDefaultSplitSizes();b.split.setSizes(a),c.show(),b.sideBlockRight.removeClass("d-block"),app.moduleCacheSet("userRelatedSplitSet",a);}});this.list.parents(".blockContent").length||d.on("scroll",function(){d.scrollTop()>=e?(i.css({top:d.scrollTop()-e}),b.sideBlocks.css({top:d.scrollTop()-e+56}),i.css(g),b.rotatedText.css(g),b.rotatedText.css(h)):(i.css({top:"initial"}),i.css({height:f+d.scrollTop()}),b.rotatedText.css({width:f+d.scrollTop(),height:f+d.scrollTop()}));});},registerSplitEvents:function h(a,b){var c=this,d=100*(400/this.windowW),e=100*(23/this.windowW),f=100-e,g=a.find(".js-detail-preview");this.gutter.on("dblclick",function(){var a=app.moduleCacheGet("gutterRelatedMidPosition");isNaN(c.split.getSizes()[0])&&c.split.setSizes(a),7>b.getSizes()[0]?(c.gutter.removeClass("js-gutter-corr-left"),c.sideBlockLeft.removeClass("d-block"),c.list.removeClass("u-hide-underneath"),11<a[0]?b.setSizes(a):b.setSizes(c.getDefaultSplitSizes())):20>b.getSizes()[1]?(a[1]>d+1?b.setSizes(a):b.setSizes(c.getDefaultSplitSizes()),c.gutter.removeClass("js-gutter-corr-right"),c.sideBlockRight.removeClass("d-block"),g.show()):7<b.getSizes()[0]&&50>b.getSizes()[0]?(b.setSizes([e,f]),c.gutter.addClass("js-gutter-corr-left"),c.sideBlockLeft.addClass("d-block"),c.list.addClass("u-hide-underneath")):10<b.getSizes()[1]&&50>b.getSizes()[1]&&(b.setSizes([f,e]),c.gutter.addClass("js-gutter-corr-right"),c.sideBlockRight.addClass("d-block"),g.hide()),app.moduleCacheSet("userRelatedSplitSet",b.getSizes());}),this.sideBlockLeft.on("click",function(){var a=app.moduleCacheGet("gutterRelatedMidPosition");11<a[0]?b.setSizes(a):b.setSizes(c.getDefaultSplitSizes()),c.gutter.removeClass("js-gutter-corr-left"),c.sideBlockLeft.removeClass("d-block"),c.list.removeClass("u-hide-underneath"),app.moduleCacheSet("userRelatedSplitSet",b.getSizes());}),this.sideBlockRight.on("click",function(){var a=app.moduleCacheGet("gutterRelatedMidPosition");a[1]>d+1?b.setSizes(a):b.setSizes(c.getDefaultSplitSizes()),c.gutter.removeClass("js-gutter-corr-right"),c.sideBlockRight.removeClass("d-block"),g.show(),app.moduleCacheSet("userRelatedSplitSet",b.getSizes());});},registerSplit:function i(a){var b=this,c=100*(400/this.windowW),d=this.getSplitSizes();app.moduleCacheSet("gutterRelatedMidPosition",d);var e=Split([this.list[0],this.preview[0]],{sizes:d,minSize:10,gutterSize:24,snapOffset:100,onDrag:function a(){e.getSizes()[1]<c&&e.collapse(1),7>e.getSizes()[0]?(b.sideBlockLeft.addClass("d-block"),b.list.addClass("u-hide-underneath")):(b.gutter.removeClass("js-gutter-corr-left"),b.sideBlockLeft.removeClass("d-block"),b.list.removeClass("u-hide-underneath")),10>e.getSizes()[1]?(b.sideBlockRight.addClass("d-block"),b.preview.hide(),b.list.width(b.list.width()-10)):(b.gutter.removeClass("js-gutter-corr-right"),b.sideBlockRight.removeClass("d-block"),b.preview.show()),10<e.getSizes()[0]&&e.getSizes()[1]>c&&app.moduleCacheSet("gutterRelatedMidPosition",e.getSizes()),app.moduleCacheSet("userRelatedSplitSet",e.getSizes());}});this.gutter=a.find(".gutter"),10>d[0]?(this.gutter.addClass("js-gutter-corr-left"),this.sideBlockLeft.addClass("d-block"),this.list.addClass("u-hide-underneath")):d[1]<c&&(this.gutter.addClass("js-gutter-corr-right"),this.sideBlockRight.addClass("d-block"),this.preview.hide());var f={height:$(window).height()-this.list.offset().top-this.footerH};if(!a.closest(".mainBody").length){var g=$(top.document).find(".mainBody").height(),h=$(top.document).find(".js-detail-preview");f={height:g-this.list.offset().top-h.offset().top+50};}return this.list.parents(".blockContent").length||(this.gutter.css(f),this.list.css(f),this.sideBlocks.css(f),this.rotatedText.css({width:this.sideBlockLeft.height(),height:this.sideBlockLeft.height()})),this.registerSplitEvents(a,e),e},toggleSplit:function e(a){var b=this,c=a.closest(".commonActionsContainer").height(),d=[];this.split=this.registerSplit(a),d.push(this.split),$(window).on("resize",function(){if(993>$(window).width())a.find(".gutter").length&&(d[d.length-1].destroy(),b.sideBlockRight.removeClass("d-block"),b.sideBlockLeft.removeClass("d-block"));else{if(1!==a.find(".gutter").length){b.split=b.registerSplit(a);var e=a.find(".gutter");b.mainBody.scrollTop()>=b.list.offset().top+c&&(e.addClass("gutterOnScroll"),e.css("left",b.preview.offset().left-8),e.on("mousedown",function(){$(this).on("mousemove",function(){$(this).css("left",this.preview.offset().left-8);});})),d.push(b.split);}var f=d[d.length-1],g=100*(15/$(window).width()),h=100-g;if("undefined"==typeof f)return;f.getSizes()[0]<g+5?f.setSizes([g,h]):f.getSizes()[1]<g+5&&f.setSizes([h,g]);}});},registerListScroll:function b(){var a=$(".listViewEntriesDiv");"ListPreview"!==this.relatedView&&app.showNewScrollbarTopBottomRight(a);},registerRelatedEvents:function a(){this.getRelatedContainer();this.registerUnreviewedCountEvent(),this.registerChangeEntityStateEvent(),this.registerPaginationEvents(),this.registerListEvents(),this.registerPostLoadEvents(),this.registerSummationEvent();}});
//# sourceMappingURL=RelatedList.min.js.map
