'use strict';

(/MSIE 6.0/.test(navigator.userAgent)||/MSIE 7.0/.test(navigator.userAgent)||/MSIE 8.0/.test(navigator.userAgent)||/MSIE 9.0/.test(navigator.userAgent))&&'true'!=app.getCookie('oldbrowser')&&(app.setCookie('oldbrowser',!0,365),window.location.href='layouts/basic/modules/Vtiger/browsercompatibility/Browser_compatibility.html'),$.Class('Vtiger_Header_Js',{quickCreateModuleCache:{},self:!1,getInstance:function a(){return !1==this.self?(this.self=new Vtiger_Header_Js,this.self):this.self}},{menuContainer:!1,contentContainer:!1,quickCreateCallBacks:[],init:function a(){this.setContentsContainer('.js-base-container');},setContentsContainer:function b(a){return this.contentContainer=a instanceof $?a:$(a),this},getContentsContainer:function a(){return this.contentContainer},getQuickCreateForm:function g(a,b,c){var d,f=$.Deferred();if('undefined'==typeof c&&(c={}),(!c.noCache||'undefined'==typeof c.noCache)&&'undefined'!=typeof Vtiger_Header_Js.quickCreateModuleCache[b])return f.resolve(Vtiger_Header_Js.quickCreateModuleCache[b]),f.promise();if(d=a,'undefined'!=typeof c.data)var d={data:c.data,url:a};return AppConnector.request(d).done(function(a){c.noCache&&'undefined'!=typeof c.noCache||(Vtiger_Header_Js.quickCreateModuleCache[b]=a),f.resolve(a);}),f.promise()},registerQuickCreateCallBack:function b(a){return !('function'!=typeof a)&&(this.quickCreateCallBacks.push(a),!0)},quickCreateSave:function d(a){var b=$.Deferred(),c=a.serializeFormData();return AppConnector.request(c).done(function(a){b.resolve(a);},function(a,c){b.reject(a,c);}),b.promise()},quickCreateGoToFullForm:function b(a){a.find('input[name="action"]').remove(),a.append('<input type="hidden" name="view" value="Edit" />'),$.each(a.find('[data-validation-engine]'),function(a,b){$(b).removeAttr('data-validation-engine');}),a.addClass('not_validation'),a.submit();},showAnnouncement:function f(){var a=this,b=$('#announcements'),c=b.find('.announcement');if(0<c.length){var d=c.first(),e=d.data('id');app.showModalWindow(d.find('.modal'),function(b){d.remove(),b.find('button').on('click',function(){AppConnector.request({module:'Announcements',action:'BasicAjax',mode:'mark',record:e,type:$(this).data('type')}).done(function(){app.hideModalWindow(),a.showAnnouncement();});});},'',{backdrop:'static'});}},registerAnnouncements:function c(){var a=this,b=$('#announcements');return 0!=b.length&&void a.showAnnouncement()},registerCalendarButtonClickEvent:function e(){var a=$('#calendarBtn'),b=a.data('dateFormat'),c=a.data('date'),d=app.convertToDatePickerFormat(b);a.on('click',function(b){b.stopImmediatePropagation(),a.closest('div.nav').find('div.open').removeClass('open');var c=$('#'+a.data('datepickerId'));$(c).is(':visible')?a.DatePickerHide():a.DatePickerShow();}),a.DatePicker({format:d,date:c,calendars:1,starts:1,className:'globalCalendar'});},registerHelpInfo:function b(a){'undefined'==typeof a&&(a=$('form[name="QuickCreate"]')),app.showPopoverElementView(a.find('.js-help-info'));},handleQuickCreateData:function d(a,b){'undefined'==typeof b&&(b={});var c=this;app.showModalWindow(a,function(a){var d=a.find('form[name="QuickCreate"]'),e=d.find('[name="module"]').val(),f=Vtiger_Edit_Js.getInstanceByModuleName(e);f.registerBasicEvents(d),c.registerChangeNearCalendarEvent(d,e),d.validationEngine(app.validationEngineOptions),'undefined'!=typeof b.callbackPostShown&&b.callbackPostShown(d),c.registerQuickCreatePostLoadEvents(d,b),c.registerHelpInfo(d);});},isFreeDay:function b(a){return !(0!=a&&6!=a)},getNearCalendarEvent:function g(a,b){var c=this,d=a.find('[name="date_start"]').val();if('undefined'!=typeof d&&''!==d){var e={module:b,view:'QuickCreateEvents',currentDate:d,user:a.find('[name="assigned_user_id"]').val()},f=$.progressIndicator({position:'html',blockInfo:{enabled:!0,elementToBlock:a.find('.eventsTable')}});AppConnector.request(e).done(function(b){f.progressIndicator({mode:'hide'}),a.find('.eventsTable').html(b),c.registerHelpInfo(a);});}},registerChangeNearCalendarEvent:function g(a,b){var c=this;if(a&&'Calendar'==b&&'undefined'!=typeof b&&a.find('.eventsTable').length){var d=a.find('[name="assigned_user_id"]'),f=a.find('[name="date_start"]'),e=a.find('[name="due_date"]');d.on('change',function(a){var d=$(a.currentTarget),e=d.closest('form');c.getNearCalendarEvent(e,b);}),f.on('change',function(a){var d=$(a.currentTarget),e=d.closest('form');c.getNearCalendarEvent(e,b);}),a.find('ul li a').on('click',function(a){var d=$(a.currentTarget),e=d.closest('form');e.find('.addedNearCalendarEvent').remove(),c.getNearCalendarEvent(e,b);}),a.on('click','.nextDayBtn',function(){var d=a.find('[name="date_start"]'),f=d.val(),g=d.data('date-format');f=moment(Vtiger_Helper_Js.convertToDateString(f,g,'+7',' ')).format(g.toUpperCase()),d.val(f),e.val(f),c.getNearCalendarEvent(a,b);}),a.on('click','.previousDayBtn',function(){var d=a.find('[name="date_start"]'),f=d.val(),g=d.data('date-format');f=moment(Vtiger_Helper_Js.convertToDateString(f,g,'-7',' ')).format(g.toUpperCase()),d.val(f),e.val(f),c.getNearCalendarEvent(a,b);}),a.on('click','.dateBtn',function(b){var c=$(b.currentTarget);f.val(c.data('date')),a.find('[name="due_date"]').val(c.data('date')),a.find('[name="date_start"]').trigger('change');}),c.getNearCalendarEvent(a,b);}},registerQuickCreatePostLoadEvents:function e(a,b){var c=this,d=b.callbackFunction,f=b.goToFullFormcallback;'undefined'==typeof d&&(d=function(){}),a.on('submit',function(a){var b=$(a.currentTarget);if(b.hasClass('not_validation'))return !0;var e=b.find('[name="module"]').val();if('undefined'!=typeof b.data('submit'))return !1;var f=b.data('jqv').InvalidFields;if(0<f.length)return b.removeData('submit'),$.progressIndicator({mode:'hide'}),void a.preventDefault();b.data('submit','true'),$.progressIndicator({mode:'hide'});var g=$.Event(Vtiger_Edit_Js.recordPreSave);if(b.trigger(g,{value:'edit',module:e}),!g.isDefaultPrevented()){var h=c,i=Vtiger_Edit_Js.getInstanceByModuleName(e);'function'==typeof i.quickCreateSave&&(h=i),h.quickCreateSave(b).done(function(a){app.hideModalWindow();var f=app.getModuleName(),g=app.getViewName();if(e==f&&'List'==g){var h=new Vtiger_List_Js;h.getListViewRecords();}d(a);for(var i,j=c.quickCreateCallBacks,k=0;k<j.length;k++)i=j[k],i({data:a,name:b.find('[name="module"]').val()});app.event.trigger('QuickCreate.AfterSaveFinal',a,b),$.progressIndicator({mode:'hide'});});}else b.removeData('submit'),$.progressIndicator({mode:'hide'});a.preventDefault();}),a.find('#goToFullForm').on('click',function(a){var b=$(a.currentTarget).closest('form'),d=$(a.currentTarget).data('editViewUrl');'undefined'!=typeof f&&f(b),c.quickCreateGoToFullForm(b,d);}),this.registerTabEventsInQuickCreate(a);},registerTabEventsInQuickCreate:function e(a){var b=a.find('.nav.nav-pills , .nav.nav-tabs').find('a'),c=function(a){var b=$(a);b.find('[name]').each(function(a,b){b=$(b),b.attr('data-element-name',b.attr('name')).removeAttr('name');});},d=function(a){var b=$(a);b.find('[data-element-name]').each(function(a,b){b=$(b),b.attr('name',b.attr('data-element-name')).removeAttr('data-element-name');});};b.on('click',function(){c(b.not('[aria-expanded="false"]').attr('data-target')),d($(this).attr('data-target')),a.data('jqv').InvalidFields=[];}),b.filter('a:not(.active)').each(function(){c($(this).attr('data-target'));});},basicSearch:function b(){var a=this;$('.js-global-search__value').on('keypress',function(b){var c=$(b.currentTarget);13==b.which&&(a.hideSearchMenu(),a.labelSearch(c));}),$('.js-global-search-operator').on('click',function(a){var b=$(a.target),c=b.closest('.js-global-search__input');c.find('.js-global-search__value').data('operator',b.data('operator')),c.find('.js-global-search-operator .dropdown-item').removeClass('active'),b.closest('.dropdown-item').addClass('active');}),1==$('#gsAutocomplete').val()&&($.widget('custom.gsAutocomplete',$.ui.autocomplete,{_create:function a(){this._super(),this.widget().menu('option','items','> :not(.ui-autocomplete-category)');},_renderMenu:function e(a,b){var c=this,d='';$.each(b,function(b,e){e.category!=d&&(a.append('<li class=\'ui-autocomplete-category\'>'+e.category+'</li>'),d=e.category),c._renderItemData(a,e);});},_renderItemData:function c(a,b){return this._renderItem(a,b).data('ui-autocomplete-item',b)},_renderItem:function d(a,b){var c='index.php?module='+b.module+'&view=Detail&record='+b.id;return $('<li>').data('item.autocomplete',b).append($('<a href=\''+c+'\'></a>').html(b.label)).appendTo(a)}}),$('.js-global-search__value').gsAutocomplete({minLength:app.getMainParams('gsMinLength'),source:function d(a,b){var c=new Vtiger_BasicSearch_Js;c.reduceNumberResults=app.getMainParams('gsAmountResponse'),c.returnHtml=!1,c.setMainContainer(this.element.closest('.js-global-search__input')),c.search(a.term).done(function(a){var a=JSON.parse(a),c=a.result,d=[];for(var e in c){var f=c[e];d.push(f);}b(d);});},select:function e(a,b){var c=b.item;if(c.permitted){var d='index.php?module='+c.module+'&view=Detail&record='+c.id;window.location.href=d;}return !1},close:function a(){}}));},labelSearch:function e(a){var b=a.val();if(''==b)return alert(app.vtranslate('JS_PLEASE_ENTER_SOME_VALUE')),a.focus(),!1;var c=$.progressIndicator({position:'html',blockInfo:{enabled:!0}}),d=new Vtiger_BasicSearch_Js;d.setMainContainer(a.closest('.js-global-search__input')),d.search(b).done(function(a){d.showSearchResults(a),c.progressIndicator({mode:'hide'});});},registerHotKeys:function a(){$('.hotKey').each(function(){var a=this,b=$(a).data('hotkeys');''!=b&&Mousetrap.bind(b,function(){a.click();});});},quickCreateModule:function f(a,b){if(window!==window.parent)return void window.parent.Vtiger_Header_Js.getInstance().quickCreateModule(a,b);var c=this;'undefined'==typeof b&&(b={}),'undefined'==typeof b.callbackFunction&&(b.callbackFunction=function(){});var d='index.php?module='+a+'&view=QuickCreateAjax';('Detail'===app.getViewName()||'Edit'===app.getViewName())&&'Settings'!=app.getParentModuleName()&&(d+='&sourceModule='+app.getModuleName(),d+='&sourceRecord='+app.getRecordId());var e=$.progressIndicator();c.getQuickCreateForm(d,a,b).done(function(a){c.handleQuickCreateData(a,b),app.registerEventForClockPicker(),e.progressIndicator({mode:'hide'});});},registerReminderNotice:function d(){var a=this;$('#page').before('<div class="remindersNoticeContainer" tabindex="-1" role="dialog" aria-label="'+app.vtranslate('JS_REMINDER')+'" aria-hidden="true"></div>');var b=$('.remindersNoticeContainer'),c=$('.remindersNotice');c.on('click',function(){c.hasClass('autoRefreshing')||Vtiger_Index_Js.requestReminder(),a.hideActionMenu(),a.hideBreadcrumbActionMenu(),b.toggleClass('toggled'),a.hideReminderNotification(),app.closeSidebar(),a.hideSearchMenu();});},registerReminderNotification:function d(){var a=this;$('#page').before('<div class="remindersNotificationContainer" tabindex="-1" role="dialog"></div>');var b=$('.remindersNotificationContainer'),c=$('.notificationsNotice');c.on('click',function(){c.hasClass('autoRefreshing')||Vtiger_Index_Js.getNotificationsForReminder(),a.hideActionMenu(),a.hideBreadcrumbActionMenu(),b.toggleClass('toggled'),a.hideReminderNotice(),app.closeSidebar(),a.hideSearchMenu();});},toggleBreadcrumActions:function e(a){if(a.find('.js-breadcrumb').length){var b=a.find('.js-breadcrumb'),c=b.find('.js-breadcrumb__actions-btn'),d={top:b.offset().top+b.height()};b.find('.o-breadcrumb__actions').css(d),c.on('click',function(){b.find('.o-breadcrumb__actions').toggleClass('is-active');});}},registerMobileEvents:function c(){var a=this,b=this.getContentsContainer();$('.rightHeaderBtnMenu').on('click',function(){a.hideActionMenu(),a.hideBreadcrumbActionMenu(),a.hideSearchMenu(),a.hideReminderNotice(),a.hideReminderNotification(),$('.mobileLeftPanel ').toggleClass('mobileMenuOn');}),$('.js-quick-action-btn').on('click',function(){var b=$(this);app.closeSidebar(),a.hideBreadcrumbActionMenu(),a.hideSearchMenu(),a.hideReminderNotice(),a.hideReminderNotification(),$('.actionMenu').toggleClass('actionMenuOn'),b.hasClass('active')?(b.removeClass('active'),b.attr('aria-expanded','false'),b.popover()):(b.addClass('active'),b.attr('aria-expanded','true'),b.popover('disable')),$('.quickCreateModules').on('click',function(){a.hideActionMenu();});}),$('.searchMenuBtn').on('click',function(){var b=$(this);app.closeSidebar(),a.hideActionMenu(),a.hideBreadcrumbActionMenu(),a.hideReminderNotice(),a.hideReminderNotification(),$('.searchMenu').toggleClass('toogleSearchMenu'),b.hasClass('active')?(b.removeClass('active'),$('.searchMenuBtn .c-header__btn').attr('aria-expanded','false')):(b.addClass('active'),$('.searchMenuBtn .c-header__btn').attr('aria-expanded','true'));}),$('.js-header__btn--mail .dropdown').on('show.bs.dropdown',function(){app.closeSidebar(),a.hideActionMenu(),a.hideBreadcrumbActionMenu(),a.hideReminderNotice(),a.hideReminderNotification(),a.hideSearchMenu();}),this.toggleBreadcrumActions(b);},hideMobileMenu:function a(){$('.mobileLeftPanel ').removeClass('mobileMenuOn');},hideSearchMenu:function a(){$('.searchMenu').removeClass('toogleSearchMenu');},hideActionMenu:function a(){$('.actionMenu').removeClass('actionMenuOn');},hideBreadcrumbActionMenu:function a(){$('.js-breadcrumb__actions').removeClass('is-active');},hideReminderNotice:function a(){$('.remindersNoticeContainer').removeClass('toggled');},hideReminderNotification:function a(){$('.remindersNotificationContainer').removeClass('toggled');},showPdfModal:function d(a){var b={};if('List'==app.getViewName()){var c=Vtiger_List_Js.getSelectedRecordsParams(!1,!0);$.extend(b,c);}a+='&'+$.param(b),app.showModalWindow(null,a);},registerFooTable:function d(){var a=$('.tableRWD');a.find('thead tr th:gt(1)').attr('data-hide','phone'),a.find('thead tr th:gt(3)').attr('data-hide','tablet,phone'),a.find('thead tr th:last').attr('data-hide','');var b=a.find('thead').attr('col-visible-alltime');a.find('thead tr th:eq('+b+')').attr('data-hide',''),$('.tableRWD, .customTableRWD').footable({breakpoints:{phone:768,tablet:1024},addRowToggle:!0,toggleSelector:' > tbody > tr:not(.footable-row-detail)'}),$('.footable-toggle').on('click',function(a){a.stopPropagation(),$(this).trigger('footable_toggle_row');});var c=$('.customTableRWD').find('[data-toggle-visible=false]');c.find('.footable-toggle').css('display','none');},registerShowHideRightPanelEvent:function d(a){var b=this,c='ShowHideRightPanel'+app.getModuleName();'show'==app.cacheGet(c)&&b.showSiteBar(a,a.find('.toggleSiteBarRightButton')),null==app.cacheGet(c)&&1==a.find('.siteBarRight').data('showpanel')&&b.showSiteBar(a,a.find('.toggleSiteBarRightButton')),a.find('.toggleSiteBarRightButton').on('click',function(){var d=$(this);d.closest('.siteBarRight').hasClass('hideSiteBar')?(app.cacheSet(c,'show'),b.showSiteBar(a,d)):(app.cacheSet(c,'hide'),b.hideSiteBar(a,d));});},hideSiteBar:function f(a,b){var c,d,e;c=b.closest('.siteBarRight'),d=a.find('.rowContent'),e=b.find('[data-fa-i2svg]'),c.addClass('hideSiteBar'),d.removeClass('js-sitebar--active'),e.removeClass('fa-chevron-right').addClass('fa-chevron-left'),b.addClass('hideToggleSiteBarRightButton');},showSiteBar:function f(a,b){var c,d,e;c=b.closest('.siteBarRight'),d=a.find('.rowContent'),e=b.find('[data-fa-i2svg]'),c.removeClass('hideSiteBar'),d.addClass('js-sitebar--active'),e.removeClass('fa-chevron-left').addClass('fa-chevron-right'),b.removeClass('hideToggleSiteBarRightButton');},registerToggleButton:function a(){$('.buttonTextHolder .dropdown-menu a').on('click',function(){$(this).parents('.d-inline-block').find('.dropdown-toggle .textHolder').html($(this).text());});},listenTextAreaChange:function b(){var a=this;$('textarea').on('keyup',function(){var b=$(this);b.data('has-scroll')||(b.data('has-scroll',!0),b.on('scroll keyup',function(){a.resizeTextArea($(this));})),a.resizeTextArea($(this));});},resizeTextArea:function b(a){a.height(1),a.scrollTop(0),a.height(a[0].scrollHeight-a[0].clientHeight+a.height());},registerChat:function d(){var a=this,b=$('.chatModal');if(0!==b.length){var c=b.find('.modal-body');app.showNewScrollbar(c,{wheelPropagation:!0}),$('.headerLinkChat').on('click',function(a){a.stopPropagation();var b=$('.remindersNoticeContainer,.remindersNotificationContainer');b.hasClass('toggled')&&b.removeClass('toggled'),$('.actionMenu').removeClass('actionMenuOn'),$('.chatModal').modal({backdrop:!1});});b.find('.modal-dialog');this.registerChatLoadItems(b.data('timer')),b.find('.addMsg').on('click',function(){var c=b.find('.message').val();clearTimeout(a.chatTimer),AppConnector.request({dataType:'html',data:{module:'Chat',action:'Entries',mode:'add',message:c,cid:$('.chatModal .chatItem').last().data('cid')}}).done(function(c){$('.chatModal .modal-body').append(c),a.registerChatLoadItems(b.data('timer'));}),b.find('.message').val('');}),app.animateModal(b,'slideInRight','slideOutRight');}},registerChatLoadItems:function d(a){var b=this,c=$('.chatModal .modal-title .fa-comments');this.chatTimer=setTimeout(function(){c.css('color','#00e413'),b.getChatItems(),b.registerChatLoadItems(a),c.css('color','#000');},a);},getChatItems:function b(){var a=this;AppConnector.request({module:'Chat',view:'Entries',mode:'get',cid:$('.chatModal .chatItem').last().data('cid')}).done(function(a){a&&$('.chatModal .modal-body').append(a);}).fail(function(){clearTimeout(a.chatTimer);});},registerEvents:function e(){var a=this,b=a.getContentsContainer(),c=b.find('.js-menu--scroll'),d=b.find('.quickCreateModules');app.showNewScrollbarLeft(c,{suppressScrollX:!0}),app.showNewScrollbar(c.find('.subMenu').last(),{suppressScrollX:!0}),a.listenTextAreaChange(),a.registerFooTable(),a.registerShowHideRightPanelEvent($('#centerPanel')),$('.js-clear-history').on('click',function(){app.clearBrowsingHistory();}),$('.globalSearch').on('click',function(){var b=$(this);a.hideSearchMenu();var c=new Vtiger_AdvanceSearch_Js;c.setParentContainer(b.closest('.js-global-search__input')),c.initiateSearch().done(function(){c.selectBasicSearchValue();});}),$('.searchIcon').on('click',function(){var a=$(this).closest('.js-global-search__input').find('.js-global-search__value'),b=$.Event('keypress');b.which=13,a.trigger(b);}),a.registerAnnouncements(),a.registerHotKeys(),a.registerToggleButton(),$('.basicSearchModulesList').on('change',function(){var a=$(this).closest('.js-global-search__input').find('.js-global-search__value');setTimeout(function(){a.focus();},100);}),a.basicSearch(),d.on('click','.quickCreateModule',function(b){var c=$(b.currentTarget).data('name');d.modal('hide'),a.quickCreateModule(c);}),a.registerMobileEvents(),/Android|webOS|iPhone|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?$('#basicSearchModulesList_chosen').find('.chzn-results').css({"max-height":'350px',"overflow-y":'scroll'}):(app.showScrollBar($('#basicSearchModulesList_chosen').find('.chzn-results'),{height:'450px',railVisible:!0,alwaysVisible:!0,size:'6px'}),1024>=window.outerWidth),a.registerReminderNotice(),a.registerReminderNotification(),a.registerChat();}}),$(document).ready(function(){window.addEventListener('popstate',function(a){a.state&&(window.location.href=a.state);}),Vtiger_Header_Js.getInstance().registerEvents();});
//# sourceMappingURL=Header.min.js.map
