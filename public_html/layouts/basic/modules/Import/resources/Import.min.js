'use strict';

if('undefined'==typeof ImportJs){var ImportJs={toogleMergeConfiguration:function c(){var a=jQuery('#auto_merge').is(':checked'),b=jQuery('#duplicates_merge_configuration');a?b.show():b.hide();},checkFileType:function c(){var a=jQuery('#import_file').val();if(''!=a){var b=a.split('.').pop();jQuery('#type').val(b),ImportJs.handleFileTypeChange();}},handleFileTypeChange:function f(){var a=jQuery('.js-type').val(),b=jQuery('.js-delimiter-container'),c=jQuery('.js-has-header-container'),d=jQuery('.js-xml-tpl'),e=jQuery('.js-zip-extension');'xml'===a?(b.addClass('d-none'),c.addClass('d-none'),d.removeClass('d-none'),e.addClass('d-none')):'zip'===a?(b.addClass('d-none'),c.addClass('d-none'),e.removeClass('d-none')):(b.removeClass('d-none'),c.removeClass('d-none'),e.addClass('d-none'),d.addClass('d-none'));},uploadAndParse:function a(){return !!ImportJs.validateFilePath()&&!!ImportJs.validateMergeCriteria()},registerImportClickEvent:function a(){$('#importButton').removeAttr('disabled').on('click',function(){return ImportJs.sanitizeAndSubmit()});},validateFilePath:function d(){var a=jQuery('#import_file'),b=a.val();if(''==jQuery.trim(b)){var c=app.vtranslate('JS_IMPORT_FILE_CAN_NOT_BE_EMPTY');return Vtiger_Helper_Js.showMessage({text:c,type:'error'}),a.focus(),!1}return !!ImportJs.uploadFilter('import_file','csv|vcf|xml|zip')&&!!ImportJs.uploadFileSize('import_file')},uploadFilter:function i(a,b){var c=jQuery('#'+a);if(c){var d=c.val(),e=d.toLowerCase().split('.'),f=e[e.length-1],g=b.toLowerCase().split('|');if(0>g.indexOf(f)){var h=app.vtranslate('JS_SELECT_FILE_EXTENSION')+'\n'+g;return Vtiger_Helper_Js.showMessage({text:h,type:'error'}),c.focus(),!1}}return !0},uploadFileSize:function g(a){var b=jQuery('#'+a),c=b.closest('td').data('importUploadSize'),d=b.closest('td').data('importUploadSizeMb'),e=b.get(0).files[0].size;if(e>c){var f=app.vtranslate('JS_UPLOADED_FILE_SIZE_EXCEEDS')+' '+d+' MB.'+app.vtranslate('JS_PLEASE_SPLIT_FILE_AND_IMPORT_AGAIN');return Vtiger_Helper_Js.showMessage({text:f,type:'error'}),!1}return !0},validateMergeCriteria:function d(){var a=jQuery('#auto_merge').is(':checked');if(a){var b=jQuery('#selected_merge_fields option');if(0==b.length){var c=app.vtranslate('JS_PLEASE_SELECT_ONE_FIELD_FOR_MERGE');return Vtiger_Helper_Js.showMessage({text:c,type:'error'}),!1}}return ImportJs.convertOptionsToJSONArray('#selected_merge_fields','#merge_fields'),!0},convertOptionsToJSONArray:function g(a,b){var c=jQuery(a),d=[];if('undefined'!=typeof c&&''!=c[0])for(var e=0;e<c[0].length;++e)d.push(c[0].options[e].value);if('undefined'!==b){var f=$(b);'undefined'!=typeof f&&f.val(JSON.stringify(d));}return d},copySelectedOptions:function l(a,b){var c=jQuery(a),d=jQuery(b);if('undefined'!=typeof c&&'undefined'!=typeof d)for(var e=0;e<c[0].length;e++)if(!0==c[0].options[e].selected){for(var f=!1,g=null,h=0;h<d[0].length;h++)if(d[0].options[h].value==c[0].options[e].value){f=!0,g=d[0].options[h];break}if(!0!=f){var k=$('<option selected>');k.attr('value',c[0].options[e].value),k.text(c[0].options[e].text),jQuery(d[0]).append(k),c[0].options[e].selected=!1,f=!1;}else null!=g&&(g.selected=!0);}},removeSelectedOptions:function d(a){var b=jQuery(a);if(null!=b&&'undefined'!=typeof b)for(var c=b[0].options.length-1;0<=c;c--)!0==b[0].options[c].selected&&(b[0].options[c]=null);},sanitizeAndSubmit:function a(){return !!ImportJs.sanitizeFieldMapping()&&!!ImportJs.validateCustomMap()},sanitizeFieldMapping:function u(){for(var a,b=jQuery('.fieldIdentifier'),c={},d={},e={},f={},g=0;g<b.length;++g){var h=jQuery(b.get(g)),j=jQuery('[name=row_counter]',h).get(0).value,k=jQuery('select',h),l=k.find('option:selected'),m=l.val(),n=jQuery('#'+m+'_defaultvalue',h),o='';if(o='checkbox'==n.attr('type')?n.is(':checked'):n.val(),''!=m){var p;if(k.hasClass('inventory')?(p=ImportJs.checkIfMappedFieldExist(m,d,l),d[m]=j-1):(p=ImportJs.checkIfMappedFieldExist(m,c,l),c[m]=j-1),p)return !1;''!=o&&(f[m]=o);}}var q=JSON.parse(jQuery('#mandatory_fields').val()),r=app.getModuleName(),s=[];for(var t in q)if(t in c)continue;else s.push('"'+q[t]+'"');return 0<s.length?(a=app.vtranslate('JS_MAP_MANDATORY_FIELDS')+s.join(','),e={text:a,type:'error'},Vtiger_Helper_Js.showMessage(e),!1):(jQuery('#field_mapping').val(JSON.stringify(c)),jQuery('#inventory_field_mapping').val(JSON.stringify(d)),jQuery('#default_values').val(JSON.stringify(f)),!0)},checkIfMappedFieldExist:function e(a,b,c){if(a in b){var d=app.vtranslate('JS_FIELD_MAPPED_MORE_THAN_ONCE')+' '+c.data('label');return Vtiger_Helper_Js.showMessage({text:d,type:'error'}),!0}return !1},validateCustomMap:function h(){var a,b={},c=jQuery('#save_map').is(':checked');if(c){var d=jQuery('#save_map_as').val();if(''==jQuery.trim(d))return a=app.vtranslate('JS_MAP_NAME_CAN_NOT_BE_EMPTY'),b={text:a,type:'error'},Vtiger_Helper_Js.showMessage(b),!1;for(var e,f=jQuery('#saved_maps option'),g=0;g<f.length;++g)if(e=jQuery(f.get(g)),e.html()==d)return a=app.vtranslate('JS_MAP_NAME_ALREADY_EXISTS'),b={text:a,type:'error'},Vtiger_Helper_Js.showMessage(b),!1}return !0},loadSavedMap:function l(){var a=jQuery('#saved_maps option:selected'),b=a.attr('id'),c=jQuery('.fieldIdentifier'),d=jQuery('#delete_map_container');if(c.each(function(a,b){var c=jQuery(b);jQuery('[name=mapped_fields]',c).val('');}),-1==b)return void d.hide();d.show();var e=a.val();if(''!=e){for(var f=e.split('&'),g={},h=0;h<f.length;++h){var j=f[h].split('='),k=j[0];k=k.replace(/\/eq\//g,'='),k=k.replace(/\/amp\//g,'&'),g['\''+k+'\'']=j[1];}c.each(function(a,b){var c=jQuery(b),d=jQuery('[name=mapped_fields]',c),e=jQuery('[name=row_counter]',c).get(0).value,f=jQuery('[name=header_name]',c).get(0),h=jQuery(f).html();'\''+h+'\''in g?d.val(g['\''+h+'\'']):e in g&&d.val($rowId),d.trigger('chosen:updated'),ImportJs.loadDefaultValueWidget(c.attr('id'));});}},deleteMap:function e(a){if(confirm(app.vtranslate('LBL_DELETE_CONFIRMATION'))){var b=jQuery('#saved_maps option:selected'),c=b.attr('id'),d=jQuery('#status');d.show();AppConnector.request({module:a,view:'Import',mode:'deleteMap',mapid:c}).done(function(a){jQuery('#savedMapsContainer').html(a),d.hide();var b=jQuery('#saved_maps');App.Fields.Picklist.changeSelectElementView(b);}).fail(function(a){console.error(a);});}},loadDefaultValueWidget:function j(a){var b=jQuery('#'+a);if('undefined'!=typeof b&&null!=b){var c=jQuery('[name=mapped_fields]',b).get(0),d=jQuery(c).val(),e=jQuery(jQuery('[name=default_value_container]',b).get(0)),f=jQuery('#defaultValuesElementsContainer');if(0<e.children.length){var g=jQuery(':first',e).detach();g.appendTo(f);}var h=jQuery('#'+d+'_defaultvalue_container',f),i=h.detach();i.appendTo(e);}},loadDefaultValueWidgetForMappedFields:function b(){var a=jQuery('.fieldIdentifier');a.each(function(a,b){var c=jQuery(b),d=jQuery('[name=mapped_fields]',c).val();''!=d&&ImportJs.loadDefaultValueWidget(c.attr('id'));});},submitAction:function b(){var a=jQuery('[name="importAdvanced"]');a.on('submit',function(){jQuery.progressIndicator({message:app.vtranslate('JS_SAVE_LOADER_INFO'),position:'html',blockInfo:{enabled:!0}});});},openListInModal:function a(){$('.js-open-list-in-modal').on('click',function(){var a=$(this),b=a.data('module-name'),c='',d=a.data('for-user'),e=a.data('for-module');''!==$(this).attr('data-type')&&(c='&type='+a.data('type')),app.showModalWindow(null,'index.php?module='+b+'&view=List&mode=getImportDetails'+c+'&start=1&foruser='+d+'&forModule='+e,function(a){var b=a.find('.listViewEntriesDiv'),c=b.height(),d=b.offset().top,e=$('.js-footer').height(),f=$(window).height();$(window).width()>app.breakpoints.sm&&(c+d+e>f&&b.height(f-(d+e)),app.showNewScrollbarTopBottomRight(b));});});}};jQuery(document).ready(function(){ImportJs.toogleMergeConfiguration(),ImportJs.openListInModal(),ImportJs.submitAction(),ImportJs.loadDefaultValueWidgetForMappedFields(),ImportJs.registerImportClickEvent(),App.Fields.Date.register(jQuery('.contentsDiv'));});}
//# sourceMappingURL=Import.min.js.map
