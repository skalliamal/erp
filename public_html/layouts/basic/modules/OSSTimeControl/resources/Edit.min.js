'use strict';

Vtiger_Edit_Js('OSSTimeControl_Edit_Js',{},{registerGenerateTCFieldTimeAndCost:function f(){var a=Math.round,b=this;$('input[name="sum_time"]').attr('readonly','readonly').css('width','80px');var c=b.getForm(),d=b.differenceDays(c),e=(a(100*(d/36e5))/100).toFixed(2);jQuery('input[name="sum_time"]').val(e),jQuery('.dateField').on('change',function(){return d=b.differenceDays(c),'Error'!=d&&void(e=(a(100*(d/36e5))/100).toFixed(2),jQuery('input[name="sum_time"]').val(e))}),jQuery('.clockPicker').on('change',function(){return d=b.differenceDays(c),'Error'!=d&&void(e=(a(100*(d/36e5))/100).toFixed(2),jQuery('input[name="sum_time"]').val(e))});},differenceDays:function o(a){var b=a.find('input[name="date_start"]'),c=b.data('date-format'),d=b.val(),e=a.find('input[name="due_date"]'),f=e.data('date-format'),g=e.val(),h=a.find('input[name="time_start"]'),i=a.find('input[name="time_end"]'),j=h.val(),k=i.val(),l=Vtiger_Helper_Js.getDateInstance(d+' '+j,c),m=Vtiger_Helper_Js.getDateInstance(g+' '+k,f),n=m-l;return 0<=n?n:'Error'},registerRecordPreSaveEvent:function c(){var a=this,b=$('.recordEditView[name="QuickCreate"]');0==b.length&&(b=this.getForm()),b.on(Vtiger_Edit_Js.recordPreSave,function(){var c=a.differenceDays(b);if('Error'==c){var d={text:app.vtranslate('JS_DATE_SHOULD_BE_GREATER_THAN'),type:'error'};return Vtiger_Helper_Js.showPnotify(d),!1}return !0===CONFIG.disallowLongerThan24Hours&&(c=c/1e3/60/60,24<c)?(Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_DATE_NOT_SHOULD_BE_GREATER_THAN_24H'),type:'error'}),!1):void b.submit()});},registerGenerateTCFromHelpDesk:function e(){var a=this,b=jQuery('input[name="sourceRecord"]').val(),c=jQuery('input[name="sourceModule"]').val();if('undefined'!=typeof b){var d={};d.data={module:'OSSTimeControl',action:'GetTCInfo',id:b,sourceModule:c},d.async=!1,d.dataType='json',AppConnector.request(d).done(function(b){var d=b.result;if(d.success){var e=d.sourceData;'HelpDesk'==c?('contact_id'in e&&(jQuery('[name="contactid"]').val(e.contact_id),jQuery('[name="contactid_display"]').val(a.replaceAll(e.contact_label,'&oacute;','\xF3')).prop('readonly',!0)),'parent_id'in e&&(jQuery('[name="accountid"]').val(e.parent_id),jQuery('[name="accountid_display"]').val(a.replaceAll(e.account_label,'&oacute;','\xF3')).prop('readonly',!0))):'Project'==c&&('contact_label'in e&&(jQuery('[name="contactid"]').val(e.contact_id),jQuery('[name="contactid_display"]').val(a.replaceAll(e.contact_label,'&oacute;','\xF3')).prop('readonly',!0)),'account_label'in e&&(jQuery('[name="accountid"]').val(e.linktoaccountscontacts),jQuery('[name="accountid_display"]').val(a.replaceAll(e.account_label,'&oacute;','\xF3')).prop('readonly',!0)));}else{var f={text:app.vtranslate('message'),type:'error'};Vtiger_Helper_Js.showPnotify(f);}}).fail(function(){Vtiger_Helper_Js.showPnotify({text:app.vtranslate('JS_ERROR_CONNECTING'),type:'error'});});}},escapeRegExp:function b(a){return a.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,'\\$1')},replaceAll:function e(a,b,c){var d=this;return a=a.replace(new RegExp(d.escapeRegExp('&Oacute;'),'g'),'\xD3'),a.replace(new RegExp(d.escapeRegExp(b),'g'),c)},registerBasicEvents:function b(a){this._super(a),this.registerRecordPreSaveEvent(a);},registerEvents:function a(){this._super(),this.registerGenerateTCFieldTimeAndCost(),this.registerGenerateTCFromHelpDesk();}});
//# sourceMappingURL=Edit.min.js.map
