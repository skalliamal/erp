{"version":3,"file":"Edit.min.js","sources":["Edit.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\nVtiger_Edit_Js(\"OSSTimeControl_Edit_Js\", {}, {\n\n\tregisterGenerateTCFieldTimeAndCost: function () {\n\t\tvar thisInstance = this;\n\t\t$('input[name=\"sum_time\"]').attr('readonly', 'readonly').css('width', '80px');\n\t\tvar form = thisInstance.getForm();\n\t\tvar sumeTime = thisInstance.differenceDays(form);\n\t\tvar hours = (Math.round((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\n\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\tjQuery('.dateField').on('change', function () {\n\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime == 'Error') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thours = (Math.round((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t});\n\t\tjQuery('.clockPicker').on('change', function () {\n\t\t\tsumeTime = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime == 'Error') {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\thours = (Math.round((sumeTime / 3600000) * 100) / 100).toFixed(2);\n\t\t\tjQuery('input[name=\"sum_time\"]').val(hours);\n\t\t});\n\n\t},\n\n\tdifferenceDays: function (container) {\n\t\tvar firstDate = container.find('input[name=\"date_start\"]');\n\t\tvar firstDateFormat = firstDate.data('date-format');\n\t\tvar firstDateValue = firstDate.val();\n\t\tvar secondDate = container.find('input[name=\"due_date\"]');\n\t\tvar secondDateFormat = secondDate.data('date-format');\n\t\tvar secondDateValue = secondDate.val();\n\t\tvar firstTime = container.find('input[name=\"time_start\"]');\n\t\tvar secondTime = container.find('input[name=\"time_end\"]');\n\t\tvar firstTimeValue = firstTime.val();\n\t\tvar secondTimeValue = secondTime.val();\n\t\tvar firstDateTimeValue = firstDateValue + ' ' + firstTimeValue;\n\t\tvar secondDateTimeValue = secondDateValue + ' ' + secondTimeValue;\n\t\tvar firstDateInstance = Vtiger_Helper_Js.getDateInstance(firstDateTimeValue, firstDateFormat);\n\t\tvar secondDateInstance = Vtiger_Helper_Js.getDateInstance(secondDateTimeValue, secondDateFormat);\n\t\tvar timeBetweenDates = secondDateInstance - firstDateInstance;\n\t\tif (timeBetweenDates >= 0) {\n\t\t\treturn timeBetweenDates;\n\t\t}\n\t\treturn 'Error';\n\t},\n\n\t/**\n\t * Function to register recordpresave event\n\t */\n\tregisterRecordPreSaveEvent: function (container) {\n\t\tvar thisInstance = this;\n\t\tvar form = $('.recordEditView[name=\"QuickCreate\"]');\n\t\tif (form.length == 0) {\n\t\t\tform = this.getForm();\n\t\t}\n\t\tform.on(Vtiger_Edit_Js.recordPreSave, function (e, data) {\n\t\t\tvar sumeTime2 = thisInstance.differenceDays(form);\n\t\t\tif (sumeTime2 == 'Error') {\n\t\t\t\tvar parametres = {\n\t\t\t\t\ttext: app.vtranslate('JS_DATE_SHOULD_BE_GREATER_THAN'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t};\n\t\t\t\tVtiger_Helper_Js.showPnotify(parametres);\n\t\t\t\treturn false;\n\t\t\t} else {\n\t\t\t\tif (CONFIG.disallowLongerThan24Hours === true) {\n\t\t\t\t\tsumeTime2 = sumeTime2 / 1000 / 60 / 60;\n\t\t\t\t\tif (sumeTime2 > 24) {\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\t\t\ttext: app.vtranslate('JS_DATE_NOT_SHOULD_BE_GREATER_THAN_24H'),\n\t\t\t\t\t\t\ttype: 'error'\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tform.submit();\n\t\t\t}\n\t\t});\n\t},\n\tregisterGenerateTCFromHelpDesk: function () {\n\t\tvar thisInstance = this;\n\t\tvar sourceDesk = jQuery('input[name=\"sourceRecord\"]').val();\n\t\tvar moduleName = jQuery('input[name=\"sourceModule\"]').val();\n\t\tif (typeof sourceDesk !== \"undefined\") {\n\n\t\t\tvar params = {};\n\t\t\tparams.data = {module: 'OSSTimeControl', action: 'GetTCInfo', id: sourceDesk, sourceModule: moduleName};\n\t\t\tparams.async = false;\n\t\t\tparams.dataType = 'json';\n\t\t\tAppConnector.request(params).done(function (data) {\n\t\t\t\t\tvar response = data['result'];\n\t\t\t\t\tif (response['success']) {\n\t\t\t\t\t\tvar sourceD = response.sourceData;\n\n\t\t\t\t\t\tif (moduleName == 'HelpDesk') {\n\t\t\t\t\t\t\tif ('contact_id' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]').val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ('parent_id' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.parent_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]').val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else if (moduleName == 'Project') {\n\t\t\t\t\t\t\tif ('contact_label' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid\"]').val(sourceD.contact_id);\n\t\t\t\t\t\t\t\tjQuery('[name=\"contactid_display\"]').val(thisInstance.replaceAll(sourceD.contact_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif ('account_label' in sourceD) {\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid\"]').val(sourceD.linktoaccountscontacts);\n\t\t\t\t\t\t\t\tjQuery('[name=\"accountid_display\"]').val(thisInstance.replaceAll(sourceD.account_label, '&oacute;', 'ó')).prop('readonly', true);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar params = {\n\t\t\t\t\t\t\ttext: app.vtranslate('message'),\n\t\t\t\t\t\t\ttype: 'error',\n\t\t\t\t\t\t};\n\t\t\t\t\t\tVtiger_Helper_Js.showPnotify(params);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t).fail(function () {\n\t\t\t\tVtiger_Helper_Js.showPnotify({\n\t\t\t\t\ttext: app.vtranslate('JS_ERROR_CONNECTING'),\n\t\t\t\t\ttype: 'error'\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t},\n\n\tescapeRegExp: function (string) {\n\t\treturn string.replace(/([.*+?^=!:${}()|\\[\\]\\/\\\\])/g, \"\\\\$1\");\n\t},\n\n\treplaceAll: function (string, find, replace) {\n\t\tvar thisInstance = this;\n\t\tstring = string.replace(new RegExp(thisInstance.escapeRegExp('&Oacute;'), 'g'), 'Ó');\n\t\treturn string.replace(new RegExp(thisInstance.escapeRegExp(find), 'g'), replace);\n\t},\n\tregisterBasicEvents: function (container) {\n\t\tthis._super(container);\n\t\tthis.registerRecordPreSaveEvent(container);\n\t},\n\tregisterEvents: function () {\n\t\tthis._super();\n\t\tthis.registerGenerateTCFieldTimeAndCost();\n\t\tthis.registerGenerateTCFromHelpDesk();\n\t}\n});\n"],"names":["Vtiger_Edit_Js","registerGenerateTCFieldTimeAndCost","Math","round","thisInstance","$","attr","css","getForm","sumeTime","differenceDays","form","hours","toFixed","jQuery","val","on","container","find","firstDateFormat","firstDate","data","firstDateValue","secondDate","secondDateFormat","secondDateValue","firstTime","secondTime","firstTimeValue","secondTimeValue","firstDateInstance","Vtiger_Helper_Js","getDateInstance","secondDateInstance","timeBetweenDates","registerRecordPreSaveEvent","length","recordPreSave","text","app","vtranslate","type","showPnotify","parametres","disallowLongerThan24Hours","sumeTime2","submit","registerGenerateTCFromHelpDesk","sourceDesk","moduleName","params","module","action","id","sourceModule","async","dataType","AppConnector","request","done","response","sourceData","sourceD","contact_id","replaceAll","contact_label","prop","parent_id","account_label","linktoaccountscontacts","fail","escapeRegExp","string","replace","registerBasicEvents","_super","registerEvents"],"mappings":"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"}