'use strict';

jQuery.Class('OSSTimeControl_Calendar_Js',{registerUserListWidget:function b(){var a=$('.widgetContainer');a.hover(function(){$(this).css('overflow','visible');},function(){$(this).css('overflow','hidden');}),this.registerColorField(a.find('#calendarUserList'),'userCol'),this.registerColorField(a.find('#timecontrolTypes'),'listCol'),a.find('.select2').on('change',function(){$(this).closest('.siteBarContent').find('.refreshHeader').removeClass('d-none');});},registerColorField:function d(a,b){var c={};c.dropdownCss={"z-index":0},c.formatSelection=function(c,d){var e=c.id,f=a.find('option[value="'+e+'"]');d.addClass(b+'_'+e);var g='<div>'+f.text()+'</div>';return g},App.Fields.Picklist.changeSelectElementView(a,'select2',c);}},{calendarView:!1,calendarCreateView:!1,registerCalendar:function k(){var a=this,b=jQuery('#eventLimit').val();b=!('true'!=b)||'false'!=b&&parseInt(b)+1;var c=jQuery('#weekView').val(),d=jQuery('#dayView').val(),e=jQuery('#activity_view').val();e='Today'==e?d:'This Week'==e?c:'month';var f=jQuery('#time_format').val(),g=void 0;24==f?(f='H:mm',g='HH:mm'):(f='h:mmt',g='hh:mm A');var h=CONFIG.firstDayOfWeekNo,i=jQuery('#start_hour').val(),j=i.split(':');i=j[0],a.getCalendarView().fullCalendar('destroy'),a.getCalendarView().fullCalendar({header:{left:'month,'+c+','+d,center:'title today',right:'prev,next'},timeFormat:f,axisFormat:f,firstHour:i,firstDay:h,defaultView:e,editable:!0,slotMinutes:15,defaultEventMinutes:0,forceEventDuration:!0,defaultTimedEventDuration:'01:00:00',eventLimit:b,allDaySlot:!1,height:app.setCalendarHeight(),views:{basic:{eventLimit:!1}},dayClick:function c(b){a.selectDay(b.format()),a.getCalendarView().fullCalendar('unselect');},eventDrop:function e(b,c,d){a.updateEvent(b,c,d);},eventResize:function e(b,c,d){a.updateEvent(b,c,d);},eventRender:function c(a,b){app.showPopoverElementView(b.find('.fc-content'),{title:a.title+'<a href="index.php?module=OSSTimeControl&view=Edit&record='+a.id+'" class="float-right"><span class="fas fa-edit"></span></a><a href="index.php?module=OSSTimeControl&view=Detail&record='+a.id+'" class="float-right mx-1"><span class="fas fa-th-list"></span></a>',container:'body',html:!0,placement:'auto',template:'<div class="popover calendarPopover" role="tooltip"><div class="arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',content:'<div><span class="far fa-clock"></span> <label>'+app.vtranslate('JS_START_DATE')+'</label>: '+a.start_display+'</div><div><span class="far fa-clock"></span> <label>'+app.vtranslate('JS_END_DATE')+'</label>: '+a.end_display+'</div><div><span class="far fa-clock"></span> <label>'+app.vtranslate('JS_TOTAL_TIME')+'</label>: '+a.totalTime+'</div><div><span class="fas fa-bars"></span> <label>'+app.vtranslate('JS_NUMBER')+'</label>: '+a.number+'</div><div><span class="fas fa-question-circle"></span> <label>'+app.vtranslate('JS_TYPE')+'</label>: '+a.type+'</div>'+(a.status?'<div><span class="far fa-star"></span> <label>'+app.vtranslate('JS_STATUS')+'</label>: '+a.status+'</div>':'')+(a.linkl?'<div><span class="userIcon-'+a.linkm+'" aria-hidden="true"></span> <label>'+app.vtranslate('JS_RELATION')+'</label>: <a target="_blank" href="index.php?module='+a.linkm+'&view=Detail&record='+a.link+'">'+a.linkl+'</a></div>':'')+(a.linkexl?'<div><span class="userIcon-'+a.linkexm+'" aria-hidden="true"></span> <label>'+app.vtranslate('JS_RELATION_EXTEND')+'</label>: <a target="_blank" href="index.php?module='+a.linkexm+'&view=Detail&record='+a.linkextend+'">'+a.linkexl+'</a></div>':'')+(a.procl?'<div><span class="userIcon-'+a.procm+'" aria-hidden="true"></span> <label>'+app.vtranslate('JS_PROCESS')+'</label>: <a target="_blank" href="index.php?module='+a.procm+'&view=Detail&record='+a.process+'">'+a.procl+'</a></div>':'')+(a.subprocl?'<div><span class="userIcon-'+a.subprocm+'" aria-hidden="true"></span> <label>'+app.vtranslate('JS_SUB_PROCESS')+'</label>: <a target="_blank" href="index.php?module='+a.subprocm+'&view=Detail&record='+a.subprocess+'">'+a.subprocl+'</a></div>':'')+(a.smownerid?'<div><span class="fas fa-user"></span> <label>'+app.vtranslate('JS_ASSIGNED_TO')+'</label>: '+a.smownerid+'</div>':'')});},monthNames:[app.vtranslate('JS_JANUARY'),app.vtranslate('JS_FEBRUARY'),app.vtranslate('JS_MARCH'),app.vtranslate('JS_APRIL'),app.vtranslate('JS_MAY'),app.vtranslate('JS_JUNE'),app.vtranslate('JS_JULY'),app.vtranslate('JS_AUGUST'),app.vtranslate('JS_SEPTEMBER'),app.vtranslate('JS_OCTOBER'),app.vtranslate('JS_NOVEMBER'),app.vtranslate('JS_DECEMBER')],monthNamesShort:[app.vtranslate('JS_JAN'),app.vtranslate('JS_FEB'),app.vtranslate('JS_MAR'),app.vtranslate('JS_APR'),app.vtranslate('JS_MAY'),app.vtranslate('JS_JUN'),app.vtranslate('JS_JUL'),app.vtranslate('JS_AUG'),app.vtranslate('JS_SEP'),app.vtranslate('JS_OCT'),app.vtranslate('JS_NOV'),app.vtranslate('JS_DEC')],dayNames:[app.vtranslate('JS_SUNDAY'),app.vtranslate('JS_MONDAY'),app.vtranslate('JS_TUESDAY'),app.vtranslate('JS_WEDNESDAY'),app.vtranslate('JS_THURSDAY'),app.vtranslate('JS_FRIDAY'),app.vtranslate('JS_SATURDAY')],dayNamesShort:[app.vtranslate('JS_SUN'),app.vtranslate('JS_MON'),app.vtranslate('JS_TUE'),app.vtranslate('JS_WED'),app.vtranslate('JS_THU'),app.vtranslate('JS_FRI'),app.vtranslate('JS_SAT')],buttonText:{today:app.vtranslate('JS_TODAY'),month:app.vtranslate('JS_MONTH'),week:app.vtranslate('JS_WEEK'),day:app.vtranslate('JS_DAY')},allDayText:app.vtranslate('JS_ALL_DAY'),eventLimitText:app.vtranslate('JS_MORE')});},registerRefreshEvent:function b(){var a=this;$('.refreshCalendar').on('click',function(){$(this).closest('.refreshHeader').addClass('d-none'),a.loadCalendarData();});},registerButtonSelectAll:function b(){var a=$('.selectAllBtn');a.on('click',function(){var a=$(this).find('.selectAll'),b=$(this).find('.deselectAll');a.hasClass('d-none')?(a.removeClass('d-none'),b.addClass('d-none'),$(this).closest('.quickWidget').find('select option').prop('selected',!1)):($(this).closest('.quickWidget').find('select option').prop('selected',!0),b.removeClass('d-none'),a.addClass('d-none')),$(this).closest('.quickWidget').find('select').trigger('change');});},loadCalendarData:function i(a){var b=jQuery.progressIndicator(),c=this;c.getCalendarView().fullCalendar('removeEvents');var d,e=c.getCalendarView().fullCalendar('getView'),f=CONFIG.dateFormat.toUpperCase();if(d=0==jQuery('#calendarUserList').length?CONFIG.userId:jQuery('#calendarUserList').val(),0<jQuery('#timecontrolTypes').length)var g=jQuery('#timecontrolTypes').val();else a=!0;if(!0==a||null!=g){var h={module:'OSSTimeControl',action:'Calendar',mode:'getEvent',start:e.start.format(f),end:e.end.format(f),user:d,types:g};AppConnector.request(h).done(function(a){c.getCalendarView().fullCalendar('addEventSource',a.result),b.hide();});}else c.getCalendarView().fullCalendar('removeEvents'),b.hide();},updateEvent:function h(a,b,c){var d=jQuery.progressIndicator(),e=a.start.format(),f=a.end.format(),g={module:'OSSTimeControl',action:'Calendar',mode:'updateEvent',id:a.id,start:e,delta:b._data};AppConnector.request(g).done(function(a){a.result||(Vtiger_Helper_Js.showPnotify(app.vtranslate('JS_NO_EDIT_PERMISSION')),c()),d.hide();}).fail(function(){d.hide(),Vtiger_Helper_Js.showPnotify(app.vtranslate('JS_NO_EDIT_PERMISSION')),c();});},selectDay:function c(a){var b=this;b.getCalendarCreateView().done(function(c){if(!(0>=c.length)){var d=c.find('[name="date_start"]').data('dateFormat').toUpperCase(),e=c.find('[name="time_start"]').data('format');if(24==e)var f='HH:mm';else f='hh:mm A';var g=Date.parse(a),h=moment(a).format(d),i=moment(a).format(f),j=Date.parse(a),k=moment(a).format(d),l=b.getCalendarView().fullCalendar('getView');if('month'==l.name){var m,n=parseInt((j-g)/86400000);if(1<n){var o=jQuery('#start_hour').val(),p=o.split(':');i=p[0];var q=jQuery('#end_hour').val();p=q.split(':'),m=p[0];}else{var r=new Date;i=moment(r).format(f),m=moment(r).add(15,'minutes').format(f);}}else m=moment(j).add(30,'minutes').format(f);c.find('[name="date_start"]').val(h),c.find('[name="due_date"]').val(k),c.find('[name="time_start"]').val(i),c.find('[name="time_end"]').val(m);var s=new Vtiger_Header_Js;s.handleQuickCreateData(c,{callbackFunction:function c(a){b.addCalendarEvent(a.result,d);}}),jQuery('.modal-body').css({"max-height":app.getScreenHeight(70)+'px',"overflow-y":'auto'});}});},addCalendarEvent:function f(a){var b=$('#calendarUserList').val();if(0===b.length&&(b=[CONFIG.userId.toString()]),!(0>$.inArray(a.assigned_user_id.value,b))){var c=$('#timecontrolTypes').val();if(!(0>$.inArray(a.timecontrol_type.value,c)&&0<c.length)){var d=this.getCalendarView(),e={id:a._recordId,title:a.name.display_value,start:d.fullCalendar('moment',a.date_start.value+' '+a.time_start.value).format(),end:d.fullCalendar('moment',a.due_date.value+' '+a.time_end.value).format(),start_display:a.date_start.display_value+' '+a.time_start.display_value,end_display:a.due_date.display_value+' '+a.time_end.display_value,url:'index.php?module=OSSTimeControl&view=Detail&record='+a._recordId,className:'ownerCBg_'+a.assigned_user_id.value+' picklistCBr_OSSTimeControl_timecontrol_type_'+a.timecontrol_type.value,totalTime:a.sum_time.display_value,number:a.osstimecontrol_no.display_value,type:a.timecontrol_type.display_value,status:a.osstimecontrol_status.display_value,smownerid:a.assigned_user_id.display_value};this.getCalendarView().fullCalendar('renderEvent',e);}}},getCalendarCreateView:function d(){var a=this,b=jQuery.Deferred();if(!1!==this.calendarCreateView)return b.resolve(this.calendarCreateView.clone(!0,!0)),b.promise();var c=jQuery.progressIndicator();return this.loadCalendarCreateView().done(function(d){c.hide(),a.calendarCreateView=d,b.resolve(d.clone(!0,!0));}).fail(function(){c.hide();}),b.promise()},loadCalendarCreateView:function d(){var a=jQuery.Deferred(),b=app.getModuleName(),c=Vtiger_Header_Js.getInstance();return c.getQuickCreateForm('index.php?module='+b+'&view=QuickCreateAjax',b).done(function(b){a.resolve(jQuery(b));}).fail(function(b,c){a.reject(b,c);}),a.promise()},getCalendarView:function a(){return !1==this.calendarView&&(this.calendarView=jQuery('#calendarview')),this.calendarView},registerChangeView:function b(){var a=this;a.getCalendarView().find('button.fc-button:not(.dropdown-toggle)').on('click',function(){a.loadCalendarData();});},registerAddButton:function b(){var a=this;$('.js-add').on('click',function(){a.getCalendarCreateView().done(function(b){var c=new Vtiger_Header_Js;c.handleQuickCreateData(b,{callbackFunction:function c(b){a.addCalendarEvent(b.result);}});});});},registerEvents:function a(){this.registerCalendar(),this.loadCalendarData(!0),this.registerChangeView(),this.registerButtonSelectAll(),this.registerRefreshEvent(),this.registerAddButton();}});
//# sourceMappingURL=Calendar.min.js.map
