'use strict';

jQuery(function(){$('.js-header__btn--mail').data('numberunreademails')!=null&&(window.stopScanMails=!1,'Popup'!=getUrlVars().view&&startCheckMails()),0<$('.js-header__btn--mail select').length&&registerUserList();});function registerUserList(){var a=$('.js-header__btn--mail select');a.data('select2')?a.select2('destroy'):a.on('change',handleChangeUserEvent),App.Fields.Picklist.showSelect2ElementView(a,{templateResult:function e(a){if(!a.id)return a.text;var b=jQuery(a.element),c=b.data('nomail')?' ('+b.data('nomail')+')':'',d=$('<span>'+a.text+'<span class"text-left"><span>'+c+'</span>');return d},templateSelection:function e(a){var b=jQuery(a.element),c=b.data('nomail')?' ('+b.data('nomail')+')':'',d=jQuery('<span></span>');return d.append(a.text+c),d},closeOnSelect:!0});var b=a.data('select2');b.$dropdown.on('mouseup','li',function(b){'true'==jQuery(b.currentTarget).attr('aria-selected')&&a.trigger('change');}),b.$container.find('.select2-selection__rendered').on('mousedown',function(b){b.stopPropagation(),a.trigger('change');}),$('.js-mail-list').on('click','.js-mail-link',handleChangeUserEvent);}function handleChangeUserEvent(){var a={module:'OSSMail',action:'SetUser',user:$(this).val()};AppConnector.request(a).done(function(){'OSSMail'==app.getModuleName()?location.reload():window.location.href='index.php?module=OSSMail&view=Index';});}function startCheckMails(){var a=[],b=$('.js-header__btn--mail').data('interval');if($('.js-header__btn--mail .noMails').each(function(){a.push($(this).data('id'));}),0<a.length){checkMails(a);var c=setInterval(function(){!1==window.stopScanMails?checkMails(a):clearInterval(c);},1e3*b);}}function checkMails(a){var b=!1;AppConnector.request({module:'OSSMail',action:'CheckMails',users:a}).done(function(a){if(a.success&&!0!=a.success.error&&!0!=a.result.error){var c=a.result;$('.js-header__btn--mail .noMails').each(function(){var a=jQuery(this),d=a.data('id');if(jQuery.inArray(d,c)){var e=c[d];if(a.is('option'))a.data('nomail',e),b=!0;else{var f='';0<e&&(f='('+e+')'),a.text(f);}}}),b&&registerUserList();}else window.stopScanMails=!0;}).fail(function(){window.stopScanMails=!0;});}function getUrlVars(){var a={},b=window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d;});return a}
//# sourceMappingURL=checkmails.min.js.map
