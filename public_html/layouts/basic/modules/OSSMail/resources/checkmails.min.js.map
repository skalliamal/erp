{"version":3,"file":"checkmails.min.js","sources":["checkmails.js"],"sourcesContent":["/* {[The file is published on the basis of YetiForce Public License 3.0 that can be found in the following directory: licenses/LicenseEN.txt or yetiforce.com]} */\n'use strict';\n\njQuery(function () {\n\tif ($('.js-header__btn--mail').data('numberunreademails') != undefined) {\n\t\twindow.stopScanMails = false;\n\t\tif (getUrlVars()['view'] != 'Popup') {\n\t\t\tstartCheckMails();\n\t\t}\n\t}\n\tif ($('.js-header__btn--mail select').length > 0) {\n\t\tregisterUserList();\n\t}\n});\n\nfunction registerUserList() {\n\tvar selectUsers = $('.js-header__btn--mail select');\n\tif (selectUsers.data('select2')) {\n\t\tselectUsers.select2('destroy');\n\t} else {\n\t\tselectUsers.on('change', handleChangeUserEvent);\n\t}\n\tApp.Fields.Picklist.showSelect2ElementView(selectUsers, {\n\t\ttemplateResult: function (state) {\n\t\t\tif (!state.id) {\n\t\t\t\treturn state.text;\n\t\t\t}\n\t\t\tvar element = jQuery(state.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar $state = $('<span>' + state.text + '<span class\"text-left\"><span>' + text + '</span>');\n\t\t\treturn $state;\n\t\t},\n\t\ttemplateSelection: function (data) {\n\t\t\tvar element = jQuery(data.element);\n\t\t\tvar text = element.data('nomail') ? ' (' + element.data('nomail') + ')' : '';\n\t\t\tvar resultContainer = jQuery('<span></span>');\n\t\t\tresultContainer.append(data.text + text);\n\t\t\treturn resultContainer;\n\t\t},\n\t\tcloseOnSelect: true\n\t});\n\tvar select2Instance = selectUsers.data('select2');\n\tselect2Instance.$dropdown.on('mouseup', 'li', function (e) {\n\t\tif (jQuery(e.currentTarget).attr('aria-selected') == 'true') {\n\t\t\tselectUsers.trigger('change');\n\t\t}\n\t});\n\tselect2Instance.$container.find('.select2-selection__rendered').on('mousedown', function (e) {\n\t\te.stopPropagation();\n\t\tselectUsers.trigger('change');\n\t});\n\t$('.js-mail-list').on('click', '.js-mail-link', handleChangeUserEvent);\n}\n\nfunction handleChangeUserEvent() {\n\tvar params = {\n\t\t'module': 'OSSMail',\n\t\t'action': \"SetUser\",\n\t\t'user': $(this).val()\n\t};\n\tAppConnector.request(params).done(function (response) {\n\t\tif (app.getModuleName() == 'OSSMail') {\n\t\t\tlocation.reload();\n\t\t} else {\n\t\t\twindow.location.href = \"index.php?module=OSSMail&view=Index\";\n\t\t}\n\t});\n}\n\nfunction startCheckMails() {\n\tvar users = [];\n\tvar timeCheckingMails = $('.js-header__btn--mail').data('interval');\n\t$(\".js-header__btn--mail .noMails\").each(function (index) {\n\t\tusers.push($(this).data('id'));\n\t});\n\tif (users.length > 0) {\n\t\tcheckMails(users);\n\t\tvar refreshIntervalId = setInterval(function () {\n\t\t\tif (window.stopScanMails == false) {\n\t\t\t\tcheckMails(users);\n\t\t\t} else {\n\t\t\t\tclearInterval(refreshIntervalId);\n\t\t\t}\n\t\t}, timeCheckingMails * 1000);\n\t}\n}\n\nfunction checkMails(users) {\n\tvar params = {\n\t\t'module': 'OSSMail',\n\t\t'action': \"CheckMails\",\n\t\t'users': users,\n\t};\n\tvar reloadSelect = false;\n\tAppConnector.request(params).done(function (response) {\n\t\tif (response.success && response.success.error != true && response.result.error != true) {\n\t\t\tvar result = response.result;\n\t\t\t$(\".js-header__btn--mail .noMails\").each(function (index) {\n\t\t\t\tvar element = jQuery(this);\n\t\t\t\tvar id = element.data('id');\n\t\t\t\tif (jQuery.inArray(id, result)) {\n\t\t\t\t\tvar num = result[id];\n\t\t\t\t\tif (element.is('option')) {\n\t\t\t\t\t\telement.data('nomail', num);\n\t\t\t\t\t\treloadSelect = true;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar text = '';\n\t\t\t\t\t\tif (num > 0) {\n\t\t\t\t\t\t\ttext = '(' + num + ')';\n\t\t\t\t\t\t}\n\t\t\t\t\t\telement.text(text);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (reloadSelect) {\n\t\t\t\tregisterUserList();\n\t\t\t}\n\t\t} else {\n\t\t\twindow.stopScanMails = true;\n\t\t}\n\t}).fail(function () {\n\t\twindow.stopScanMails = true;\n\t});\n}\n\nfunction getUrlVars() {\n\tvar vars = {};\n\tvar parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function (m, key, value) {\n\t\tvars[key] = value;\n\t});\n\treturn vars;\n}\n"],"names":["jQuery","$","data","window","stopScanMails","startCheckMails","length","registerUserList","selectUsers","select2","on","handleChangeUserEvent","App","Fields","Picklist","showSelect2ElementView","templateResult","state","id","text","element","$state","templateSelection","resultContainer","append","closeOnSelect","select2Instance","$dropdown","e","currentTarget","attr","trigger","$container","find","stopPropagation","val","AppConnector","request","params","done","getModuleName","location","reload","href","timeCheckingMails","each","users","push","checkMails","setInterval","clearInterval","refreshIntervalId","response","success","error","result","inArray","is","num","reloadSelect","fail","parts","replace","m","key","value","vars"],"mappings":"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"}